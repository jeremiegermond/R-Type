\hypertarget{jar__xm_8h_source}{}\doxysection{jar\+\_\+xm.\+h}
\label{jar__xm_8h_source}\index{build/\_deps/raylib-\/src/src/external/jar\_xm.h@{build/\_deps/raylib-\/src/src/external/jar\_xm.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// jar\_xm.h}}
\DoxyCodeLine{2 \textcolor{comment}{//}}
\DoxyCodeLine{3 \textcolor{comment}{// ORIGINAL LICENSE -\/ FOR LIBXM:}}
\DoxyCodeLine{4 \textcolor{comment}{//}}
\DoxyCodeLine{5 \textcolor{comment}{// Author: Romain "{}Artefact2"{} Dalmaso <artefact2@gmail.com>}}
\DoxyCodeLine{6 \textcolor{comment}{// Contributor: Dan Spencer <dan@atomicpotato.net>}}
\DoxyCodeLine{7 \textcolor{comment}{// Repackaged into jar\_xm.h By: Joshua Adam Reisenauer <kd7tck@gmail.com>}}
\DoxyCodeLine{8 \textcolor{comment}{// This program is free software. It comes without any warranty, to the}}
\DoxyCodeLine{9 \textcolor{comment}{// extent permitted by applicable law. You can redistribute it and/or}}
\DoxyCodeLine{10 \textcolor{comment}{// modify it under the terms of the Do What The Fuck You Want To Public}}
\DoxyCodeLine{11 \textcolor{comment}{// License, Version 2, as published by Sam Hocevar. See}}
\DoxyCodeLine{12 \textcolor{comment}{// http://sam.zoy.org/wtfpl/COPYING for more details.}}
\DoxyCodeLine{13 \textcolor{comment}{//}}
\DoxyCodeLine{14 \textcolor{comment}{// HISTORY:}}
\DoxyCodeLine{15 \textcolor{comment}{//   v0.1.0 2016-\/02-\/22  jar\_xm.h -\/ development by Joshua Reisenauer, MAR 2016}}
\DoxyCodeLine{16 \textcolor{comment}{//   v0.2.1 2021-\/03-\/07  m4ntr0n1c: Fix clipping noise for "{}bad"{} xm's (they will always clip), avoid clip noise and just put a ceiling)}}
\DoxyCodeLine{17 \textcolor{comment}{//   v0.2.2 2021-\/03-\/09  m4ntr0n1c: Add complete debug solution (raylib.h must be included)}}
\DoxyCodeLine{18 \textcolor{comment}{//   v0.2.3 2021-\/03-\/11  m4ntr0n1c: Fix tempo, bpm and volume on song stop / start / restart / loop}}
\DoxyCodeLine{19 \textcolor{comment}{//   v0.2.4 2021-\/03-\/17  m4ntr0n1c: Sanitize code for readability}}
\DoxyCodeLine{20 \textcolor{comment}{//   v0.2.5 2021-\/03-\/22  m4ntr0n1c: Minor adjustments}}
\DoxyCodeLine{21 \textcolor{comment}{//   v0.2.6 2021-\/04-\/01  m4ntr0n1c: Minor fixes and optimisation}}
\DoxyCodeLine{22 \textcolor{comment}{//   v0.3.0 2021-\/04-\/03  m4ntr0n1c: Addition of Stereo sample support, Linear Interpolation and Ramping now addressable options in code}}
\DoxyCodeLine{23 \textcolor{comment}{//   v0.3.1 2021-\/04-\/04  m4ntr0n1c: Volume effects column adjustments, sample offset handling adjustments}}
\DoxyCodeLine{24 \textcolor{comment}{//}}
\DoxyCodeLine{25 \textcolor{comment}{// USAGE:}}
\DoxyCodeLine{26 \textcolor{comment}{//}}
\DoxyCodeLine{27 \textcolor{comment}{// In ONE source file, put:}}
\DoxyCodeLine{28 \textcolor{comment}{//}}
\DoxyCodeLine{29 \textcolor{comment}{//    \#define JAR\_XM\_IMPLEMENTATION}}
\DoxyCodeLine{30 \textcolor{comment}{//    \#include "{}jar\_xm.h"{}}}
\DoxyCodeLine{31 \textcolor{comment}{//}}
\DoxyCodeLine{32 \textcolor{comment}{// Other source files should just include jar\_xm.h}}
\DoxyCodeLine{33 \textcolor{comment}{//}}
\DoxyCodeLine{34 \textcolor{comment}{// SAMPLE CODE:}}
\DoxyCodeLine{35 \textcolor{comment}{//}}
\DoxyCodeLine{36 \textcolor{comment}{// jar\_xm\_context\_t *musicptr;}}
\DoxyCodeLine{37 \textcolor{comment}{// float musicBuffer[48000 / 60];}}
\DoxyCodeLine{38 \textcolor{comment}{// int intro\_load(void)}}
\DoxyCodeLine{39 \textcolor{comment}{// \{}}
\DoxyCodeLine{40 \textcolor{comment}{//     jar\_xm\_create\_context\_from\_file(\&musicptr, 48000, "{}Song.XM"{});}}
\DoxyCodeLine{41 \textcolor{comment}{//     return 1;}}
\DoxyCodeLine{42 \textcolor{comment}{// \}}}
\DoxyCodeLine{43 \textcolor{comment}{// int intro\_unload(void)}}
\DoxyCodeLine{44 \textcolor{comment}{// \{}}
\DoxyCodeLine{45 \textcolor{comment}{//     jar\_xm\_free\_context(musicptr);}}
\DoxyCodeLine{46 \textcolor{comment}{//     return 1;}}
\DoxyCodeLine{47 \textcolor{comment}{// \}}}
\DoxyCodeLine{48 \textcolor{comment}{// int intro\_tick(long counter)}}
\DoxyCodeLine{49 \textcolor{comment}{// \{}}
\DoxyCodeLine{50 \textcolor{comment}{//     jar\_xm\_generate\_samples(musicptr, musicBuffer, (48000 / 60) / 2);}}
\DoxyCodeLine{51 \textcolor{comment}{//     if(IsKeyDown(KEY\_ENTER))}}
\DoxyCodeLine{52 \textcolor{comment}{//         return 1;}}
\DoxyCodeLine{53 \textcolor{comment}{//     return 0;}}
\DoxyCodeLine{54 \textcolor{comment}{// \}}}
\DoxyCodeLine{55 \textcolor{comment}{//}}
\DoxyCodeLine{56 \textcolor{preprocessor}{\#ifndef INCLUDE\_JAR\_XM\_H}}
\DoxyCodeLine{57 \textcolor{preprocessor}{\#define INCLUDE\_JAR\_XM\_H}}
\DoxyCodeLine{58 }
\DoxyCodeLine{59 \textcolor{preprocessor}{\#include <stdint.h>}}
\DoxyCodeLine{60 }
\DoxyCodeLine{61 \textcolor{preprocessor}{\#define JAR\_XM\_DEBUG 0}}
\DoxyCodeLine{62 \textcolor{preprocessor}{\#define JAR\_XM\_DEFENSIVE 1}}
\DoxyCodeLine{63 \textcolor{comment}{//\#define JAR\_XM\_RAYLIB 0 // set to 0 to disable the RayLib visualizer extension}}
\DoxyCodeLine{64 }
\DoxyCodeLine{65 \textcolor{comment}{// Allow custom memory allocators}}
\DoxyCodeLine{66 \textcolor{preprocessor}{\#ifndef JARXM\_MALLOC}}
\DoxyCodeLine{67 \textcolor{preprocessor}{    \#define JARXM\_MALLOC(sz)    malloc(sz)}}
\DoxyCodeLine{68 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{69 \textcolor{preprocessor}{\#ifndef JARXM\_FREE}}
\DoxyCodeLine{70 \textcolor{preprocessor}{    \#define JARXM\_FREE(p)       free(p)}}
\DoxyCodeLine{71 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{72 }
\DoxyCodeLine{73 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{74 \textcolor{keyword}{struct }jar\_xm\_context\_s;}
\DoxyCodeLine{75 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }jar\_xm\_context\_s jar\_xm\_context\_t;}
\DoxyCodeLine{76 }
\DoxyCodeLine{77 \textcolor{preprocessor}{\#ifdef \_\_cplusplus}}
\DoxyCodeLine{78 \textcolor{keyword}{extern} \textcolor{stringliteral}{"{}C"{}} \{}
\DoxyCodeLine{79 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{80 }
\DoxyCodeLine{81 \textcolor{comment}{//** Create a XM context.}}
\DoxyCodeLine{82 \textcolor{comment}{// * @param moddata the contents of the module}}
\DoxyCodeLine{83 \textcolor{comment}{// * @param rate play rate in Hz, recommended value of 48000}}
\DoxyCodeLine{84 \textcolor{comment}{// * @returns 0 on success}}
\DoxyCodeLine{85 \textcolor{comment}{// * @returns 1 if module data is not sane}}
\DoxyCodeLine{86 \textcolor{comment}{// * @returns 2 if memory allocation failed}}
\DoxyCodeLine{87 \textcolor{comment}{// * @returns 3 unable to open input file}}
\DoxyCodeLine{88 \textcolor{comment}{// * @returns 4 fseek() failed}}
\DoxyCodeLine{89 \textcolor{comment}{// * @returns 5 fread() failed}}
\DoxyCodeLine{90 \textcolor{comment}{// * @returns 6 unkown error}}
\DoxyCodeLine{91 \textcolor{comment}{// * @deprecated This function is unsafe!}}
\DoxyCodeLine{92 \textcolor{comment}{// * @see jar\_xm\_create\_context\_safe()}}
\DoxyCodeLine{93 \textcolor{keywordtype}{int} jar\_xm\_create\_context\_from\_file(jar\_xm\_context\_t** ctx, uint32\_t rate, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* filename);}
\DoxyCodeLine{94 }
\DoxyCodeLine{95 \textcolor{comment}{//** Create a XM context.}}
\DoxyCodeLine{96 \textcolor{comment}{// * @param moddata the contents of the module}}
\DoxyCodeLine{97 \textcolor{comment}{// * @param rate play rate in Hz, recommended value of 48000}}
\DoxyCodeLine{98 \textcolor{comment}{// * @returns 0 on success}}
\DoxyCodeLine{99 \textcolor{comment}{// * @returns 1 if module data is not sane}}
\DoxyCodeLine{100 \textcolor{comment}{// * @returns 2 if memory allocation failed}}
\DoxyCodeLine{101 \textcolor{comment}{// * @deprecated This function is unsafe!}}
\DoxyCodeLine{102 \textcolor{comment}{// * @see jar\_xm\_create\_context\_safe()}}
\DoxyCodeLine{103 \textcolor{keywordtype}{int} jar\_xm\_create\_context(jar\_xm\_context\_t** ctx, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* moddata, uint32\_t rate);}
\DoxyCodeLine{104 }
\DoxyCodeLine{105 \textcolor{comment}{//** Create a XM context.}}
\DoxyCodeLine{106 \textcolor{comment}{// * @param moddata the contents of the module}}
\DoxyCodeLine{107 \textcolor{comment}{// * @param moddata\_length the length of the contents of the module, in bytes}}
\DoxyCodeLine{108 \textcolor{comment}{// * @param rate play rate in Hz, recommended value of 48000}}
\DoxyCodeLine{109 \textcolor{comment}{// * @returns 0 on success}}
\DoxyCodeLine{110 \textcolor{comment}{// * @returns 1 if module data is not sane}}
\DoxyCodeLine{111 \textcolor{comment}{// * @returns 2 if memory allocation failed}}
\DoxyCodeLine{112 \textcolor{keywordtype}{int} jar\_xm\_create\_context\_safe(jar\_xm\_context\_t** ctx, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* moddata, \textcolor{keywordtype}{size\_t} moddata\_length, uint32\_t rate);}
\DoxyCodeLine{113 }
\DoxyCodeLine{114 \textcolor{comment}{//** Free a XM context created by jar\_xm\_create\_context(). */}}
\DoxyCodeLine{115 \textcolor{keywordtype}{void} jar\_xm\_free\_context(jar\_xm\_context\_t* ctx);}
\DoxyCodeLine{116 }
\DoxyCodeLine{117 \textcolor{comment}{//** Play the module and put the sound samples in an output buffer.}}
\DoxyCodeLine{118 \textcolor{comment}{// * @param output buffer of 2*numsamples elements (A left and right value for each sample)}}
\DoxyCodeLine{119 \textcolor{comment}{// * @param numsamples number of samples to generate}}
\DoxyCodeLine{120 \textcolor{keywordtype}{void} jar\_xm\_generate\_samples(jar\_xm\_context\_t* ctx, \textcolor{keywordtype}{float}* output, \textcolor{keywordtype}{size\_t} numsamples);}
\DoxyCodeLine{121 }
\DoxyCodeLine{122 \textcolor{comment}{//** Play the module, resample from float to 16 bit, and put the sound samples in an output buffer.}}
\DoxyCodeLine{123 \textcolor{comment}{// * @param output buffer of 2*numsamples elements (A left and right value for each sample)}}
\DoxyCodeLine{124 \textcolor{comment}{// * @param numsamples number of samples to generate}}
\DoxyCodeLine{125 \textcolor{keywordtype}{void} jar\_xm\_generate\_samples\_16bit(jar\_xm\_context\_t* ctx, \textcolor{keywordtype}{short}* output, \textcolor{keywordtype}{size\_t} numsamples) \{}
\DoxyCodeLine{126     \textcolor{keywordtype}{float}* musicBuffer = JARXM\_MALLOC((2*numsamples)*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float}));}
\DoxyCodeLine{127     jar\_xm\_generate\_samples(ctx, musicBuffer, numsamples);}
\DoxyCodeLine{128 }
\DoxyCodeLine{129     \textcolor{keywordflow}{if}(output)\{}
\DoxyCodeLine{130         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} x=0;x<2*numsamples;x++) output[x] = (musicBuffer[x] * 32767.0f); \textcolor{comment}{// scale sample to signed small int}}
\DoxyCodeLine{131     \}}
\DoxyCodeLine{132     JARXM\_FREE(musicBuffer);}
\DoxyCodeLine{133 \}}
\DoxyCodeLine{134 }
\DoxyCodeLine{135 \textcolor{comment}{//** Play the module, resample from float to 8 bit, and put the sound samples in an output buffer.}}
\DoxyCodeLine{136 \textcolor{comment}{// * @param output buffer of 2*numsamples elements (A left and right value for each sample)}}
\DoxyCodeLine{137 \textcolor{comment}{// * @param numsamples number of samples to generate}}
\DoxyCodeLine{138 \textcolor{keywordtype}{void} jar\_xm\_generate\_samples\_8bit(jar\_xm\_context\_t* ctx, \textcolor{keywordtype}{char}* output, \textcolor{keywordtype}{size\_t} numsamples) \{}
\DoxyCodeLine{139     \textcolor{keywordtype}{float}* musicBuffer = JARXM\_MALLOC((2*numsamples)*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float}));}
\DoxyCodeLine{140     jar\_xm\_generate\_samples(ctx, musicBuffer, numsamples);}
\DoxyCodeLine{141 }
\DoxyCodeLine{142     \textcolor{keywordflow}{if}(output)\{}
\DoxyCodeLine{143         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} x=0;x<2*numsamples;x++) output[x] = (musicBuffer[x] * 127.0f); \textcolor{comment}{// scale sample to signed 8 bit}}
\DoxyCodeLine{144     \}}
\DoxyCodeLine{145     JARXM\_FREE(musicBuffer);}
\DoxyCodeLine{146 \}}
\DoxyCodeLine{147 }
\DoxyCodeLine{148 \textcolor{comment}{//** Set the maximum number of times a module can loop. After the specified number of loops, calls to jar\_xm\_generate\_samples will only generate silence. You can control the current number of loops with jar\_xm\_get\_loop\_count().}}
\DoxyCodeLine{149 \textcolor{comment}{// * @param loopcnt maximum number of loops. Use 0 to loop indefinitely.}}
\DoxyCodeLine{150 \textcolor{keywordtype}{void} jar\_xm\_set\_max\_loop\_count(jar\_xm\_context\_t* ctx, uint8\_t loopcnt);}
\DoxyCodeLine{151 }
\DoxyCodeLine{152 \textcolor{comment}{//** Get the loop count of the currently playing module. This value is 0 when the module is still playing, 1 when the module has looped once, etc.}}
\DoxyCodeLine{153 uint8\_t jar\_xm\_get\_loop\_count(jar\_xm\_context\_t* ctx);}
\DoxyCodeLine{154 }
\DoxyCodeLine{155 \textcolor{comment}{//** Mute or unmute a channel.}}
\DoxyCodeLine{156 \textcolor{comment}{// * @note Channel numbers go from 1 to jar\_xm\_get\_number\_of\_channels(...).}}
\DoxyCodeLine{157 \textcolor{comment}{// * @return whether the channel was muted.}}
\DoxyCodeLine{158 \textcolor{keywordtype}{bool} jar\_xm\_mute\_channel(jar\_xm\_context\_t* ctx, uint16\_t, \textcolor{keywordtype}{bool});}
\DoxyCodeLine{159 }
\DoxyCodeLine{160 \textcolor{comment}{//** Mute or unmute an instrument.}}
\DoxyCodeLine{161 \textcolor{comment}{// * @note Instrument numbers go from 1 to jar\_xm\_get\_number\_of\_instruments(...).}}
\DoxyCodeLine{162 \textcolor{comment}{// * @return whether the instrument was muted.}}
\DoxyCodeLine{163 \textcolor{keywordtype}{bool} jar\_xm\_mute\_instrument(jar\_xm\_context\_t* ctx, uint16\_t, \textcolor{keywordtype}{bool});}
\DoxyCodeLine{164 }
\DoxyCodeLine{165 \textcolor{comment}{//** Get the module name as a NUL-\/terminated string.}}
\DoxyCodeLine{166 \textcolor{keyword}{const} \textcolor{keywordtype}{char}* jar\_xm\_get\_module\_name(jar\_xm\_context\_t* ctx);}
\DoxyCodeLine{167 }
\DoxyCodeLine{168 \textcolor{comment}{//** Get the tracker name as a NUL-\/terminated string.}}
\DoxyCodeLine{169 \textcolor{keyword}{const} \textcolor{keywordtype}{char}* jar\_xm\_get\_tracker\_name(jar\_xm\_context\_t* ctx);}
\DoxyCodeLine{170 }
\DoxyCodeLine{171 \textcolor{comment}{//** Get the number of channels.}}
\DoxyCodeLine{172 uint16\_t jar\_xm\_get\_number\_of\_channels(jar\_xm\_context\_t* ctx);}
\DoxyCodeLine{173 }
\DoxyCodeLine{174 \textcolor{comment}{//** Get the module length (in patterns).}}
\DoxyCodeLine{175 uint16\_t jar\_xm\_get\_module\_length(jar\_xm\_context\_t*);}
\DoxyCodeLine{176 }
\DoxyCodeLine{177 \textcolor{comment}{//** Get the number of patterns.}}
\DoxyCodeLine{178 uint16\_t jar\_xm\_get\_number\_of\_patterns(jar\_xm\_context\_t* ctx);}
\DoxyCodeLine{179 }
\DoxyCodeLine{180 \textcolor{comment}{//** Get the number of rows of a pattern.}}
\DoxyCodeLine{181 \textcolor{comment}{// * @note Pattern numbers go from 0 to jar\_xm\_get\_number\_of\_patterns(...)-\/1.}}
\DoxyCodeLine{182 uint16\_t jar\_xm\_get\_number\_of\_rows(jar\_xm\_context\_t* ctx, uint16\_t);}
\DoxyCodeLine{183 }
\DoxyCodeLine{184 \textcolor{comment}{//** Get the number of instruments.}}
\DoxyCodeLine{185 uint16\_t jar\_xm\_get\_number\_of\_instruments(jar\_xm\_context\_t* ctx);}
\DoxyCodeLine{186 }
\DoxyCodeLine{187 \textcolor{comment}{//** Get the number of samples of an instrument.}}
\DoxyCodeLine{188 \textcolor{comment}{// * @note Instrument numbers go from 1 to jar\_xm\_get\_number\_of\_instruments(...).}}
\DoxyCodeLine{189 uint16\_t jar\_xm\_get\_number\_of\_samples(jar\_xm\_context\_t* ctx, uint16\_t);}
\DoxyCodeLine{190 }
\DoxyCodeLine{191 \textcolor{comment}{//** Get the current module speed.}}
\DoxyCodeLine{192 \textcolor{comment}{// * @param bpm will receive the current BPM}}
\DoxyCodeLine{193 \textcolor{comment}{// * @param tempo will receive the current tempo (ticks per line)}}
\DoxyCodeLine{194 \textcolor{keywordtype}{void} jar\_xm\_get\_playing\_speed(jar\_xm\_context\_t* ctx, uint16\_t* bpm, uint16\_t* tempo);}
\DoxyCodeLine{195 }
\DoxyCodeLine{196 \textcolor{comment}{//** Get the current position in the module being played.}}
\DoxyCodeLine{197 \textcolor{comment}{// * @param pattern\_index if not NULL, will receive the current pattern index in the POT (pattern order table)}}
\DoxyCodeLine{198 \textcolor{comment}{// * @param pattern if not NULL, will receive the current pattern number}}
\DoxyCodeLine{199 \textcolor{comment}{// * @param row if not NULL, will receive the current row}}
\DoxyCodeLine{200 \textcolor{comment}{// * @param samples if not NULL, will receive the total number of}}
\DoxyCodeLine{201 \textcolor{comment}{// * generated samples (divide by sample rate to get seconds of generated audio)}}
\DoxyCodeLine{202 \textcolor{keywordtype}{void} jar\_xm\_get\_position(jar\_xm\_context\_t* ctx, uint8\_t* pattern\_index, uint8\_t* pattern, uint8\_t* row, uint64\_t* samples);}
\DoxyCodeLine{203 }
\DoxyCodeLine{204 \textcolor{comment}{//** Get the latest time (in number of generated samples) when a particular instrument was triggered in any channel.}}
\DoxyCodeLine{205 \textcolor{comment}{// * @note Instrument numbers go from 1 to jar\_xm\_get\_number\_of\_instruments(...).}}
\DoxyCodeLine{206 uint64\_t jar\_xm\_get\_latest\_trigger\_of\_instrument(jar\_xm\_context\_t* ctx, uint16\_t);}
\DoxyCodeLine{207 }
\DoxyCodeLine{208 \textcolor{comment}{//** Get the latest time (in number of generated samples) when a particular sample was triggered in any channel.}}
\DoxyCodeLine{209 \textcolor{comment}{// * @note Instrument numbers go from 1 to jar\_xm\_get\_number\_of\_instruments(...).}}
\DoxyCodeLine{210 \textcolor{comment}{// * @note Sample numbers go from 0 to jar\_xm\_get\_nubmer\_of\_samples(...,instr)-\/1.}}
\DoxyCodeLine{211 uint64\_t jar\_xm\_get\_latest\_trigger\_of\_sample(jar\_xm\_context\_t* ctx, uint16\_t instr, uint16\_t \mbox{\hyperlink{structsample}{sample}});}
\DoxyCodeLine{212 }
\DoxyCodeLine{213 \textcolor{comment}{//** Get the latest time (in number of generated samples) when any instrument was triggered in a given channel.}}
\DoxyCodeLine{214 \textcolor{comment}{// * @note Channel numbers go from 1 to jar\_xm\_get\_number\_of\_channels(...).}}
\DoxyCodeLine{215 uint64\_t jar\_xm\_get\_latest\_trigger\_of\_channel(jar\_xm\_context\_t* ctx, uint16\_t);}
\DoxyCodeLine{216 }
\DoxyCodeLine{217 \textcolor{comment}{//** Get the number of remaining samples. Divide by 2 to get the number of individual LR data samples.}}
\DoxyCodeLine{218 \textcolor{comment}{// * @note This is the remaining number of samples before the loop starts module again, or halts if on last pass.}}
\DoxyCodeLine{219 \textcolor{comment}{// * @note This function is very slow and should only be run once, if at all.}}
\DoxyCodeLine{220 uint64\_t jar\_xm\_get\_remaining\_samples(jar\_xm\_context\_t* ctx);}
\DoxyCodeLine{221 }
\DoxyCodeLine{222 \textcolor{preprocessor}{\#ifdef \_\_cplusplus}}
\DoxyCodeLine{223 \}}
\DoxyCodeLine{224 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{225 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{226 }
\DoxyCodeLine{227 \textcolor{preprocessor}{\#ifdef JAR\_XM\_IMPLEMENTATION}}
\DoxyCodeLine{228 }
\DoxyCodeLine{229 \textcolor{preprocessor}{\#include <math.h>}}
\DoxyCodeLine{230 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{231 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{232 \textcolor{preprocessor}{\#include <limits.h>}}
\DoxyCodeLine{233 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{234 }
\DoxyCodeLine{235 \textcolor{preprocessor}{\#if JAR\_XM\_DEBUG            }\textcolor{comment}{//JAR\_XM\_DEBUG defined as 0}}
\DoxyCodeLine{236 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{237 \textcolor{preprocessor}{\#define DEBUG(fmt, ...) do \{                                        \(\backslash\)}}
\DoxyCodeLine{238 \textcolor{preprocessor}{        fprintf(stderr, "{}\%s(): "{}} fmt "{}\(\backslash\)n"{}, \_\_func\_\_, \_\_VA\_ARGS\_\_);    \(\backslash\)}
\DoxyCodeLine{239         fflush(stderr);                                                \(\backslash\)}
\DoxyCodeLine{240     \} while(0)}
\DoxyCodeLine{241 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{242 \textcolor{preprocessor}{\#define DEBUG(...)}}
\DoxyCodeLine{243 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{244 }
\DoxyCodeLine{245 \textcolor{preprocessor}{\#if jar\_xm\_BIG\_ENDIAN}}
\DoxyCodeLine{246 \textcolor{preprocessor}{\#error "{}Big endian platforms are not yet supported, sorry"{}}}
\DoxyCodeLine{247 \textcolor{comment}{/* Make sure the compiler stops, even if \#error is ignored */}}
\DoxyCodeLine{248 \textcolor{keyword}{extern} \textcolor{keywordtype}{int} \_\_fail[-\/1];}
\DoxyCodeLine{249 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{250 }
\DoxyCodeLine{251 \textcolor{comment}{/* -\/-\/-\/-\/-\/ XM constants -\/-\/-\/-\/-\/ */}}
\DoxyCodeLine{252 \textcolor{preprocessor}{\#define SAMPLE\_NAME\_LENGTH 22}}
\DoxyCodeLine{253 \textcolor{preprocessor}{\#define INSTRUMENT\_NAME\_LENGTH 22}}
\DoxyCodeLine{254 \textcolor{preprocessor}{\#define MODULE\_NAME\_LENGTH 20}}
\DoxyCodeLine{255 \textcolor{preprocessor}{\#define TRACKER\_NAME\_LENGTH 20}}
\DoxyCodeLine{256 \textcolor{preprocessor}{\#define PATTERN\_ORDER\_TABLE\_LENGTH 256}}
\DoxyCodeLine{257 \textcolor{preprocessor}{\#define NUM\_NOTES 96 }\textcolor{comment}{// from 1 to 96, where 1 = C-\/0}}
\DoxyCodeLine{258 \textcolor{preprocessor}{\#define NUM\_ENVELOPE\_POINTS 12 }\textcolor{comment}{// to be verified if 12 is the max}}
\DoxyCodeLine{259 \textcolor{preprocessor}{\#define MAX\_NUM\_ROWS 256}}
\DoxyCodeLine{260 }
\DoxyCodeLine{261 \textcolor{preprocessor}{\#define jar\_xm\_SAMPLE\_RAMPING\_POINTS 8}}
\DoxyCodeLine{262 }
\DoxyCodeLine{263 \textcolor{comment}{/* -\/-\/-\/-\/-\/ Data types -\/-\/-\/-\/-\/ */}}
\DoxyCodeLine{264 }
\DoxyCodeLine{265 \textcolor{keyword}{enum} jar\_xm\_waveform\_type\_e \{}
\DoxyCodeLine{266     jar\_xm\_SINE\_WAVEFORM = 0,}
\DoxyCodeLine{267     jar\_xm\_RAMP\_DOWN\_WAVEFORM = 1,}
\DoxyCodeLine{268     jar\_xm\_SQUARE\_WAVEFORM = 2,}
\DoxyCodeLine{269     jar\_xm\_RANDOM\_WAVEFORM = 3,}
\DoxyCodeLine{270     jar\_xm\_RAMP\_UP\_WAVEFORM = 4,}
\DoxyCodeLine{271 \};}
\DoxyCodeLine{272 \textcolor{keyword}{typedef} \textcolor{keyword}{enum} jar\_xm\_waveform\_type\_e jar\_xm\_waveform\_type\_t;}
\DoxyCodeLine{273 }
\DoxyCodeLine{274 \textcolor{keyword}{enum} jar\_xm\_loop\_type\_e \{}
\DoxyCodeLine{275     jar\_xm\_NO\_LOOP,}
\DoxyCodeLine{276     jar\_xm\_FORWARD\_LOOP,}
\DoxyCodeLine{277     jar\_xm\_PING\_PONG\_LOOP,}
\DoxyCodeLine{278 \};}
\DoxyCodeLine{279 \textcolor{keyword}{typedef} \textcolor{keyword}{enum} jar\_xm\_loop\_type\_e jar\_xm\_loop\_type\_t;}
\DoxyCodeLine{280 }
\DoxyCodeLine{281 \textcolor{keyword}{enum} jar\_xm\_frequency\_type\_e \{}
\DoxyCodeLine{282     jar\_xm\_LINEAR\_FREQUENCIES,}
\DoxyCodeLine{283     jar\_xm\_AMIGA\_FREQUENCIES,}
\DoxyCodeLine{284 \};}
\DoxyCodeLine{285 \textcolor{keyword}{typedef} \textcolor{keyword}{enum} jar\_xm\_frequency\_type\_e jar\_xm\_frequency\_type\_t;}
\DoxyCodeLine{286 }
\DoxyCodeLine{287 \textcolor{keyword}{struct }jar\_xm\_envelope\_point\_s \{}
\DoxyCodeLine{288     uint16\_t frame;}
\DoxyCodeLine{289     uint16\_t value;}
\DoxyCodeLine{290 \};}
\DoxyCodeLine{291 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }jar\_xm\_envelope\_point\_s jar\_xm\_envelope\_point\_t;}
\DoxyCodeLine{292 }
\DoxyCodeLine{293 \textcolor{keyword}{struct }jar\_xm\_envelope\_s \{}
\DoxyCodeLine{294     jar\_xm\_envelope\_point\_t points[NUM\_ENVELOPE\_POINTS];}
\DoxyCodeLine{295     uint8\_t num\_points;}
\DoxyCodeLine{296     uint8\_t sustain\_point;}
\DoxyCodeLine{297     uint8\_t loop\_start\_point;}
\DoxyCodeLine{298     uint8\_t loop\_end\_point;}
\DoxyCodeLine{299     \textcolor{keywordtype}{bool} enabled;}
\DoxyCodeLine{300     \textcolor{keywordtype}{bool} sustain\_enabled;}
\DoxyCodeLine{301     \textcolor{keywordtype}{bool} loop\_enabled;}
\DoxyCodeLine{302 \};}
\DoxyCodeLine{303 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }jar\_xm\_envelope\_s jar\_xm\_envelope\_t;}
\DoxyCodeLine{304 }
\DoxyCodeLine{305 \textcolor{keyword}{struct }jar\_xm\_sample\_s \{}
\DoxyCodeLine{306     \textcolor{keywordtype}{char} name[SAMPLE\_NAME\_LENGTH + 1];}
\DoxyCodeLine{307     int8\_t bits; \textcolor{comment}{/* Either 8 or 16 */}}
\DoxyCodeLine{308     int8\_t stereo;}
\DoxyCodeLine{309     uint32\_t length;}
\DoxyCodeLine{310     uint32\_t loop\_start;}
\DoxyCodeLine{311     uint32\_t loop\_length;}
\DoxyCodeLine{312     uint32\_t loop\_end;}
\DoxyCodeLine{313     \textcolor{keywordtype}{float} volume;}
\DoxyCodeLine{314     int8\_t finetune;}
\DoxyCodeLine{315     jar\_xm\_loop\_type\_t loop\_type;}
\DoxyCodeLine{316     \textcolor{keywordtype}{float} panning;}
\DoxyCodeLine{317     int8\_t relative\_note;}
\DoxyCodeLine{318     uint64\_t latest\_trigger;}
\DoxyCodeLine{319 }
\DoxyCodeLine{320     \textcolor{keywordtype}{float}* data;}
\DoxyCodeLine{321  \};}
\DoxyCodeLine{322  \textcolor{keyword}{typedef} \textcolor{keyword}{struct }jar\_xm\_sample\_s jar\_xm\_sample\_t;}
\DoxyCodeLine{323 }
\DoxyCodeLine{324  \textcolor{keyword}{struct }jar\_xm\_instrument\_s \{}
\DoxyCodeLine{325      \textcolor{keywordtype}{char} name[INSTRUMENT\_NAME\_LENGTH + 1];}
\DoxyCodeLine{326      uint16\_t num\_samples;}
\DoxyCodeLine{327      uint8\_t sample\_of\_notes[NUM\_NOTES];}
\DoxyCodeLine{328      jar\_xm\_envelope\_t volume\_envelope;}
\DoxyCodeLine{329      jar\_xm\_envelope\_t panning\_envelope;}
\DoxyCodeLine{330      jar\_xm\_waveform\_type\_t vibrato\_type;}
\DoxyCodeLine{331      uint8\_t vibrato\_sweep;}
\DoxyCodeLine{332      uint8\_t vibrato\_depth;}
\DoxyCodeLine{333      uint8\_t vibrato\_rate;}
\DoxyCodeLine{334      uint16\_t volume\_fadeout;}
\DoxyCodeLine{335      uint64\_t latest\_trigger;}
\DoxyCodeLine{336      \textcolor{keywordtype}{bool} muted;}
\DoxyCodeLine{337 }
\DoxyCodeLine{338      jar\_xm\_sample\_t* samples;}
\DoxyCodeLine{339  \};}
\DoxyCodeLine{340  \textcolor{keyword}{typedef} \textcolor{keyword}{struct }jar\_xm\_instrument\_s jar\_xm\_instrument\_t;}
\DoxyCodeLine{341 }
\DoxyCodeLine{342  \textcolor{keyword}{struct }jar\_xm\_pattern\_slot\_s \{}
\DoxyCodeLine{343      uint8\_t \mbox{\hyperlink{structnote}{note}}; \textcolor{comment}{/* 1-\/96, 97 = Key Off note */}}
\DoxyCodeLine{344      uint8\_t instrument; \textcolor{comment}{/* 1-\/128 */}}
\DoxyCodeLine{345      uint8\_t volume\_column;}
\DoxyCodeLine{346      uint8\_t effect\_type;}
\DoxyCodeLine{347      uint8\_t effect\_param;}
\DoxyCodeLine{348  \};}
\DoxyCodeLine{349  \textcolor{keyword}{typedef} \textcolor{keyword}{struct }jar\_xm\_pattern\_slot\_s jar\_xm\_pattern\_slot\_t;}
\DoxyCodeLine{350 }
\DoxyCodeLine{351  \textcolor{keyword}{struct }jar\_xm\_pattern\_s \{}
\DoxyCodeLine{352      uint16\_t num\_rows;}
\DoxyCodeLine{353      jar\_xm\_pattern\_slot\_t* slots; \textcolor{comment}{/* Array of size num\_rows * num\_channels */}}
\DoxyCodeLine{354  \};}
\DoxyCodeLine{355  \textcolor{keyword}{typedef} \textcolor{keyword}{struct }jar\_xm\_pattern\_s jar\_xm\_pattern\_t;}
\DoxyCodeLine{356 }
\DoxyCodeLine{357  \textcolor{keyword}{struct }jar\_xm\_module\_s \{}
\DoxyCodeLine{358      \textcolor{keywordtype}{char} name[MODULE\_NAME\_LENGTH + 1];}
\DoxyCodeLine{359      \textcolor{keywordtype}{char} trackername[TRACKER\_NAME\_LENGTH + 1];}
\DoxyCodeLine{360      uint16\_t length;}
\DoxyCodeLine{361      uint16\_t restart\_position;}
\DoxyCodeLine{362      uint16\_t num\_channels;}
\DoxyCodeLine{363      uint16\_t num\_patterns;}
\DoxyCodeLine{364      uint16\_t num\_instruments;}
\DoxyCodeLine{365      uint16\_t linear\_interpolation;}
\DoxyCodeLine{366      uint16\_t ramping;}
\DoxyCodeLine{367      jar\_xm\_frequency\_type\_t frequency\_type;}
\DoxyCodeLine{368      uint8\_t pattern\_table[PATTERN\_ORDER\_TABLE\_LENGTH];}
\DoxyCodeLine{369 }
\DoxyCodeLine{370      jar\_xm\_pattern\_t* patterns;}
\DoxyCodeLine{371      jar\_xm\_instrument\_t* instruments; \textcolor{comment}{/* Instrument 1 has index 0, instrument 2 has index 1, etc. */}}
\DoxyCodeLine{372  \};}
\DoxyCodeLine{373  \textcolor{keyword}{typedef} \textcolor{keyword}{struct }jar\_xm\_module\_s jar\_xm\_module\_t;}
\DoxyCodeLine{374 }
\DoxyCodeLine{375  \textcolor{keyword}{struct }jar\_xm\_channel\_context\_s \{}
\DoxyCodeLine{376      \textcolor{keywordtype}{float} \mbox{\hyperlink{structnote}{note}};}
\DoxyCodeLine{377      \textcolor{keywordtype}{float} orig\_note; \textcolor{comment}{/* The original note before effect modifications, as read in the pattern. */}}
\DoxyCodeLine{378      jar\_xm\_instrument\_t* instrument; \textcolor{comment}{/* Could be NULL */}}
\DoxyCodeLine{379      jar\_xm\_sample\_t* \mbox{\hyperlink{structsample}{sample}}; \textcolor{comment}{/* Could be NULL */}}
\DoxyCodeLine{380      jar\_xm\_pattern\_slot\_t* current;}
\DoxyCodeLine{381 }
\DoxyCodeLine{382      \textcolor{keywordtype}{float} sample\_position;}
\DoxyCodeLine{383      \textcolor{keywordtype}{float} period;}
\DoxyCodeLine{384      \textcolor{keywordtype}{float} frequency;}
\DoxyCodeLine{385      \textcolor{keywordtype}{float} step;}
\DoxyCodeLine{386      \textcolor{keywordtype}{bool} ping; \textcolor{comment}{/* For ping-\/pong samples: true is -\/-\/>, false is <-\/-\/ */}}
\DoxyCodeLine{387 }
\DoxyCodeLine{388      \textcolor{keywordtype}{float} volume; \textcolor{comment}{/* Ideally between 0 (muted) and 1 (loudest) */}}
\DoxyCodeLine{389      \textcolor{keywordtype}{float} panning; \textcolor{comment}{/* Between 0 (left) and 1 (right); 0.5 is centered */}}
\DoxyCodeLine{390 }
\DoxyCodeLine{391      uint16\_t autovibrato\_ticks;}
\DoxyCodeLine{392 }
\DoxyCodeLine{393      \textcolor{keywordtype}{bool} sustained;}
\DoxyCodeLine{394      \textcolor{keywordtype}{float} fadeout\_volume;}
\DoxyCodeLine{395      \textcolor{keywordtype}{float} volume\_envelope\_volume;}
\DoxyCodeLine{396      \textcolor{keywordtype}{float} panning\_envelope\_panning;}
\DoxyCodeLine{397      uint16\_t volume\_envelope\_frame\_count;}
\DoxyCodeLine{398      uint16\_t panning\_envelope\_frame\_count;}
\DoxyCodeLine{399 }
\DoxyCodeLine{400      \textcolor{keywordtype}{float} autovibrato\_note\_offset;}
\DoxyCodeLine{401 }
\DoxyCodeLine{402      \textcolor{keywordtype}{bool} arp\_in\_progress;}
\DoxyCodeLine{403      uint8\_t arp\_note\_offset;}
\DoxyCodeLine{404      uint8\_t volume\_slide\_param;}
\DoxyCodeLine{405      uint8\_t fine\_volume\_slide\_param;}
\DoxyCodeLine{406      uint8\_t global\_volume\_slide\_param;}
\DoxyCodeLine{407      uint8\_t panning\_slide\_param;}
\DoxyCodeLine{408      uint8\_t portamento\_up\_param;}
\DoxyCodeLine{409      uint8\_t portamento\_down\_param;}
\DoxyCodeLine{410      uint8\_t fine\_portamento\_up\_param;}
\DoxyCodeLine{411      uint8\_t fine\_portamento\_down\_param;}
\DoxyCodeLine{412      uint8\_t extra\_fine\_portamento\_up\_param;}
\DoxyCodeLine{413      uint8\_t extra\_fine\_portamento\_down\_param;}
\DoxyCodeLine{414      uint8\_t tone\_portamento\_param;}
\DoxyCodeLine{415      \textcolor{keywordtype}{float} tone\_portamento\_target\_period;}
\DoxyCodeLine{416      uint8\_t multi\_retrig\_param;}
\DoxyCodeLine{417      uint8\_t note\_delay\_param;}
\DoxyCodeLine{418      uint8\_t pattern\_loop\_origin; \textcolor{comment}{/* Where to restart a E6y loop */}}
\DoxyCodeLine{419      uint8\_t pattern\_loop\_count; \textcolor{comment}{/* How many loop passes have been done */}}
\DoxyCodeLine{420      \textcolor{keywordtype}{bool} vibrato\_in\_progress;}
\DoxyCodeLine{421      jar\_xm\_waveform\_type\_t vibrato\_waveform;}
\DoxyCodeLine{422      \textcolor{keywordtype}{bool} vibrato\_waveform\_retrigger; \textcolor{comment}{/* True if a new note retriggers the waveform */}}
\DoxyCodeLine{423      uint8\_t vibrato\_param;}
\DoxyCodeLine{424      uint16\_t vibrato\_ticks; \textcolor{comment}{/* Position in the waveform */}}
\DoxyCodeLine{425      \textcolor{keywordtype}{float} vibrato\_note\_offset;}
\DoxyCodeLine{426      jar\_xm\_waveform\_type\_t tremolo\_waveform;}
\DoxyCodeLine{427      \textcolor{keywordtype}{bool} tremolo\_waveform\_retrigger;}
\DoxyCodeLine{428      uint8\_t tremolo\_param;}
\DoxyCodeLine{429      uint8\_t tremolo\_ticks;}
\DoxyCodeLine{430      \textcolor{keywordtype}{float} tremolo\_volume;}
\DoxyCodeLine{431      uint8\_t tremor\_param;}
\DoxyCodeLine{432      \textcolor{keywordtype}{bool} tremor\_on;}
\DoxyCodeLine{433 }
\DoxyCodeLine{434      uint64\_t latest\_trigger;}
\DoxyCodeLine{435      \textcolor{keywordtype}{bool} muted;}
\DoxyCodeLine{436 }
\DoxyCodeLine{437      \textcolor{comment}{//* These values are updated at the end of each tick, to save a couple of float operations on every generated sample.}}
\DoxyCodeLine{438      \textcolor{keywordtype}{float} target\_panning;}
\DoxyCodeLine{439      \textcolor{keywordtype}{float} target\_volume;}
\DoxyCodeLine{440 }
\DoxyCodeLine{441      \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} frame\_count;}
\DoxyCodeLine{442      \textcolor{keywordtype}{float} end\_of\_previous\_sample\_left[jar\_xm\_SAMPLE\_RAMPING\_POINTS];}
\DoxyCodeLine{443      \textcolor{keywordtype}{float} end\_of\_previous\_sample\_right[jar\_xm\_SAMPLE\_RAMPING\_POINTS];}
\DoxyCodeLine{444      \textcolor{keywordtype}{float} curr\_left;}
\DoxyCodeLine{445      \textcolor{keywordtype}{float} curr\_right;}
\DoxyCodeLine{446 }
\DoxyCodeLine{447      \textcolor{keywordtype}{float} actual\_panning;}
\DoxyCodeLine{448      \textcolor{keywordtype}{float} actual\_volume;}
\DoxyCodeLine{449  \};}
\DoxyCodeLine{450  \textcolor{keyword}{typedef} \textcolor{keyword}{struct }jar\_xm\_channel\_context\_s jar\_xm\_channel\_context\_t;}
\DoxyCodeLine{451 }
\DoxyCodeLine{452  \textcolor{keyword}{struct }jar\_xm\_context\_s \{}
\DoxyCodeLine{453      \textcolor{keywordtype}{void}* allocated\_memory;}
\DoxyCodeLine{454      jar\_xm\_module\_t \mbox{\hyperlink{structmodule}{module}};}
\DoxyCodeLine{455      uint32\_t rate;}
\DoxyCodeLine{456 }
\DoxyCodeLine{457      uint16\_t default\_tempo; \textcolor{comment}{// Number of ticks per row}}
\DoxyCodeLine{458      uint16\_t default\_bpm;}
\DoxyCodeLine{459      \textcolor{keywordtype}{float} default\_global\_volume;}
\DoxyCodeLine{460 }
\DoxyCodeLine{461      uint16\_t tempo; \textcolor{comment}{// Number of ticks per row}}
\DoxyCodeLine{462      uint16\_t bpm;}
\DoxyCodeLine{463      \textcolor{keywordtype}{float} global\_volume;}
\DoxyCodeLine{464 }
\DoxyCodeLine{465      \textcolor{keywordtype}{float} volume\_ramp; \textcolor{comment}{/* How much is a channel final volume allowed to change per sample; this is used to avoid abrubt volume changes which manifest as "{}clicks"{} in the generated sound. */}}
\DoxyCodeLine{466      \textcolor{keywordtype}{float} panning\_ramp; \textcolor{comment}{/* Same for panning. */}}
\DoxyCodeLine{467 }
\DoxyCodeLine{468      uint8\_t current\_table\_index;}
\DoxyCodeLine{469      uint8\_t current\_row;}
\DoxyCodeLine{470      uint16\_t current\_tick; \textcolor{comment}{/* Can go below 255, with high tempo and a pattern delay */}}
\DoxyCodeLine{471      \textcolor{keywordtype}{float} remaining\_samples\_in\_tick;}
\DoxyCodeLine{472      uint64\_t generated\_samples;}
\DoxyCodeLine{473 }
\DoxyCodeLine{474      \textcolor{keywordtype}{bool} position\_jump;}
\DoxyCodeLine{475      \textcolor{keywordtype}{bool} pattern\_break;}
\DoxyCodeLine{476      uint8\_t jump\_dest;}
\DoxyCodeLine{477      uint8\_t jump\_row;}
\DoxyCodeLine{478 }
\DoxyCodeLine{479      uint16\_t extra\_ticks; \textcolor{comment}{/* Extra ticks to be played before going to the next row -\/ Used for EEy effect */}}
\DoxyCodeLine{480 }
\DoxyCodeLine{481      uint8\_t* row\_loop\_count; \textcolor{comment}{/* Array of size MAX\_NUM\_ROWS * module\_length */}}
\DoxyCodeLine{482      uint8\_t loop\_count;}
\DoxyCodeLine{483      uint8\_t max\_loop\_count;}
\DoxyCodeLine{484 }
\DoxyCodeLine{485      jar\_xm\_channel\_context\_t* channels;}
\DoxyCodeLine{486 \};}
\DoxyCodeLine{487 }
\DoxyCodeLine{488 \textcolor{preprocessor}{\#if JAR\_XM\_DEFENSIVE}}
\DoxyCodeLine{489 }
\DoxyCodeLine{490 \textcolor{comment}{//** Check the module data for errors/inconsistencies.}}
\DoxyCodeLine{491 \textcolor{comment}{// * @returns 0 if everything looks OK. Module should be safe to load.}}
\DoxyCodeLine{492 \textcolor{keywordtype}{int} jar\_xm\_check\_sanity\_preload(\textcolor{keyword}{const} \textcolor{keywordtype}{char}*, \textcolor{keywordtype}{size\_t});}
\DoxyCodeLine{493 }
\DoxyCodeLine{494 \textcolor{comment}{//** Check a loaded module for errors/inconsistencies.}}
\DoxyCodeLine{495 \textcolor{comment}{// * @returns 0 if everything looks OK.}}
\DoxyCodeLine{496 \textcolor{keywordtype}{int} jar\_xm\_check\_sanity\_postload(jar\_xm\_context\_t*);}
\DoxyCodeLine{497 }
\DoxyCodeLine{498 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{499 }
\DoxyCodeLine{500 \textcolor{comment}{//** Get the number of bytes needed to store the module data in a dynamically allocated blank context.}}
\DoxyCodeLine{501 \textcolor{comment}{// * Things that are dynamically allocated:}}
\DoxyCodeLine{502 \textcolor{comment}{// * -\/ sample data}}
\DoxyCodeLine{503 \textcolor{comment}{// * -\/ sample structures in instruments}}
\DoxyCodeLine{504 \textcolor{comment}{// * -\/ pattern data}}
\DoxyCodeLine{505 \textcolor{comment}{// * -\/ row loop count arrays}}
\DoxyCodeLine{506 \textcolor{comment}{// * -\/ pattern structures in module}}
\DoxyCodeLine{507 \textcolor{comment}{// * -\/ instrument structures in module}}
\DoxyCodeLine{508 \textcolor{comment}{// * -\/ channel contexts}}
\DoxyCodeLine{509 \textcolor{comment}{// * -\/ context structure itself}}
\DoxyCodeLine{510 \textcolor{comment}{// * @returns 0 if everything looks OK.}}
\DoxyCodeLine{511 \textcolor{keywordtype}{size\_t} jar\_xm\_get\_memory\_needed\_for\_context(\textcolor{keyword}{const} \textcolor{keywordtype}{char}*, \textcolor{keywordtype}{size\_t});}
\DoxyCodeLine{512 }
\DoxyCodeLine{513 \textcolor{comment}{//** Populate the context from module data.}}
\DoxyCodeLine{514 \textcolor{comment}{// * @returns pointer to the memory pool}}
\DoxyCodeLine{515 \textcolor{keywordtype}{char}* jar\_xm\_load\_module(jar\_xm\_context\_t*, \textcolor{keyword}{const} \textcolor{keywordtype}{char}*, \textcolor{keywordtype}{size\_t}, \textcolor{keywordtype}{char}*);}
\DoxyCodeLine{516 }
\DoxyCodeLine{517 \textcolor{keywordtype}{int} jar\_xm\_create\_context(jar\_xm\_context\_t** ctxp, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* moddata, uint32\_t rate) \{}
\DoxyCodeLine{518     \textcolor{keywordflow}{return} jar\_xm\_create\_context\_safe(ctxp, moddata, SIZE\_MAX, rate);}
\DoxyCodeLine{519 \}}
\DoxyCodeLine{520 }
\DoxyCodeLine{521 \textcolor{preprocessor}{\#define ALIGN(x, b) (((x) + ((b) -\/ 1)) \& \string~((b) -\/ 1))}}
\DoxyCodeLine{522 \textcolor{preprocessor}{\#define ALIGN\_PTR(x, b) (void*)(((uintptr\_t)(x) + ((b) -\/ 1)) \& \string~((b) -\/ 1))}}
\DoxyCodeLine{523 \textcolor{keywordtype}{int} jar\_xm\_create\_context\_safe(jar\_xm\_context\_t** ctxp, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* moddata, \textcolor{keywordtype}{size\_t} moddata\_length, uint32\_t rate) \{}
\DoxyCodeLine{524 \textcolor{preprocessor}{\#if JAR\_XM\_DEFENSIVE}}
\DoxyCodeLine{525     \textcolor{keywordtype}{int} ret;}
\DoxyCodeLine{526 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{527     \textcolor{keywordtype}{size\_t} bytes\_needed;}
\DoxyCodeLine{528     \textcolor{keywordtype}{char}* mempool;}
\DoxyCodeLine{529     jar\_xm\_context\_t* ctx;}
\DoxyCodeLine{530 }
\DoxyCodeLine{531 \textcolor{preprocessor}{\#if JAR\_XM\_DEFENSIVE}}
\DoxyCodeLine{532     \textcolor{keywordflow}{if}((ret = jar\_xm\_check\_sanity\_preload(moddata, moddata\_length))) \{}
\DoxyCodeLine{533         DEBUG(\textcolor{stringliteral}{"{}jar\_xm\_check\_sanity\_preload() returned \%i, module is not safe to load"{}}, ret);}
\DoxyCodeLine{534         \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{535     \}}
\DoxyCodeLine{536 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{537 }
\DoxyCodeLine{538     bytes\_needed = jar\_xm\_get\_memory\_needed\_for\_context(moddata, moddata\_length);}
\DoxyCodeLine{539     mempool = JARXM\_MALLOC(bytes\_needed);}
\DoxyCodeLine{540     \textcolor{keywordflow}{if}(mempool == NULL \&\& bytes\_needed > 0) \{ \textcolor{comment}{/* JARXM\_MALLOC() failed, trouble ahead */}}
\DoxyCodeLine{541         DEBUG(\textcolor{stringliteral}{"{}call to JARXM\_MALLOC() failed, returned \%p"{}}, (\textcolor{keywordtype}{void}*)mempool);}
\DoxyCodeLine{542         \textcolor{keywordflow}{return} 2;}
\DoxyCodeLine{543     \}}
\DoxyCodeLine{544 }
\DoxyCodeLine{545     \textcolor{comment}{/* Initialize most of the fields to 0, 0.f, NULL or false depending on type */}}
\DoxyCodeLine{546     memset(mempool, 0, bytes\_needed);}
\DoxyCodeLine{547 }
\DoxyCodeLine{548     ctx = (*ctxp = (jar\_xm\_context\_t *)mempool);}
\DoxyCodeLine{549     ctx-\/>allocated\_memory = mempool; \textcolor{comment}{/* Keep original pointer for JARXM\_FREE() */}}
\DoxyCodeLine{550     mempool += \textcolor{keyword}{sizeof}(jar\_xm\_context\_t);}
\DoxyCodeLine{551 }
\DoxyCodeLine{552     ctx-\/>rate = rate;}
\DoxyCodeLine{553     mempool = jar\_xm\_load\_module(ctx, moddata, moddata\_length, mempool);}
\DoxyCodeLine{554     mempool = ALIGN\_PTR(mempool, 16);}
\DoxyCodeLine{555 }
\DoxyCodeLine{556     ctx-\/>channels = (jar\_xm\_channel\_context\_t*)mempool;}
\DoxyCodeLine{557     mempool += ctx-\/>module.num\_channels * \textcolor{keyword}{sizeof}(jar\_xm\_channel\_context\_t);}
\DoxyCodeLine{558     mempool = ALIGN\_PTR(mempool, 16);}
\DoxyCodeLine{559 }
\DoxyCodeLine{560     ctx-\/>default\_global\_volume = 1.f;}
\DoxyCodeLine{561     ctx-\/>global\_volume = ctx-\/>default\_global\_volume;}
\DoxyCodeLine{562 }
\DoxyCodeLine{563     ctx-\/>volume\_ramp = (1.f / 128.f);}
\DoxyCodeLine{564     ctx-\/>panning\_ramp = (1.f / 128.f);}
\DoxyCodeLine{565 }
\DoxyCodeLine{566     \textcolor{keywordflow}{for}(uint8\_t i = 0; i < ctx-\/>module.num\_channels; ++i) \{}
\DoxyCodeLine{567         jar\_xm\_channel\_context\_t *ch = ctx-\/>channels + i;}
\DoxyCodeLine{568         ch-\/>ping = \textcolor{keyword}{true};}
\DoxyCodeLine{569         ch-\/>vibrato\_waveform = jar\_xm\_SINE\_WAVEFORM;}
\DoxyCodeLine{570         ch-\/>vibrato\_waveform\_retrigger = \textcolor{keyword}{true};}
\DoxyCodeLine{571         ch-\/>tremolo\_waveform = jar\_xm\_SINE\_WAVEFORM;}
\DoxyCodeLine{572         ch-\/>tremolo\_waveform\_retrigger = \textcolor{keyword}{true};}
\DoxyCodeLine{573         ch-\/>volume = ch-\/>volume\_envelope\_volume = ch-\/>fadeout\_volume = 1.0f;}
\DoxyCodeLine{574         ch-\/>panning = ch-\/>panning\_envelope\_panning = .5f;}
\DoxyCodeLine{575         ch-\/>actual\_volume = .0f;}
\DoxyCodeLine{576         ch-\/>actual\_panning = .5f;}
\DoxyCodeLine{577     \}}
\DoxyCodeLine{578 }
\DoxyCodeLine{579     mempool = ALIGN\_PTR(mempool, 16);}
\DoxyCodeLine{580     ctx-\/>row\_loop\_count = (uint8\_t *)mempool;}
\DoxyCodeLine{581     mempool += MAX\_NUM\_ROWS * \textcolor{keyword}{sizeof}(uint8\_t);}
\DoxyCodeLine{582 }
\DoxyCodeLine{583 \textcolor{preprocessor}{\#if JAR\_XM\_DEFENSIVE}}
\DoxyCodeLine{584     \textcolor{keywordflow}{if}((ret = jar\_xm\_check\_sanity\_postload(ctx))) \{   DEBUG(\textcolor{stringliteral}{"{}jar\_xm\_check\_sanity\_postload() returned \%i, module is not safe to play"{}}, ret);}
\DoxyCodeLine{585         jar\_xm\_free\_context(ctx);}
\DoxyCodeLine{586         \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{587     \}}
\DoxyCodeLine{588 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{589 }
\DoxyCodeLine{590     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{591 \}}
\DoxyCodeLine{592 }
\DoxyCodeLine{593 \textcolor{keywordtype}{void} jar\_xm\_free\_context(jar\_xm\_context\_t *ctx) \{}
\DoxyCodeLine{594     \textcolor{keywordflow}{if} (ctx != NULL) \{   JARXM\_FREE(ctx-\/>allocated\_memory); \}}
\DoxyCodeLine{595 \}}
\DoxyCodeLine{596 }
\DoxyCodeLine{597 \textcolor{keywordtype}{void} jar\_xm\_set\_max\_loop\_count(jar\_xm\_context\_t *ctx, uint8\_t loopcnt) \{}
\DoxyCodeLine{598     ctx-\/>max\_loop\_count = loopcnt;}
\DoxyCodeLine{599 \}}
\DoxyCodeLine{600 }
\DoxyCodeLine{601 uint8\_t jar\_xm\_get\_loop\_count(jar\_xm\_context\_t *ctx) \{}
\DoxyCodeLine{602     \textcolor{keywordflow}{return} ctx-\/>loop\_count;}
\DoxyCodeLine{603 \}}
\DoxyCodeLine{604 }
\DoxyCodeLine{605 \textcolor{keywordtype}{bool} jar\_xm\_mute\_channel(jar\_xm\_context\_t *ctx, uint16\_t \mbox{\hyperlink{structchannel}{channel}}, \textcolor{keywordtype}{bool} mute) \{}
\DoxyCodeLine{606     \textcolor{keywordtype}{bool} old = ctx-\/>channels[\mbox{\hyperlink{structchannel}{channel}} -\/ 1].muted;}
\DoxyCodeLine{607     ctx-\/>channels[\mbox{\hyperlink{structchannel}{channel}} -\/ 1].muted = mute;}
\DoxyCodeLine{608     \textcolor{keywordflow}{return} old;}
\DoxyCodeLine{609 \}}
\DoxyCodeLine{610 }
\DoxyCodeLine{611 \textcolor{keywordtype}{bool} jar\_xm\_mute\_instrument(jar\_xm\_context\_t *ctx, uint16\_t instr, \textcolor{keywordtype}{bool} mute) \{}
\DoxyCodeLine{612     \textcolor{keywordtype}{bool} old = ctx-\/>module.instruments[instr -\/ 1].muted;}
\DoxyCodeLine{613     ctx-\/>module.instruments[instr -\/ 1].muted = mute;}
\DoxyCodeLine{614     \textcolor{keywordflow}{return} old;}
\DoxyCodeLine{615 \}}
\DoxyCodeLine{616 }
\DoxyCodeLine{617 \textcolor{keyword}{const} \textcolor{keywordtype}{char}* jar\_xm\_get\_module\_name(jar\_xm\_context\_t *ctx) \{}
\DoxyCodeLine{618     \textcolor{keywordflow}{return} ctx-\/>module.name;}
\DoxyCodeLine{619 \}}
\DoxyCodeLine{620 }
\DoxyCodeLine{621 \textcolor{keyword}{const} \textcolor{keywordtype}{char}* jar\_xm\_get\_tracker\_name(jar\_xm\_context\_t *ctx) \{}
\DoxyCodeLine{622     \textcolor{keywordflow}{return} ctx-\/>module.trackername;}
\DoxyCodeLine{623 \}}
\DoxyCodeLine{624 }
\DoxyCodeLine{625 uint16\_t jar\_xm\_get\_number\_of\_channels(jar\_xm\_context\_t *ctx) \{}
\DoxyCodeLine{626     \textcolor{keywordflow}{return} ctx-\/>module.num\_channels;}
\DoxyCodeLine{627 \}}
\DoxyCodeLine{628 }
\DoxyCodeLine{629 uint16\_t jar\_xm\_get\_module\_length(jar\_xm\_context\_t *ctx) \{}
\DoxyCodeLine{630     \textcolor{keywordflow}{return} ctx-\/>module.length;}
\DoxyCodeLine{631 \}}
\DoxyCodeLine{632 }
\DoxyCodeLine{633 uint16\_t jar\_xm\_get\_number\_of\_patterns(jar\_xm\_context\_t *ctx) \{}
\DoxyCodeLine{634     \textcolor{keywordflow}{return} ctx-\/>module.num\_patterns;}
\DoxyCodeLine{635 \}}
\DoxyCodeLine{636 }
\DoxyCodeLine{637 uint16\_t jar\_xm\_get\_number\_of\_rows(jar\_xm\_context\_t *ctx, uint16\_t pattern) \{}
\DoxyCodeLine{638     \textcolor{keywordflow}{return} ctx-\/>module.patterns[pattern].num\_rows;}
\DoxyCodeLine{639 \}}
\DoxyCodeLine{640 }
\DoxyCodeLine{641 uint16\_t jar\_xm\_get\_number\_of\_instruments(jar\_xm\_context\_t *ctx) \{}
\DoxyCodeLine{642     \textcolor{keywordflow}{return} ctx-\/>module.num\_instruments;}
\DoxyCodeLine{643 \}}
\DoxyCodeLine{644 }
\DoxyCodeLine{645 uint16\_t jar\_xm\_get\_number\_of\_samples(jar\_xm\_context\_t *ctx, uint16\_t instrument) \{}
\DoxyCodeLine{646     \textcolor{keywordflow}{return} ctx-\/>module.instruments[instrument -\/ 1].num\_samples;}
\DoxyCodeLine{647 \}}
\DoxyCodeLine{648 }
\DoxyCodeLine{649 \textcolor{keywordtype}{void} jar\_xm\_get\_playing\_speed(jar\_xm\_context\_t *ctx, uint16\_t *bpm, uint16\_t *tempo) \{}
\DoxyCodeLine{650     \textcolor{keywordflow}{if}(bpm) *bpm = ctx-\/>bpm;}
\DoxyCodeLine{651     \textcolor{keywordflow}{if}(tempo) *tempo = ctx-\/>tempo;}
\DoxyCodeLine{652 \}}
\DoxyCodeLine{653 }
\DoxyCodeLine{654 \textcolor{keywordtype}{void} jar\_xm\_get\_position(jar\_xm\_context\_t *ctx, uint8\_t *pattern\_index, uint8\_t *pattern, uint8\_t *row, uint64\_t *samples) \{}
\DoxyCodeLine{655     \textcolor{keywordflow}{if}(pattern\_index) *pattern\_index = ctx-\/>current\_table\_index;}
\DoxyCodeLine{656     \textcolor{keywordflow}{if}(pattern) *pattern = ctx-\/>module.pattern\_table[ctx-\/>current\_table\_index];}
\DoxyCodeLine{657     \textcolor{keywordflow}{if}(row) *row = ctx-\/>current\_row;}
\DoxyCodeLine{658     \textcolor{keywordflow}{if}(samples) *samples = ctx-\/>generated\_samples;}
\DoxyCodeLine{659 \}}
\DoxyCodeLine{660 }
\DoxyCodeLine{661 uint64\_t jar\_xm\_get\_latest\_trigger\_of\_instrument(jar\_xm\_context\_t *ctx, uint16\_t instr) \{}
\DoxyCodeLine{662     \textcolor{keywordflow}{return} ctx-\/>module.instruments[instr -\/ 1].latest\_trigger;}
\DoxyCodeLine{663 \}}
\DoxyCodeLine{664 }
\DoxyCodeLine{665 uint64\_t jar\_xm\_get\_latest\_trigger\_of\_sample(jar\_xm\_context\_t *ctx, uint16\_t instr, uint16\_t \mbox{\hyperlink{structsample}{sample}}) \{}
\DoxyCodeLine{666     \textcolor{keywordflow}{return} ctx-\/>module.instruments[instr -\/ 1].samples[\mbox{\hyperlink{structsample}{sample}}].latest\_trigger;}
\DoxyCodeLine{667 \}}
\DoxyCodeLine{668 }
\DoxyCodeLine{669 uint64\_t jar\_xm\_get\_latest\_trigger\_of\_channel(jar\_xm\_context\_t *ctx, uint16\_t chn) \{}
\DoxyCodeLine{670     \textcolor{keywordflow}{return} ctx-\/>channels[chn -\/ 1].latest\_trigger;}
\DoxyCodeLine{671 \}}
\DoxyCodeLine{672 }
\DoxyCodeLine{673 \textcolor{comment}{//* .xm files are little-\/endian. (XXX: Are they really?)}}
\DoxyCodeLine{674 }
\DoxyCodeLine{675 \textcolor{comment}{//* Bound reader macros.}}
\DoxyCodeLine{676 \textcolor{comment}{//* If we attempt to read the buffer out-\/of-\/bounds, pretend that the buffer is infinitely padded with zeroes.}}
\DoxyCodeLine{677 \textcolor{preprocessor}{\#define READ\_U8(offset) (((offset) < moddata\_length) ? (*(uint8\_t*)(moddata + (offset))) : 0)}}
\DoxyCodeLine{678 \textcolor{preprocessor}{\#define READ\_U16(offset) ((uint16\_t)READ\_U8(offset) | ((uint16\_t)READ\_U8((offset) + 1) << 8))}}
\DoxyCodeLine{679 \textcolor{preprocessor}{\#define READ\_U32(offset) ((uint32\_t)READ\_U16(offset) | ((uint32\_t)READ\_U16((offset) + 2) << 16))}}
\DoxyCodeLine{680 \textcolor{preprocessor}{\#define READ\_MEMCPY(ptr, offset, length) memcpy\_pad(ptr, length, moddata, moddata\_length, offset)}}
\DoxyCodeLine{681 }
\DoxyCodeLine{682 \textcolor{keyword}{static} \textcolor{keywordtype}{void} memcpy\_pad(\textcolor{keywordtype}{void} *dst, \textcolor{keywordtype}{size\_t} dst\_len, \textcolor{keyword}{const} \textcolor{keywordtype}{void} *src, \textcolor{keywordtype}{size\_t} src\_len, \textcolor{keywordtype}{size\_t} offset) \{}
\DoxyCodeLine{683     uint8\_t *dst\_c = dst;}
\DoxyCodeLine{684     \textcolor{keyword}{const} uint8\_t *src\_c = src;}
\DoxyCodeLine{685 }
\DoxyCodeLine{686     \textcolor{comment}{/* how many bytes can be copied without overrunning `src` */}}
\DoxyCodeLine{687     \textcolor{keywordtype}{size\_t} copy\_bytes = (src\_len >= offset) ? (src\_len -\/ offset) : 0;}
\DoxyCodeLine{688     copy\_bytes = copy\_bytes > dst\_len ? dst\_len : copy\_bytes;}
\DoxyCodeLine{689 }
\DoxyCodeLine{690     memcpy(dst\_c, src\_c + offset, copy\_bytes);}
\DoxyCodeLine{691     \textcolor{comment}{/* padded bytes */}}
\DoxyCodeLine{692     memset(dst\_c + copy\_bytes, 0, dst\_len -\/ copy\_bytes);}
\DoxyCodeLine{693 \}}
\DoxyCodeLine{694 }
\DoxyCodeLine{695 \textcolor{preprocessor}{\#if JAR\_XM\_DEFENSIVE}}
\DoxyCodeLine{696 }
\DoxyCodeLine{697 \textcolor{keywordtype}{int} jar\_xm\_check\_sanity\_preload(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* \mbox{\hyperlink{structmodule}{module}}, \textcolor{keywordtype}{size\_t} module\_length) \{}
\DoxyCodeLine{698     \textcolor{keywordflow}{if}(module\_length < 60) \{ \textcolor{keywordflow}{return} 4; \}}
\DoxyCodeLine{699     \textcolor{keywordflow}{if}(memcmp(\textcolor{stringliteral}{"{}Extended Module: "{}}, \mbox{\hyperlink{structmodule}{module}}, 17) != 0) \{ \textcolor{keywordflow}{return} 1; \}}
\DoxyCodeLine{700     \textcolor{keywordflow}{if}(\mbox{\hyperlink{structmodule}{module}}[37] != 0x1A) \{ \textcolor{keywordflow}{return} 2; \}}
\DoxyCodeLine{701     \textcolor{keywordflow}{if}(\mbox{\hyperlink{structmodule}{module}}[59] != 0x01 || \mbox{\hyperlink{structmodule}{module}}[58] != 0x04) \{ \textcolor{keywordflow}{return} 3; \}  \textcolor{comment}{/* Not XM 1.04 */}}
\DoxyCodeLine{702     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{703 \}}
\DoxyCodeLine{704 }
\DoxyCodeLine{705 \textcolor{keywordtype}{int} jar\_xm\_check\_sanity\_postload(jar\_xm\_context\_t* ctx) \{}
\DoxyCodeLine{706     \textcolor{comment}{/* Check the POT */}}
\DoxyCodeLine{707     \textcolor{keywordflow}{for}(uint8\_t i = 0; i < ctx-\/>module.length; ++i) \{}
\DoxyCodeLine{708         \textcolor{keywordflow}{if}(ctx-\/>module.pattern\_table[i] >= ctx-\/>module.num\_patterns) \{}
\DoxyCodeLine{709             \textcolor{keywordflow}{if}(i+1 == ctx-\/>module.length \&\& ctx-\/>module.length > 1) \{}
\DoxyCodeLine{710                 DEBUG(\textcolor{stringliteral}{"{}trimming invalid POT at pos \%X"{}}, i);}
\DoxyCodeLine{711                 -\/-\/ctx-\/>module.length;}
\DoxyCodeLine{712             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{713                 DEBUG(\textcolor{stringliteral}{"{}module has invalid POT, pos \%X references nonexistent pattern \%X"{}}, i, ctx-\/>module.pattern\_table[i]);}
\DoxyCodeLine{714                 \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{715             \}}
\DoxyCodeLine{716         \}}
\DoxyCodeLine{717     \}}
\DoxyCodeLine{718 }
\DoxyCodeLine{719     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{720 \}}
\DoxyCodeLine{721 }
\DoxyCodeLine{722 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{723 }
\DoxyCodeLine{724 \textcolor{keywordtype}{size\_t} jar\_xm\_get\_memory\_needed\_for\_context(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* moddata, \textcolor{keywordtype}{size\_t} moddata\_length) \{}
\DoxyCodeLine{725     \textcolor{keywordtype}{size\_t} memory\_needed = 0;}
\DoxyCodeLine{726     \textcolor{keywordtype}{size\_t} offset = 60; \textcolor{comment}{/* 60 = Skip the first header */}}
\DoxyCodeLine{727     uint16\_t num\_channels;}
\DoxyCodeLine{728     uint16\_t num\_patterns;}
\DoxyCodeLine{729     uint16\_t num\_instruments;}
\DoxyCodeLine{730 }
\DoxyCodeLine{731     \textcolor{comment}{/* Read the module header */}}
\DoxyCodeLine{732     num\_channels = READ\_U16(offset + 8);}
\DoxyCodeLine{733     num\_patterns = READ\_U16(offset + 10);}
\DoxyCodeLine{734     memory\_needed += num\_patterns * \textcolor{keyword}{sizeof}(jar\_xm\_pattern\_t);}
\DoxyCodeLine{735     memory\_needed  = ALIGN(memory\_needed, 16);}
\DoxyCodeLine{736     num\_instruments = READ\_U16(offset + 12);}
\DoxyCodeLine{737     memory\_needed += num\_instruments * \textcolor{keyword}{sizeof}(jar\_xm\_instrument\_t);}
\DoxyCodeLine{738     memory\_needed  = ALIGN(memory\_needed, 16);}
\DoxyCodeLine{739     memory\_needed += MAX\_NUM\_ROWS * READ\_U16(offset + 4) * \textcolor{keyword}{sizeof}(uint8\_t); \textcolor{comment}{/* Module length */}}
\DoxyCodeLine{740 }
\DoxyCodeLine{741     offset += READ\_U32(offset); \textcolor{comment}{/* Header size */}}
\DoxyCodeLine{742 }
\DoxyCodeLine{743     \textcolor{comment}{/* Read pattern headers */}}
\DoxyCodeLine{744     \textcolor{keywordflow}{for}(uint16\_t i = 0; i < num\_patterns; ++i) \{}
\DoxyCodeLine{745         uint16\_t num\_rows;}
\DoxyCodeLine{746         num\_rows = READ\_U16(offset + 5);}
\DoxyCodeLine{747         memory\_needed += num\_rows * num\_channels * \textcolor{keyword}{sizeof}(jar\_xm\_pattern\_slot\_t);}
\DoxyCodeLine{748         offset += READ\_U32(offset) + READ\_U16(offset + 7); \textcolor{comment}{/* Pattern header length + packed pattern data size */}}
\DoxyCodeLine{749     \}}
\DoxyCodeLine{750     memory\_needed  = ALIGN(memory\_needed, 16);}
\DoxyCodeLine{751 }
\DoxyCodeLine{752     \textcolor{comment}{/* Read instrument headers */}}
\DoxyCodeLine{753     \textcolor{keywordflow}{for}(uint16\_t i = 0; i < num\_instruments; ++i) \{}
\DoxyCodeLine{754         uint16\_t num\_samples;}
\DoxyCodeLine{755         uint32\_t sample\_header\_size = 0;}
\DoxyCodeLine{756         uint32\_t sample\_size\_aggregate = 0;}
\DoxyCodeLine{757         num\_samples = READ\_U16(offset + 27);}
\DoxyCodeLine{758         memory\_needed += num\_samples * \textcolor{keyword}{sizeof}(jar\_xm\_sample\_t);}
\DoxyCodeLine{759         \textcolor{keywordflow}{if}(num\_samples > 0) \{ sample\_header\_size = READ\_U32(offset + 29); \}}
\DoxyCodeLine{760 }
\DoxyCodeLine{761         offset += READ\_U32(offset);  \textcolor{comment}{/* Instrument header size */}}
\DoxyCodeLine{762         \textcolor{keywordflow}{for}(uint16\_t j = 0; j < num\_samples; ++j) \{}
\DoxyCodeLine{763             uint32\_t sample\_size;}
\DoxyCodeLine{764             uint8\_t flags;}
\DoxyCodeLine{765             sample\_size = READ\_U32(offset);}
\DoxyCodeLine{766             flags = READ\_U8(offset + 14);}
\DoxyCodeLine{767             sample\_size\_aggregate += sample\_size;}
\DoxyCodeLine{768 }
\DoxyCodeLine{769             \textcolor{keywordflow}{if}(flags \& (1 << 4)) \{  \textcolor{comment}{/* 16 bit sample */}}
\DoxyCodeLine{770                 memory\_needed += sample\_size * (\textcolor{keyword}{sizeof}(float) >> 1);}
\DoxyCodeLine{771             \} \textcolor{keywordflow}{else} \{  \textcolor{comment}{/* 8 bit sample */}}
\DoxyCodeLine{772                 memory\_needed += sample\_size * \textcolor{keyword}{sizeof}(float);}
\DoxyCodeLine{773             \}}
\DoxyCodeLine{774             offset += sample\_header\_size;}
\DoxyCodeLine{775         \}}
\DoxyCodeLine{776         offset += sample\_size\_aggregate;}
\DoxyCodeLine{777     \}}
\DoxyCodeLine{778 }
\DoxyCodeLine{779     memory\_needed += num\_channels * \textcolor{keyword}{sizeof}(jar\_xm\_channel\_context\_t);}
\DoxyCodeLine{780     memory\_needed += \textcolor{keyword}{sizeof}(jar\_xm\_context\_t);}
\DoxyCodeLine{781     \textcolor{keywordflow}{return} memory\_needed;}
\DoxyCodeLine{782 \}}
\DoxyCodeLine{783 }
\DoxyCodeLine{784 \textcolor{keywordtype}{char}* jar\_xm\_load\_module(jar\_xm\_context\_t* ctx, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* moddata, \textcolor{keywordtype}{size\_t} moddata\_length, \textcolor{keywordtype}{char}* mempool) \{}
\DoxyCodeLine{785     \textcolor{keywordtype}{size\_t} offset = 0;}
\DoxyCodeLine{786     jar\_xm\_module\_t* mod = \&(ctx-\/>module);}
\DoxyCodeLine{787 }
\DoxyCodeLine{788     \textcolor{comment}{/* Read XM header */}}
\DoxyCodeLine{789     READ\_MEMCPY(mod-\/>name, offset + 17, MODULE\_NAME\_LENGTH);}
\DoxyCodeLine{790     READ\_MEMCPY(mod-\/>trackername, offset + 38, TRACKER\_NAME\_LENGTH);}
\DoxyCodeLine{791     offset += 60;}
\DoxyCodeLine{792 }
\DoxyCodeLine{793     \textcolor{comment}{/* Read module header */}}
\DoxyCodeLine{794     uint32\_t header\_size = READ\_U32(offset);}
\DoxyCodeLine{795     mod-\/>length = READ\_U16(offset + 4);}
\DoxyCodeLine{796     mod-\/>restart\_position = READ\_U16(offset + 6);}
\DoxyCodeLine{797     mod-\/>num\_channels = READ\_U16(offset + 8);}
\DoxyCodeLine{798     mod-\/>num\_patterns = READ\_U16(offset + 10);}
\DoxyCodeLine{799     mod-\/>num\_instruments = READ\_U16(offset + 12);}
\DoxyCodeLine{800     mod-\/>patterns = (jar\_xm\_pattern\_t*)mempool;}
\DoxyCodeLine{801     mod-\/>linear\_interpolation = 1; \textcolor{comment}{// Linear interpolation can be set after loading}}
\DoxyCodeLine{802     mod-\/>ramping = 1; \textcolor{comment}{// ramping can be set after loading}}
\DoxyCodeLine{803     mempool += mod-\/>num\_patterns * \textcolor{keyword}{sizeof}(jar\_xm\_pattern\_t);}
\DoxyCodeLine{804     mempool = ALIGN\_PTR(mempool, 16);}
\DoxyCodeLine{805     mod-\/>instruments = (jar\_xm\_instrument\_t*)mempool;}
\DoxyCodeLine{806     mempool += mod-\/>num\_instruments * \textcolor{keyword}{sizeof}(jar\_xm\_instrument\_t);}
\DoxyCodeLine{807     mempool = ALIGN\_PTR(mempool, 16);}
\DoxyCodeLine{808     uint16\_t flags = READ\_U32(offset + 14);}
\DoxyCodeLine{809     mod-\/>frequency\_type = (flags \& (1 << 0)) ? jar\_xm\_LINEAR\_FREQUENCIES : jar\_xm\_AMIGA\_FREQUENCIES;}
\DoxyCodeLine{810     ctx-\/>default\_tempo = READ\_U16(offset + 16);}
\DoxyCodeLine{811     ctx-\/>default\_bpm = READ\_U16(offset + 18);}
\DoxyCodeLine{812     ctx-\/>tempo =ctx-\/>default\_tempo;}
\DoxyCodeLine{813     ctx-\/>bpm = ctx-\/>default\_bpm;}
\DoxyCodeLine{814 }
\DoxyCodeLine{815     READ\_MEMCPY(mod-\/>pattern\_table, offset + 20, PATTERN\_ORDER\_TABLE\_LENGTH);}
\DoxyCodeLine{816     offset += header\_size;}
\DoxyCodeLine{817 }
\DoxyCodeLine{818     \textcolor{comment}{/* Read patterns */}}
\DoxyCodeLine{819     \textcolor{keywordflow}{for}(uint16\_t i = 0; i < mod-\/>num\_patterns; ++i) \{}
\DoxyCodeLine{820         uint16\_t packed\_patterndata\_size = READ\_U16(offset + 7);}
\DoxyCodeLine{821         jar\_xm\_pattern\_t* pat = mod-\/>patterns + i;}
\DoxyCodeLine{822         pat-\/>num\_rows = READ\_U16(offset + 5);}
\DoxyCodeLine{823         pat-\/>slots = (jar\_xm\_pattern\_slot\_t*)mempool;}
\DoxyCodeLine{824         mempool += mod-\/>num\_channels * pat-\/>num\_rows * \textcolor{keyword}{sizeof}(jar\_xm\_pattern\_slot\_t);}
\DoxyCodeLine{825         offset += READ\_U32(offset); \textcolor{comment}{/* Pattern header length */}}
\DoxyCodeLine{826 }
\DoxyCodeLine{827         \textcolor{keywordflow}{if}(packed\_patterndata\_size == 0) \{    \textcolor{comment}{/* No pattern data is present */}}
\DoxyCodeLine{828             memset(pat-\/>slots, 0, \textcolor{keyword}{sizeof}(jar\_xm\_pattern\_slot\_t) * pat-\/>num\_rows * mod-\/>num\_channels);}
\DoxyCodeLine{829         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{830             \textcolor{comment}{/* This isn't your typical for loop */}}
\DoxyCodeLine{831             \textcolor{keywordflow}{for}(uint16\_t j = 0, k = 0; j < packed\_patterndata\_size; ++k) \{}
\DoxyCodeLine{832                 uint8\_t \mbox{\hyperlink{structnote}{note}} = READ\_U8(offset + j);}
\DoxyCodeLine{833                 jar\_xm\_pattern\_slot\_t* slot = pat-\/>slots + k;}
\DoxyCodeLine{834                 \textcolor{keywordflow}{if}(\mbox{\hyperlink{structnote}{note}} \& (1 << 7)) \{}
\DoxyCodeLine{835                     \textcolor{comment}{/* MSB is set, this is a compressed packet */}}
\DoxyCodeLine{836                     ++j;}
\DoxyCodeLine{837                     \textcolor{keywordflow}{if}(\mbox{\hyperlink{structnote}{note}} \& (1 << 0)) \{    \textcolor{comment}{/* Note follows */}}
\DoxyCodeLine{838                         slot-\/>note = READ\_U8(offset + j);}
\DoxyCodeLine{839                         ++j;}
\DoxyCodeLine{840                     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{841                         slot-\/>note = 0;}
\DoxyCodeLine{842                     \}}
\DoxyCodeLine{843                     \textcolor{keywordflow}{if}(\mbox{\hyperlink{structnote}{note}} \& (1 << 1)) \{    \textcolor{comment}{/* Instrument follows */}}
\DoxyCodeLine{844                         slot-\/>instrument = READ\_U8(offset + j);}
\DoxyCodeLine{845                         ++j;}
\DoxyCodeLine{846                     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{847                         slot-\/>instrument = 0;}
\DoxyCodeLine{848                     \}}
\DoxyCodeLine{849                     \textcolor{keywordflow}{if}(\mbox{\hyperlink{structnote}{note}} \& (1 << 2)) \{    \textcolor{comment}{/* Volume column follows */}}
\DoxyCodeLine{850                         slot-\/>volume\_column = READ\_U8(offset + j);}
\DoxyCodeLine{851                         ++j;}
\DoxyCodeLine{852                     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{853                         slot-\/>volume\_column = 0;}
\DoxyCodeLine{854                     \}}
\DoxyCodeLine{855                     \textcolor{keywordflow}{if}(\mbox{\hyperlink{structnote}{note}} \& (1 << 3)) \{    \textcolor{comment}{/* Effect follows */}}
\DoxyCodeLine{856                         slot-\/>effect\_type = READ\_U8(offset + j);}
\DoxyCodeLine{857                         ++j;}
\DoxyCodeLine{858                     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{859                         slot-\/>effect\_type = 0;}
\DoxyCodeLine{860                     \}}
\DoxyCodeLine{861                     \textcolor{keywordflow}{if}(\mbox{\hyperlink{structnote}{note}} \& (1 << 4)) \{    \textcolor{comment}{/* Effect parameter follows */}}
\DoxyCodeLine{862                         slot-\/>effect\_param = READ\_U8(offset + j);}
\DoxyCodeLine{863                         ++j;}
\DoxyCodeLine{864                     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{865                         slot-\/>effect\_param = 0;}
\DoxyCodeLine{866                     \}}
\DoxyCodeLine{867                 \} \textcolor{keywordflow}{else} \{    \textcolor{comment}{/* Uncompressed packet */}}
\DoxyCodeLine{868                     slot-\/>note = \mbox{\hyperlink{structnote}{note}};}
\DoxyCodeLine{869                     slot-\/>instrument = READ\_U8(offset + j + 1);}
\DoxyCodeLine{870                     slot-\/>volume\_column = READ\_U8(offset + j + 2);}
\DoxyCodeLine{871                     slot-\/>effect\_type = READ\_U8(offset + j + 3);}
\DoxyCodeLine{872                     slot-\/>effect\_param = READ\_U8(offset + j + 4);}
\DoxyCodeLine{873                     j += 5;}
\DoxyCodeLine{874                 \}}
\DoxyCodeLine{875             \}}
\DoxyCodeLine{876         \}}
\DoxyCodeLine{877 }
\DoxyCodeLine{878         offset += packed\_patterndata\_size;}
\DoxyCodeLine{879     \}}
\DoxyCodeLine{880     mempool = ALIGN\_PTR(mempool, 16);}
\DoxyCodeLine{881 }
\DoxyCodeLine{882     \textcolor{comment}{/* Read instruments */}}
\DoxyCodeLine{883     \textcolor{keywordflow}{for}(uint16\_t i = 0; i < ctx-\/>module.num\_instruments; ++i) \{}
\DoxyCodeLine{884         uint32\_t sample\_header\_size = 0;}
\DoxyCodeLine{885         jar\_xm\_instrument\_t* instr = mod-\/>instruments + i;}
\DoxyCodeLine{886 }
\DoxyCodeLine{887         READ\_MEMCPY(instr-\/>name, offset + 4, INSTRUMENT\_NAME\_LENGTH);}
\DoxyCodeLine{888         instr-\/>num\_samples = READ\_U16(offset + 27);}
\DoxyCodeLine{889 }
\DoxyCodeLine{890         \textcolor{keywordflow}{if}(instr-\/>num\_samples > 0) \{}
\DoxyCodeLine{891             \textcolor{comment}{/* Read extra header properties */}}
\DoxyCodeLine{892             sample\_header\_size = READ\_U32(offset + 29);}
\DoxyCodeLine{893             READ\_MEMCPY(instr-\/>sample\_of\_notes, offset + 33, NUM\_NOTES);}
\DoxyCodeLine{894 }
\DoxyCodeLine{895             instr-\/>volume\_envelope.num\_points = READ\_U8(offset + 225);}
\DoxyCodeLine{896             instr-\/>panning\_envelope.num\_points = READ\_U8(offset + 226);}
\DoxyCodeLine{897 }
\DoxyCodeLine{898             \textcolor{keywordflow}{for}(uint8\_t j = 0; j < instr-\/>volume\_envelope.num\_points; ++j) \{}
\DoxyCodeLine{899                 instr-\/>volume\_envelope.points[j].frame = READ\_U16(offset + 129 + 4 * j);}
\DoxyCodeLine{900                 instr-\/>volume\_envelope.points[j].value = READ\_U16(offset + 129 + 4 * j + 2);}
\DoxyCodeLine{901             \}}
\DoxyCodeLine{902 }
\DoxyCodeLine{903             \textcolor{keywordflow}{for}(uint8\_t j = 0; j < instr-\/>panning\_envelope.num\_points; ++j) \{}
\DoxyCodeLine{904                 instr-\/>panning\_envelope.points[j].frame = READ\_U16(offset + 177 + 4 * j);}
\DoxyCodeLine{905                 instr-\/>panning\_envelope.points[j].value = READ\_U16(offset + 177 + 4 * j + 2);}
\DoxyCodeLine{906             \}}
\DoxyCodeLine{907 }
\DoxyCodeLine{908             instr-\/>volume\_envelope.sustain\_point = READ\_U8(offset + 227);}
\DoxyCodeLine{909             instr-\/>volume\_envelope.loop\_start\_point = READ\_U8(offset + 228);}
\DoxyCodeLine{910             instr-\/>volume\_envelope.loop\_end\_point = READ\_U8(offset + 229);}
\DoxyCodeLine{911             instr-\/>panning\_envelope.sustain\_point = READ\_U8(offset + 230);}
\DoxyCodeLine{912             instr-\/>panning\_envelope.loop\_start\_point = READ\_U8(offset + 231);}
\DoxyCodeLine{913             instr-\/>panning\_envelope.loop\_end\_point = READ\_U8(offset + 232);}
\DoxyCodeLine{914 }
\DoxyCodeLine{915             uint8\_t flags = READ\_U8(offset + 233);}
\DoxyCodeLine{916             instr-\/>volume\_envelope.enabled = flags \& (1 << 0);}
\DoxyCodeLine{917             instr-\/>volume\_envelope.sustain\_enabled = flags \& (1 << 1);}
\DoxyCodeLine{918             instr-\/>volume\_envelope.loop\_enabled = flags \& (1 << 2);}
\DoxyCodeLine{919 }
\DoxyCodeLine{920             flags = READ\_U8(offset + 234);}
\DoxyCodeLine{921             instr-\/>panning\_envelope.enabled = flags \& (1 << 0);}
\DoxyCodeLine{922             instr-\/>panning\_envelope.sustain\_enabled = flags \& (1 << 1);}
\DoxyCodeLine{923             instr-\/>panning\_envelope.loop\_enabled = flags \& (1 << 2);}
\DoxyCodeLine{924             instr-\/>vibrato\_type = READ\_U8(offset + 235);}
\DoxyCodeLine{925             \textcolor{keywordflow}{if}(instr-\/>vibrato\_type == 2) \{}
\DoxyCodeLine{926                 instr-\/>vibrato\_type = 1;}
\DoxyCodeLine{927             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(instr-\/>vibrato\_type == 1) \{}
\DoxyCodeLine{928                 instr-\/>vibrato\_type = 2;}
\DoxyCodeLine{929             \}}
\DoxyCodeLine{930             instr-\/>vibrato\_sweep = READ\_U8(offset + 236);}
\DoxyCodeLine{931             instr-\/>vibrato\_depth = READ\_U8(offset + 237);}
\DoxyCodeLine{932             instr-\/>vibrato\_rate = READ\_U8(offset + 238);}
\DoxyCodeLine{933             instr-\/>volume\_fadeout = READ\_U16(offset + 239);}
\DoxyCodeLine{934             instr-\/>samples = (jar\_xm\_sample\_t*)mempool;}
\DoxyCodeLine{935             mempool += instr-\/>num\_samples * \textcolor{keyword}{sizeof}(jar\_xm\_sample\_t);}
\DoxyCodeLine{936         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{937             instr-\/>samples = NULL;}
\DoxyCodeLine{938         \}}
\DoxyCodeLine{939 }
\DoxyCodeLine{940         \textcolor{comment}{/* Instrument header size */}}
\DoxyCodeLine{941         offset += READ\_U32(offset);}
\DoxyCodeLine{942 }
\DoxyCodeLine{943         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} j = 0; j < instr-\/>num\_samples; ++j) \{}
\DoxyCodeLine{944             \textcolor{comment}{/* Read sample header */}}
\DoxyCodeLine{945             jar\_xm\_sample\_t* \mbox{\hyperlink{structsample}{sample}} = instr-\/>samples + j;}
\DoxyCodeLine{946 }
\DoxyCodeLine{947             \mbox{\hyperlink{structsample}{sample}}-\/>length = READ\_U32(offset);}
\DoxyCodeLine{948             \mbox{\hyperlink{structsample}{sample}}-\/>loop\_start = READ\_U32(offset + 4);}
\DoxyCodeLine{949             \mbox{\hyperlink{structsample}{sample}}-\/>loop\_length = READ\_U32(offset + 8);}
\DoxyCodeLine{950             \mbox{\hyperlink{structsample}{sample}}-\/>loop\_end = \mbox{\hyperlink{structsample}{sample}}-\/>loop\_start + \mbox{\hyperlink{structsample}{sample}}-\/>loop\_length;}
\DoxyCodeLine{951             \mbox{\hyperlink{structsample}{sample}}-\/>volume = (float)(READ\_U8(offset + 12) << 2) / 256.f;}
\DoxyCodeLine{952             \textcolor{keywordflow}{if} (\mbox{\hyperlink{structsample}{sample}}-\/>volume > 1.0f) \{\mbox{\hyperlink{structsample}{sample}}-\/>volume = 1.f;\};}
\DoxyCodeLine{953             \mbox{\hyperlink{structsample}{sample}}-\/>finetune = (int8\_t)READ\_U8(offset + 13);}
\DoxyCodeLine{954 }
\DoxyCodeLine{955             uint8\_t flags = READ\_U8(offset + 14);}
\DoxyCodeLine{956             \textcolor{keywordflow}{switch} (flags \& 3) \{}
\DoxyCodeLine{957             \textcolor{keywordflow}{case} 2:}
\DoxyCodeLine{958             \textcolor{keywordflow}{case} 3:}
\DoxyCodeLine{959                 \mbox{\hyperlink{structsample}{sample}}-\/>loop\_type = jar\_xm\_PING\_PONG\_LOOP;}
\DoxyCodeLine{960             \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{961                 \mbox{\hyperlink{structsample}{sample}}-\/>loop\_type = jar\_xm\_FORWARD\_LOOP;}
\DoxyCodeLine{962                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{963             \textcolor{keywordflow}{default}:}
\DoxyCodeLine{964                 \mbox{\hyperlink{structsample}{sample}}-\/>loop\_type = jar\_xm\_NO\_LOOP;}
\DoxyCodeLine{965                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{966             \};}
\DoxyCodeLine{967             \mbox{\hyperlink{structsample}{sample}}-\/>bits = (flags \& 0x10) ? 16 : 8;}
\DoxyCodeLine{968             \mbox{\hyperlink{structsample}{sample}}-\/>stereo = (flags \& 0x20) ? 1 : 0;}
\DoxyCodeLine{969             \mbox{\hyperlink{structsample}{sample}}-\/>panning = (float)READ\_U8(offset + 15) / 255.f;}
\DoxyCodeLine{970             \mbox{\hyperlink{structsample}{sample}}-\/>relative\_note = (int8\_t)READ\_U8(offset + 16);}
\DoxyCodeLine{971             READ\_MEMCPY(\mbox{\hyperlink{structsample}{sample}}-\/>name, 18, SAMPLE\_NAME\_LENGTH);}
\DoxyCodeLine{972             \mbox{\hyperlink{structsample}{sample}}-\/>data = (\textcolor{keywordtype}{float}*)mempool;}
\DoxyCodeLine{973             \textcolor{keywordflow}{if}(\mbox{\hyperlink{structsample}{sample}}-\/>bits == 16) \{}
\DoxyCodeLine{974                 \textcolor{comment}{/* 16 bit sample */}}
\DoxyCodeLine{975                 mempool += \mbox{\hyperlink{structsample}{sample}}-\/>length * (\textcolor{keyword}{sizeof}(float) >> 1);}
\DoxyCodeLine{976                 \mbox{\hyperlink{structsample}{sample}}-\/>loop\_start >>= 1;}
\DoxyCodeLine{977                 \mbox{\hyperlink{structsample}{sample}}-\/>loop\_length >>= 1;}
\DoxyCodeLine{978                 \mbox{\hyperlink{structsample}{sample}}-\/>loop\_end >>= 1;}
\DoxyCodeLine{979                 \mbox{\hyperlink{structsample}{sample}}-\/>length >>= 1;}
\DoxyCodeLine{980             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{981                 \textcolor{comment}{/* 8 bit sample */}}
\DoxyCodeLine{982                 mempool += \mbox{\hyperlink{structsample}{sample}}-\/>length * \textcolor{keyword}{sizeof}(float);}
\DoxyCodeLine{983             \}}
\DoxyCodeLine{984             \textcolor{comment}{// Adjust loop points to reflect half of the reported length (stereo)}}
\DoxyCodeLine{985             \textcolor{keywordflow}{if} (\mbox{\hyperlink{structsample}{sample}}-\/>stereo \&\& \mbox{\hyperlink{structsample}{sample}}-\/>loop\_type != jar\_xm\_NO\_LOOP) \{}
\DoxyCodeLine{986                 div\_t lstart = div(READ\_U32(offset + 4), 2);}
\DoxyCodeLine{987                 \mbox{\hyperlink{structsample}{sample}}-\/>loop\_start = lstart.quot;}
\DoxyCodeLine{988                 div\_t llength = div(READ\_U32(offset + 8), 2);}
\DoxyCodeLine{989                 \mbox{\hyperlink{structsample}{sample}}-\/>loop\_length = llength.quot;}
\DoxyCodeLine{990                 \mbox{\hyperlink{structsample}{sample}}-\/>loop\_end = \mbox{\hyperlink{structsample}{sample}}-\/>loop\_start + \mbox{\hyperlink{structsample}{sample}}-\/>loop\_length;}
\DoxyCodeLine{991             \};}
\DoxyCodeLine{992 }
\DoxyCodeLine{993             offset += sample\_header\_size;}
\DoxyCodeLine{994         \}}
\DoxyCodeLine{995 }
\DoxyCodeLine{996         \textcolor{comment}{// Read all samples and convert them to float values}}
\DoxyCodeLine{997         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} j = 0; j < instr-\/>num\_samples; ++j) \{}
\DoxyCodeLine{998             \textcolor{comment}{/* Read sample data */}}
\DoxyCodeLine{999             jar\_xm\_sample\_t* \mbox{\hyperlink{structsample}{sample}} = instr-\/>samples + j;}
\DoxyCodeLine{1000             \textcolor{keywordtype}{int} length = \mbox{\hyperlink{structsample}{sample}}-\/>length;}
\DoxyCodeLine{1001             \textcolor{keywordflow}{if} (\mbox{\hyperlink{structsample}{sample}}-\/>stereo) \{}
\DoxyCodeLine{1002                 \textcolor{comment}{// Since it is stereo, we cut the sample in half (treated as single channel)}}
\DoxyCodeLine{1003                 div\_t result = div(\mbox{\hyperlink{structsample}{sample}}-\/>length, 2);}
\DoxyCodeLine{1004                 \textcolor{keywordflow}{if}(\mbox{\hyperlink{structsample}{sample}}-\/>bits == 16) \{}
\DoxyCodeLine{1005                     int16\_t v = 0;}
\DoxyCodeLine{1006                     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} k = 0; k < length; ++k) \{}
\DoxyCodeLine{1007                         \textcolor{keywordflow}{if} (k == result.quot) \{ v = 0;\};}
\DoxyCodeLine{1008                         v = v + (int16\_t)READ\_U16(offset + (k << 1));}
\DoxyCodeLine{1009                         \mbox{\hyperlink{structsample}{sample}}-\/>data[k] = (float) v / 32768.f ;\textcolor{comment}{//* sign;}}
\DoxyCodeLine{1010                         \textcolor{keywordflow}{if}(\mbox{\hyperlink{structsample}{sample}}-\/>data[k] < -\/1.0)  \{\mbox{\hyperlink{structsample}{sample}}-\/>data[k] = -\/1.0;\}  \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\mbox{\hyperlink{structsample}{sample}}-\/>data[k] > 1.0)  \{\mbox{\hyperlink{structsample}{sample}}-\/>data[k] = 1.0;\};}
\DoxyCodeLine{1011                     \}}
\DoxyCodeLine{1012                     offset += \mbox{\hyperlink{structsample}{sample}}-\/>length << 1;}
\DoxyCodeLine{1013                 \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1014                     int8\_t v = 0;}
\DoxyCodeLine{1015                     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} k = 0; k < length; ++k) \{}
\DoxyCodeLine{1016                         \textcolor{keywordflow}{if} (k == result.quot) \{ v = 0;\};}
\DoxyCodeLine{1017                         v = v + (int8\_t)READ\_U8(offset + k);}
\DoxyCodeLine{1018                         \mbox{\hyperlink{structsample}{sample}}-\/>data[k] = (float)v  / 128.f ;\textcolor{comment}{//* sign;}}
\DoxyCodeLine{1019                         \textcolor{keywordflow}{if}(\mbox{\hyperlink{structsample}{sample}}-\/>data[k] < -\/1.0)  \{\mbox{\hyperlink{structsample}{sample}}-\/>data[k] = -\/1.0;\}  \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\mbox{\hyperlink{structsample}{sample}}-\/>data[k] > 1.0)  \{\mbox{\hyperlink{structsample}{sample}}-\/>data[k] = 1.0;\};}
\DoxyCodeLine{1020                     \}}
\DoxyCodeLine{1021                     offset += \mbox{\hyperlink{structsample}{sample}}-\/>length;}
\DoxyCodeLine{1022                 \};}
\DoxyCodeLine{1023                 \mbox{\hyperlink{structsample}{sample}}-\/>length = result.quot;}
\DoxyCodeLine{1024             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1025                 \textcolor{keywordflow}{if}(\mbox{\hyperlink{structsample}{sample}}-\/>bits == 16) \{}
\DoxyCodeLine{1026                     int16\_t v = 0;}
\DoxyCodeLine{1027                     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} k = 0; k < length; ++k) \{}
\DoxyCodeLine{1028                         v = v + (int16\_t)READ\_U16(offset + (k << 1));}
\DoxyCodeLine{1029                         \mbox{\hyperlink{structsample}{sample}}-\/>data[k] = (float) v / 32768.f ;\textcolor{comment}{//* sign;}}
\DoxyCodeLine{1030                         \textcolor{keywordflow}{if}(\mbox{\hyperlink{structsample}{sample}}-\/>data[k] < -\/1.0)  \{\mbox{\hyperlink{structsample}{sample}}-\/>data[k] = -\/1.0;\}  \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\mbox{\hyperlink{structsample}{sample}}-\/>data[k] > 1.0)  \{\mbox{\hyperlink{structsample}{sample}}-\/>data[k] = 1.0;\};}
\DoxyCodeLine{1031                     \}}
\DoxyCodeLine{1032                     offset += \mbox{\hyperlink{structsample}{sample}}-\/>length << 1;}
\DoxyCodeLine{1033                 \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1034                     int8\_t v = 0;}
\DoxyCodeLine{1035                     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} k = 0; k < length; ++k) \{}
\DoxyCodeLine{1036                         v = v + (int8\_t)READ\_U8(offset + k);}
\DoxyCodeLine{1037                         \mbox{\hyperlink{structsample}{sample}}-\/>data[k] = (float)v  / 128.f ;\textcolor{comment}{//* sign;}}
\DoxyCodeLine{1038                         \textcolor{keywordflow}{if}(\mbox{\hyperlink{structsample}{sample}}-\/>data[k] < -\/1.0)  \{\mbox{\hyperlink{structsample}{sample}}-\/>data[k] = -\/1.0;\}  \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\mbox{\hyperlink{structsample}{sample}}-\/>data[k] > 1.0)  \{\mbox{\hyperlink{structsample}{sample}}-\/>data[k] = 1.0;\};}
\DoxyCodeLine{1039                     \}}
\DoxyCodeLine{1040                     offset += \mbox{\hyperlink{structsample}{sample}}-\/>length;}
\DoxyCodeLine{1041                 \}}
\DoxyCodeLine{1042             \}}
\DoxyCodeLine{1043         \};}
\DoxyCodeLine{1044     \};}
\DoxyCodeLine{1045     \textcolor{keywordflow}{return} mempool;}
\DoxyCodeLine{1046 \};}
\DoxyCodeLine{1047 }
\DoxyCodeLine{1048 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{1049 \textcolor{comment}{//THE FOLLOWING IS FOR PLAYING}}
\DoxyCodeLine{1050 \textcolor{keyword}{static} \textcolor{keywordtype}{float} jar\_xm\_waveform(jar\_xm\_waveform\_type\_t, uint8\_t);}
\DoxyCodeLine{1051 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_autovibrato(jar\_xm\_context\_t*, jar\_xm\_channel\_context\_t*);}
\DoxyCodeLine{1052 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_vibrato(jar\_xm\_context\_t*, jar\_xm\_channel\_context\_t*, uint8\_t, uint16\_t);}
\DoxyCodeLine{1053 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_tremolo(jar\_xm\_context\_t*, jar\_xm\_channel\_context\_t*, uint8\_t, uint16\_t);}
\DoxyCodeLine{1054 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_arpeggio(jar\_xm\_context\_t*, jar\_xm\_channel\_context\_t*, uint8\_t, uint16\_t);}
\DoxyCodeLine{1055 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_tone\_portamento(jar\_xm\_context\_t*, jar\_xm\_channel\_context\_t*);}
\DoxyCodeLine{1056 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_pitch\_slide(jar\_xm\_context\_t*, jar\_xm\_channel\_context\_t*, \textcolor{keywordtype}{float});}
\DoxyCodeLine{1057 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_panning\_slide(jar\_xm\_channel\_context\_t*, uint8\_t);}
\DoxyCodeLine{1058 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_volume\_slide(jar\_xm\_channel\_context\_t*, uint8\_t);}
\DoxyCodeLine{1059 }
\DoxyCodeLine{1060 \textcolor{keyword}{static} \textcolor{keywordtype}{float} jar\_xm\_envelope\_lerp(jar\_xm\_envelope\_point\_t*, jar\_xm\_envelope\_point\_t*, uint16\_t);}
\DoxyCodeLine{1061 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_envelope\_tick(jar\_xm\_channel\_context\_t*, jar\_xm\_envelope\_t*, uint16\_t*, \textcolor{keywordtype}{float}*);}
\DoxyCodeLine{1062 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_envelopes(jar\_xm\_channel\_context\_t*);}
\DoxyCodeLine{1063 }
\DoxyCodeLine{1064 \textcolor{keyword}{static} \textcolor{keywordtype}{float} jar\_xm\_linear\_period(\textcolor{keywordtype}{float});}
\DoxyCodeLine{1065 \textcolor{keyword}{static} \textcolor{keywordtype}{float} jar\_xm\_linear\_frequency(\textcolor{keywordtype}{float});}
\DoxyCodeLine{1066 \textcolor{keyword}{static} \textcolor{keywordtype}{float} jar\_xm\_amiga\_period(\textcolor{keywordtype}{float});}
\DoxyCodeLine{1067 \textcolor{keyword}{static} \textcolor{keywordtype}{float} jar\_xm\_amiga\_frequency(\textcolor{keywordtype}{float});}
\DoxyCodeLine{1068 \textcolor{keyword}{static} \textcolor{keywordtype}{float} jar\_xm\_period(jar\_xm\_context\_t*, \textcolor{keywordtype}{float});}
\DoxyCodeLine{1069 \textcolor{keyword}{static} \textcolor{keywordtype}{float} jar\_xm\_frequency(jar\_xm\_context\_t*, \textcolor{keywordtype}{float}, \textcolor{keywordtype}{float});}
\DoxyCodeLine{1070 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_update\_frequency(jar\_xm\_context\_t*, jar\_xm\_channel\_context\_t*);}
\DoxyCodeLine{1071 }
\DoxyCodeLine{1072 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_handle\_note\_and\_instrument(jar\_xm\_context\_t*, jar\_xm\_channel\_context\_t*, jar\_xm\_pattern\_slot\_t*);}
\DoxyCodeLine{1073 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_trigger\_note(jar\_xm\_context\_t*, jar\_xm\_channel\_context\_t*, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} flags);}
\DoxyCodeLine{1074 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_cut\_note(jar\_xm\_channel\_context\_t*);}
\DoxyCodeLine{1075 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_key\_off(jar\_xm\_channel\_context\_t*);}
\DoxyCodeLine{1076 }
\DoxyCodeLine{1077 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_post\_pattern\_change(jar\_xm\_context\_t*);}
\DoxyCodeLine{1078 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_row(jar\_xm\_context\_t*);}
\DoxyCodeLine{1079 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_tick(jar\_xm\_context\_t*);}
\DoxyCodeLine{1080 }
\DoxyCodeLine{1081 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_next\_of\_sample(jar\_xm\_context\_t*, jar\_xm\_channel\_context\_t*, \textcolor{keywordtype}{int});}
\DoxyCodeLine{1082 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_mixdown(jar\_xm\_context\_t*, \textcolor{keywordtype}{float}*, \textcolor{keywordtype}{float}*);}
\DoxyCodeLine{1083 }
\DoxyCodeLine{1084 \textcolor{preprocessor}{\#define jar\_xm\_TRIGGER\_KEEP\_VOLUME (1 << 0)}}
\DoxyCodeLine{1085 \textcolor{preprocessor}{\#define jar\_xm\_TRIGGER\_KEEP\_PERIOD (1 << 1)}}
\DoxyCodeLine{1086 \textcolor{preprocessor}{\#define jar\_xm\_TRIGGER\_KEEP\_SAMPLE\_POSITION (1 << 2)}}
\DoxyCodeLine{1087 }
\DoxyCodeLine{1088                                             \textcolor{comment}{// C-\/2, C\#2, D-\/2, D\#2, E-\/2, F-\/2, F\#2, G-\/2, G\#2, A-\/2, A\#2, B-\/2, C-\/3}}
\DoxyCodeLine{1089 \textcolor{keyword}{static} \textcolor{keyword}{const} uint16\_t amiga\_frequencies[] = \{ 1712, 1616, 1525, 1440, 1357, 1281, 1209, 1141, 1077, 1017,  961,  907, 856 \};}
\DoxyCodeLine{1090 }
\DoxyCodeLine{1091                                             \textcolor{comment}{// 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, a, b, c, d, e, f}}
\DoxyCodeLine{1092 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{float} multi\_retrig\_add[] = \{ 0.f, -\/1.f, -\/2.f, -\/4.f, -\/8.f, -\/16.f, 0.f, 0.f, 0.f, 1.f, 2.f, 4.f, 8.f, 16.f, 0.f, 0.f \};}
\DoxyCodeLine{1093 }
\DoxyCodeLine{1094                                             \textcolor{comment}{// 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, a, b, c, d, e, f}}
\DoxyCodeLine{1095 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{float} multi\_retrig\_multiply[] = \{ 1.f, 1.f, 1.f, 1.f, 1.f, 1.f, .6666667f, .5f, 1.f, 1.f, 1.f, 1.f, 1.f, 1.f, 1.5f, 2.f \};}
\DoxyCodeLine{1096 }
\DoxyCodeLine{1097 \textcolor{preprocessor}{\#define jar\_xm\_CLAMP\_UP1F(vol, limit) do \{            \(\backslash\)}}
\DoxyCodeLine{1098 \textcolor{preprocessor}{        if((vol) > (limit)) (vol) = (limit);    \(\backslash\)}}
\DoxyCodeLine{1099 \textcolor{preprocessor}{    \} while(0)}}
\DoxyCodeLine{1100 \textcolor{preprocessor}{\#define jar\_xm\_CLAMP\_UP(vol) jar\_xm\_CLAMP\_UP1F((vol), 1.f)}}
\DoxyCodeLine{1101 }
\DoxyCodeLine{1102 \textcolor{preprocessor}{\#define jar\_xm\_CLAMP\_DOWN1F(vol, limit) do \{        \(\backslash\)}}
\DoxyCodeLine{1103 \textcolor{preprocessor}{        if((vol) < (limit)) (vol) = (limit);    \(\backslash\)}}
\DoxyCodeLine{1104 \textcolor{preprocessor}{    \} while(0)}}
\DoxyCodeLine{1105 \textcolor{preprocessor}{\#define jar\_xm\_CLAMP\_DOWN(vol) jar\_xm\_CLAMP\_DOWN1F((vol), .0f)}}
\DoxyCodeLine{1106 }
\DoxyCodeLine{1107 \textcolor{preprocessor}{\#define jar\_xm\_CLAMP2F(vol, up, down) do \{            \(\backslash\)}}
\DoxyCodeLine{1108 \textcolor{preprocessor}{        if((vol) > (up)) (vol) = (up);            \(\backslash\)}}
\DoxyCodeLine{1109 \textcolor{preprocessor}{        else if((vol) < (down)) (vol) = (down); \(\backslash\)}}
\DoxyCodeLine{1110 \textcolor{preprocessor}{    \} while(0)}}
\DoxyCodeLine{1111 \textcolor{preprocessor}{\#define jar\_xm\_CLAMP(vol) jar\_xm\_CLAMP2F((vol), 1.f, .0f)}}
\DoxyCodeLine{1112 }
\DoxyCodeLine{1113 \textcolor{preprocessor}{\#define jar\_xm\_SLIDE\_TOWARDS(val, goal, incr) do \{        \(\backslash\)}}
\DoxyCodeLine{1114 \textcolor{preprocessor}{        if((val) > (goal)) \{                        \(\backslash\)}}
\DoxyCodeLine{1115 \textcolor{preprocessor}{            (val) -\/= (incr);                        \(\backslash\)}}
\DoxyCodeLine{1116 \textcolor{preprocessor}{            jar\_xm\_CLAMP\_DOWN1F((val), (goal));            \(\backslash\)}}
\DoxyCodeLine{1117 \textcolor{preprocessor}{        \} else if((val) < (goal)) \{                    \(\backslash\)}}
\DoxyCodeLine{1118 \textcolor{preprocessor}{            (val) += (incr);                        \(\backslash\)}}
\DoxyCodeLine{1119 \textcolor{preprocessor}{            jar\_xm\_CLAMP\_UP1F((val), (goal));            \(\backslash\)}}
\DoxyCodeLine{1120 \textcolor{preprocessor}{        \}                                            \(\backslash\)}}
\DoxyCodeLine{1121 \textcolor{preprocessor}{    \} while(0)}}
\DoxyCodeLine{1122 }
\DoxyCodeLine{1123 \textcolor{preprocessor}{\#define jar\_xm\_LERP(u, v, t) ((u) + (t) * ((v) -\/ (u)))}}
\DoxyCodeLine{1124 \textcolor{preprocessor}{\#define jar\_xm\_INVERSE\_LERP(u, v, lerp) (((lerp) -\/ (u)) / ((v) -\/ (u)))}}
\DoxyCodeLine{1125 }
\DoxyCodeLine{1126 \textcolor{preprocessor}{\#define HAS\_TONE\_PORTAMENTO(s) ((s)-\/>effect\_type == 3 \(\backslash\)}}
\DoxyCodeLine{1127 \textcolor{preprocessor}{                                 || (s)-\/>effect\_type == 5 \(\backslash\)}}
\DoxyCodeLine{1128 \textcolor{preprocessor}{                                 || ((s)-\/>volume\_column >> 4) == 0xF)}}
\DoxyCodeLine{1129 \textcolor{preprocessor}{\#define HAS\_ARPEGGIO(s) ((s)-\/>effect\_type == 0 \(\backslash\)}}
\DoxyCodeLine{1130 \textcolor{preprocessor}{                          \&\& (s)-\/>effect\_param != 0)}}
\DoxyCodeLine{1131 \textcolor{preprocessor}{\#define HAS\_VIBRATO(s) ((s)-\/>effect\_type == 4 \(\backslash\)}}
\DoxyCodeLine{1132 \textcolor{preprocessor}{                         || (s)-\/>effect\_param == 6 \(\backslash\)}}
\DoxyCodeLine{1133 \textcolor{preprocessor}{                         || ((s)-\/>volume\_column >> 4) == 0xB)}}
\DoxyCodeLine{1134 \textcolor{preprocessor}{\#define NOTE\_IS\_VALID(n) ((n) > 0 \&\& (n) < 97)}}
\DoxyCodeLine{1135 \textcolor{preprocessor}{\#define NOTE\_OFF 97}}
\DoxyCodeLine{1136 }
\DoxyCodeLine{1137 \textcolor{keyword}{static} \textcolor{keywordtype}{float} jar\_xm\_waveform(jar\_xm\_waveform\_type\_t waveform, uint8\_t step) \{}
\DoxyCodeLine{1138     \textcolor{keyword}{static} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} next\_rand = 24492;}
\DoxyCodeLine{1139     step \%= 0x40;}
\DoxyCodeLine{1140     \textcolor{keywordflow}{switch}(waveform) \{}
\DoxyCodeLine{1141     \textcolor{keywordflow}{case} jar\_xm\_SINE\_WAVEFORM: \textcolor{comment}{/* No SIN() table used, direct calculation. */}}
\DoxyCodeLine{1142         \textcolor{keywordflow}{return} -\/sinf(2.f * 3.141592f * (\textcolor{keywordtype}{float})step / (\textcolor{keywordtype}{float})0x40);}
\DoxyCodeLine{1143     \textcolor{keywordflow}{case} jar\_xm\_RAMP\_DOWN\_WAVEFORM: \textcolor{comment}{/* Ramp down: 1.0f when step = 0; -\/1.0f when step = 0x40 */}}
\DoxyCodeLine{1144         \textcolor{keywordflow}{return} (\textcolor{keywordtype}{float})(0x20 -\/ step) / 0x20;}
\DoxyCodeLine{1145     \textcolor{keywordflow}{case} jar\_xm\_SQUARE\_WAVEFORM: \textcolor{comment}{/* Square with a 50\% duty */}}
\DoxyCodeLine{1146         \textcolor{keywordflow}{return} (step >= 0x20) ? 1.f : -\/1.f;}
\DoxyCodeLine{1147     \textcolor{keywordflow}{case} jar\_xm\_RANDOM\_WAVEFORM: \textcolor{comment}{/* Use the POSIX.1-\/2001 example, just to be deterministic across different machines */}}
\DoxyCodeLine{1148         next\_rand = next\_rand * 1103515245 + 12345;}
\DoxyCodeLine{1149         \textcolor{keywordflow}{return} (\textcolor{keywordtype}{float})((next\_rand >> 16) \& 0x7FFF) / (float)0x4000 -\/ 1.f;}
\DoxyCodeLine{1150     \textcolor{keywordflow}{case} jar\_xm\_RAMP\_UP\_WAVEFORM: \textcolor{comment}{/* Ramp up: -\/1.f when step = 0; 1.f when step = 0x40 */}}
\DoxyCodeLine{1151         \textcolor{keywordflow}{return} (\textcolor{keywordtype}{float})(step -\/ 0x20) / 0x20;}
\DoxyCodeLine{1152     \textcolor{keywordflow}{default}:}
\DoxyCodeLine{1153         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1154     \}}
\DoxyCodeLine{1155     \textcolor{keywordflow}{return} .0f;}
\DoxyCodeLine{1156 \}}
\DoxyCodeLine{1157 }
\DoxyCodeLine{1158 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_autovibrato(jar\_xm\_context\_t* ctx, jar\_xm\_channel\_context\_t* ch) \{}
\DoxyCodeLine{1159     \textcolor{keywordflow}{if}(ch-\/>instrument == NULL || ch-\/>instrument-\/>vibrato\_depth == 0) \textcolor{keywordflow}{return};}
\DoxyCodeLine{1160     jar\_xm\_instrument\_t* instr = ch-\/>instrument;}
\DoxyCodeLine{1161     \textcolor{keywordtype}{float} sweep = 1.f;}
\DoxyCodeLine{1162     \textcolor{keywordflow}{if}(ch-\/>autovibrato\_ticks < instr-\/>vibrato\_sweep) \{ sweep = jar\_xm\_LERP(0.f, 1.f, (\textcolor{keywordtype}{float})ch-\/>autovibrato\_ticks / (\textcolor{keywordtype}{float})instr-\/>vibrato\_sweep); \}}
\DoxyCodeLine{1163     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} step = ((ch-\/>autovibrato\_ticks++) * instr-\/>vibrato\_rate) >> 2;}
\DoxyCodeLine{1164     ch-\/>autovibrato\_note\_offset = .25f * jar\_xm\_waveform(instr-\/>vibrato\_type, step) * (float)instr-\/>vibrato\_depth / (\textcolor{keywordtype}{float})0xF * sweep;}
\DoxyCodeLine{1165     jar\_xm\_update\_frequency(ctx, ch);}
\DoxyCodeLine{1166 \}}
\DoxyCodeLine{1167 }
\DoxyCodeLine{1168 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_vibrato(jar\_xm\_context\_t* ctx, jar\_xm\_channel\_context\_t* ch, uint8\_t param, uint16\_t pos) \{}
\DoxyCodeLine{1169     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} step = pos * (param >> 4);}
\DoxyCodeLine{1170     ch-\/>vibrato\_note\_offset = 2.f * jar\_xm\_waveform(ch-\/>vibrato\_waveform, step) * (float)(param \& 0x0F) / (float)0xF;}
\DoxyCodeLine{1171     jar\_xm\_update\_frequency(ctx, ch);}
\DoxyCodeLine{1172 \}}
\DoxyCodeLine{1173 }
\DoxyCodeLine{1174 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_tremolo(jar\_xm\_context\_t* ctx, jar\_xm\_channel\_context\_t* ch, uint8\_t param, uint16\_t pos) \{}
\DoxyCodeLine{1175     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} step = pos * (param >> 4);}
\DoxyCodeLine{1176     ch-\/>tremolo\_volume = -\/1.f * jar\_xm\_waveform(ch-\/>tremolo\_waveform, step) * (float)(param \& 0x0F) / (float)0xF;}
\DoxyCodeLine{1177 \}}
\DoxyCodeLine{1178 }
\DoxyCodeLine{1179 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_arpeggio(jar\_xm\_context\_t* ctx, jar\_xm\_channel\_context\_t* ch, uint8\_t param, uint16\_t tick) \{}
\DoxyCodeLine{1180     \textcolor{keywordflow}{switch}(tick \% 3) \{}
\DoxyCodeLine{1181     \textcolor{keywordflow}{case} 0:}
\DoxyCodeLine{1182         ch-\/>arp\_in\_progress = \textcolor{keyword}{false};}
\DoxyCodeLine{1183         ch-\/>arp\_note\_offset = 0;}
\DoxyCodeLine{1184         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1185     \textcolor{keywordflow}{case} 2:}
\DoxyCodeLine{1186         ch-\/>arp\_in\_progress = \textcolor{keyword}{true};}
\DoxyCodeLine{1187         ch-\/>arp\_note\_offset = param >> 4;}
\DoxyCodeLine{1188         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1189     \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{1190         ch-\/>arp\_in\_progress = \textcolor{keyword}{true};}
\DoxyCodeLine{1191         ch-\/>arp\_note\_offset = param \& 0x0F;}
\DoxyCodeLine{1192         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1193     \}}
\DoxyCodeLine{1194     jar\_xm\_update\_frequency(ctx, ch);}
\DoxyCodeLine{1195 \}}
\DoxyCodeLine{1196 }
\DoxyCodeLine{1197 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_tone\_portamento(jar\_xm\_context\_t* ctx, jar\_xm\_channel\_context\_t* ch) \{}
\DoxyCodeLine{1198     \textcolor{comment}{/* 3xx called without a note, wait until we get an actual target note. */}}
\DoxyCodeLine{1199     \textcolor{keywordflow}{if}(ch-\/>tone\_portamento\_target\_period == 0.f) \textcolor{keywordflow}{return};  \textcolor{comment}{/* no value, exit */}}
\DoxyCodeLine{1200     \textcolor{keywordflow}{if}(ch-\/>period != ch-\/>tone\_portamento\_target\_period) \{}
\DoxyCodeLine{1201         jar\_xm\_SLIDE\_TOWARDS(ch-\/>period, ch-\/>tone\_portamento\_target\_period, (ctx-\/>module.frequency\_type == jar\_xm\_LINEAR\_FREQUENCIES ? 4.f : 1.f) * ch-\/>tone\_portamento\_param);}
\DoxyCodeLine{1202         jar\_xm\_update\_frequency(ctx, ch);}
\DoxyCodeLine{1203     \}}
\DoxyCodeLine{1204 \}}
\DoxyCodeLine{1205 }
\DoxyCodeLine{1206 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_pitch\_slide(jar\_xm\_context\_t* ctx, jar\_xm\_channel\_context\_t* ch, \textcolor{keywordtype}{float} period\_offset) \{}
\DoxyCodeLine{1207     \textcolor{comment}{/* Don't ask about the 4.f coefficient. I found mention of it nowhere. Found by ear. */}}
\DoxyCodeLine{1208     \textcolor{keywordflow}{if}(ctx-\/>module.frequency\_type == jar\_xm\_LINEAR\_FREQUENCIES) \{period\_offset *= 4.f; \}}
\DoxyCodeLine{1209     ch-\/>period += period\_offset;}
\DoxyCodeLine{1210     jar\_xm\_CLAMP\_DOWN(ch-\/>period);}
\DoxyCodeLine{1211     \textcolor{comment}{/* XXX: upper bound of period ? */}}
\DoxyCodeLine{1212     jar\_xm\_update\_frequency(ctx, ch);}
\DoxyCodeLine{1213 \}}
\DoxyCodeLine{1214 }
\DoxyCodeLine{1215 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_panning\_slide(jar\_xm\_channel\_context\_t* ch, uint8\_t rawval) \{}
\DoxyCodeLine{1216     \textcolor{keywordflow}{if} (rawval \& 0xF0) \{ch-\/>panning += (float)((rawval \& 0xF0 )>> 4) / (\textcolor{keywordtype}{float})0xFF;\};}
\DoxyCodeLine{1217     \textcolor{keywordflow}{if} (rawval \& 0x0F) \{ch-\/>panning -\/= (float)(rawval \& 0x0F) / (float)0xFF;\};}
\DoxyCodeLine{1218 \};}
\DoxyCodeLine{1219 }
\DoxyCodeLine{1220 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_volume\_slide(jar\_xm\_channel\_context\_t* ch, uint8\_t rawval) \{}
\DoxyCodeLine{1221     \textcolor{keywordflow}{if} (rawval \& 0xF0) \{ch-\/>volume += (float)((rawval \& 0xF0) >> 4) / (\textcolor{keywordtype}{float})0x40;\};}
\DoxyCodeLine{1222     \textcolor{keywordflow}{if} (rawval \& 0x0F) \{ch-\/>volume -\/= (float)(rawval \& 0x0F) / (float)0x40;\};}
\DoxyCodeLine{1223 \};}
\DoxyCodeLine{1224 }
\DoxyCodeLine{1225 \textcolor{keyword}{static} \textcolor{keywordtype}{float} jar\_xm\_envelope\_lerp(jar\_xm\_envelope\_point\_t* a, jar\_xm\_envelope\_point\_t* b, uint16\_t pos) \{}
\DoxyCodeLine{1226     \textcolor{comment}{/* Linear interpolation between two envelope points */}}
\DoxyCodeLine{1227     \textcolor{keywordflow}{if}(pos <= a-\/>frame) \textcolor{keywordflow}{return} a-\/>value;}
\DoxyCodeLine{1228     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(pos >= b-\/>frame) \textcolor{keywordflow}{return} b-\/>value;}
\DoxyCodeLine{1229     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1230         \textcolor{keywordtype}{float} p = (float)(pos -\/ a-\/>frame) / (float)(b-\/>frame -\/ a-\/>frame);}
\DoxyCodeLine{1231         \textcolor{keywordflow}{return} a-\/>value * (1 -\/ p) + b-\/>value * p;}
\DoxyCodeLine{1232     \}}
\DoxyCodeLine{1233 \}}
\DoxyCodeLine{1234 }
\DoxyCodeLine{1235 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_post\_pattern\_change(jar\_xm\_context\_t* ctx) \{}
\DoxyCodeLine{1236     \textcolor{comment}{/* Loop if necessary */}}
\DoxyCodeLine{1237     \textcolor{keywordflow}{if}(ctx-\/>current\_table\_index >= ctx-\/>module.length) \{}
\DoxyCodeLine{1238         ctx-\/>current\_table\_index = ctx-\/>module.restart\_position;}
\DoxyCodeLine{1239         ctx-\/>tempo =ctx-\/>default\_tempo; \textcolor{comment}{// reset to file default value}}
\DoxyCodeLine{1240         ctx-\/>bpm = ctx-\/>default\_bpm; \textcolor{comment}{// reset to file default value}}
\DoxyCodeLine{1241         ctx-\/>global\_volume = ctx-\/>default\_global\_volume; \textcolor{comment}{// reset to file default value}}
\DoxyCodeLine{1242     \}}
\DoxyCodeLine{1243 \}}
\DoxyCodeLine{1244 }
\DoxyCodeLine{1245 \textcolor{keyword}{static} \textcolor{keywordtype}{float} jar\_xm\_linear\_period(\textcolor{keywordtype}{float} \mbox{\hyperlink{structnote}{note}}) \{}
\DoxyCodeLine{1246     \textcolor{keywordflow}{return} 7680.f -\/ \mbox{\hyperlink{structnote}{note}} * 64.f;}
\DoxyCodeLine{1247 \}}
\DoxyCodeLine{1248 }
\DoxyCodeLine{1249 \textcolor{keyword}{static} \textcolor{keywordtype}{float} jar\_xm\_linear\_frequency(\textcolor{keywordtype}{float} period) \{}
\DoxyCodeLine{1250     \textcolor{keywordflow}{return} 8363.f * powf(2.f, (4608.f -\/ period) / 768.f);}
\DoxyCodeLine{1251 \}}
\DoxyCodeLine{1252 }
\DoxyCodeLine{1253 \textcolor{keyword}{static} \textcolor{keywordtype}{float} jar\_xm\_amiga\_period(\textcolor{keywordtype}{float} \mbox{\hyperlink{structnote}{note}}) \{}
\DoxyCodeLine{1254     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} intnote = \mbox{\hyperlink{structnote}{note}};}
\DoxyCodeLine{1255     uint8\_t a = intnote \% 12;}
\DoxyCodeLine{1256     int8\_t octave = \mbox{\hyperlink{structnote}{note}} / 12.f -\/ 2;}
\DoxyCodeLine{1257     uint16\_t p1 = amiga\_frequencies[a], p2 = amiga\_frequencies[a + 1];}
\DoxyCodeLine{1258     \textcolor{keywordflow}{if}(octave > 0) \{}
\DoxyCodeLine{1259         p1 >>= octave;}
\DoxyCodeLine{1260         p2 >>= octave;}
\DoxyCodeLine{1261     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(octave < 0) \{}
\DoxyCodeLine{1262         p1 <<= -\/octave;}
\DoxyCodeLine{1263         p2 <<= -\/octave;}
\DoxyCodeLine{1264     \}}
\DoxyCodeLine{1265     \textcolor{keywordflow}{return} jar\_xm\_LERP(p1, p2, \mbox{\hyperlink{structnote}{note}} -\/ intnote);}
\DoxyCodeLine{1266 \}}
\DoxyCodeLine{1267 }
\DoxyCodeLine{1268 \textcolor{keyword}{static} \textcolor{keywordtype}{float} jar\_xm\_amiga\_frequency(\textcolor{keywordtype}{float} period) \{}
\DoxyCodeLine{1269     \textcolor{keywordflow}{if}(period == .0f) \textcolor{keywordflow}{return} .0f;}
\DoxyCodeLine{1270     \textcolor{keywordflow}{return} 7093789.2f / (period * 2.f); \textcolor{comment}{/* This is the PAL value. (we could use the NTSC value also) */}}
\DoxyCodeLine{1271 \}}
\DoxyCodeLine{1272 }
\DoxyCodeLine{1273 \textcolor{keyword}{static} \textcolor{keywordtype}{float} jar\_xm\_period(jar\_xm\_context\_t* ctx, \textcolor{keywordtype}{float} \mbox{\hyperlink{structnote}{note}}) \{}
\DoxyCodeLine{1274     \textcolor{keywordflow}{switch}(ctx-\/>module.frequency\_type) \{}
\DoxyCodeLine{1275     \textcolor{keywordflow}{case} jar\_xm\_LINEAR\_FREQUENCIES:}
\DoxyCodeLine{1276         \textcolor{keywordflow}{return} jar\_xm\_linear\_period(\mbox{\hyperlink{structnote}{note}});}
\DoxyCodeLine{1277     \textcolor{keywordflow}{case} jar\_xm\_AMIGA\_FREQUENCIES:}
\DoxyCodeLine{1278         \textcolor{keywordflow}{return} jar\_xm\_amiga\_period(\mbox{\hyperlink{structnote}{note}});}
\DoxyCodeLine{1279     \}}
\DoxyCodeLine{1280     \textcolor{keywordflow}{return} .0f;}
\DoxyCodeLine{1281 \}}
\DoxyCodeLine{1282 }
\DoxyCodeLine{1283 \textcolor{keyword}{static} \textcolor{keywordtype}{float} jar\_xm\_frequency(jar\_xm\_context\_t* ctx, \textcolor{keywordtype}{float} period, \textcolor{keywordtype}{float} note\_offset) \{}
\DoxyCodeLine{1284     \textcolor{keywordflow}{switch}(ctx-\/>module.frequency\_type) \{}
\DoxyCodeLine{1285     \textcolor{keywordflow}{case} jar\_xm\_LINEAR\_FREQUENCIES:}
\DoxyCodeLine{1286         \textcolor{keywordflow}{return} jar\_xm\_linear\_frequency(period -\/ 64.f * note\_offset);}
\DoxyCodeLine{1287     \textcolor{keywordflow}{case} jar\_xm\_AMIGA\_FREQUENCIES:}
\DoxyCodeLine{1288         \textcolor{keywordflow}{if}(note\_offset == 0) \{ \textcolor{keywordflow}{return} jar\_xm\_amiga\_frequency(period); \};}
\DoxyCodeLine{1289         int8\_t octave;}
\DoxyCodeLine{1290         \textcolor{keywordtype}{float}  \mbox{\hyperlink{structnote}{note}};}
\DoxyCodeLine{1291         uint16\_t p1, p2;}
\DoxyCodeLine{1292         uint8\_t a = octave = 0;}
\DoxyCodeLine{1293 }
\DoxyCodeLine{1294         \textcolor{comment}{/* Find the octave of the current period */}}
\DoxyCodeLine{1295         \textcolor{keywordflow}{if}(period > amiga\_frequencies[0]) \{}
\DoxyCodeLine{1296             -\/-\/octave;}
\DoxyCodeLine{1297             \textcolor{keywordflow}{while}(period > (amiga\_frequencies[0] << -\/octave)) -\/-\/octave;}
\DoxyCodeLine{1298         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(period < amiga\_frequencies[12]) \{}
\DoxyCodeLine{1299             ++octave;}
\DoxyCodeLine{1300             \textcolor{keywordflow}{while}(period < (amiga\_frequencies[12] >> octave)) ++octave;}
\DoxyCodeLine{1301         \}}
\DoxyCodeLine{1302 }
\DoxyCodeLine{1303         \textcolor{comment}{/* Find the smallest note closest to the current period */}}
\DoxyCodeLine{1304         \textcolor{keywordflow}{for}(uint8\_t i = 0; i < 12; ++i) \{}
\DoxyCodeLine{1305             p1 = amiga\_frequencies[i], p2 = amiga\_frequencies[i + 1];}
\DoxyCodeLine{1306             \textcolor{keywordflow}{if}(octave > 0) \{}
\DoxyCodeLine{1307                 p1 >>= octave;}
\DoxyCodeLine{1308                 p2 >>= octave;}
\DoxyCodeLine{1309             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(octave < 0) \{}
\DoxyCodeLine{1310                 p1 <<= (-\/octave);}
\DoxyCodeLine{1311                 p2 <<= (-\/octave);}
\DoxyCodeLine{1312             \}}
\DoxyCodeLine{1313             \textcolor{keywordflow}{if}(p2 <= period \&\& period <= p1) \{}
\DoxyCodeLine{1314                 a = i;}
\DoxyCodeLine{1315                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{1316             \}}
\DoxyCodeLine{1317         \}}
\DoxyCodeLine{1318         \textcolor{keywordflow}{if}(JAR\_XM\_DEBUG \&\& (p1 < period || p2 > period)) \{ DEBUG(\textcolor{stringliteral}{"{}\%i <= \%f <= \%i should hold but doesn't, this is a bug"{}}, p2, period, p1); \}}
\DoxyCodeLine{1319         \mbox{\hyperlink{structnote}{note}} = 12.f * (octave + 2) + a + jar\_xm\_INVERSE\_LERP(p1, p2, period);}
\DoxyCodeLine{1320         \textcolor{keywordflow}{return} jar\_xm\_amiga\_frequency(jar\_xm\_amiga\_period(\mbox{\hyperlink{structnote}{note}} + note\_offset));}
\DoxyCodeLine{1321     \}}
\DoxyCodeLine{1322 }
\DoxyCodeLine{1323     \textcolor{keywordflow}{return} .0f;}
\DoxyCodeLine{1324 \}}
\DoxyCodeLine{1325 }
\DoxyCodeLine{1326 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_update\_frequency(jar\_xm\_context\_t* ctx, jar\_xm\_channel\_context\_t* ch) \{}
\DoxyCodeLine{1327     ch-\/>frequency = jar\_xm\_frequency( ctx, ch-\/>period, (ch-\/>arp\_note\_offset > 0 ? ch-\/>arp\_note\_offset : (  ch-\/>vibrato\_note\_offset + ch-\/>autovibrato\_note\_offset ))  );}
\DoxyCodeLine{1328     ch-\/>step = ch-\/>frequency / ctx-\/>rate;}
\DoxyCodeLine{1329 \}}
\DoxyCodeLine{1330 }
\DoxyCodeLine{1331 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_handle\_note\_and\_instrument(jar\_xm\_context\_t* ctx, jar\_xm\_channel\_context\_t* ch, jar\_xm\_pattern\_slot\_t* s) \{}
\DoxyCodeLine{1332     jar\_xm\_module\_t* mod = \&(ctx-\/>module);}
\DoxyCodeLine{1333     \textcolor{keywordflow}{if}(s-\/>instrument > 0) \{}
\DoxyCodeLine{1334         \textcolor{keywordflow}{if}(HAS\_TONE\_PORTAMENTO(ch-\/>current) \&\& ch-\/>instrument != NULL \&\& ch-\/>sample != NULL) \{  \textcolor{comment}{/* Tone portamento in effect */}}
\DoxyCodeLine{1335             jar\_xm\_trigger\_note(ctx, ch, jar\_xm\_TRIGGER\_KEEP\_PERIOD | jar\_xm\_TRIGGER\_KEEP\_SAMPLE\_POSITION);}
\DoxyCodeLine{1336         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(s-\/>instrument > ctx-\/>module.num\_instruments) \{    \textcolor{comment}{/* Invalid instrument, Cut current note */}}
\DoxyCodeLine{1337             jar\_xm\_cut\_note(ch);}
\DoxyCodeLine{1338             ch-\/>instrument = NULL;}
\DoxyCodeLine{1339             ch-\/>sample = NULL;}
\DoxyCodeLine{1340         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1341             ch-\/>instrument = ctx-\/>module.instruments + (s-\/>instrument -\/ 1);}
\DoxyCodeLine{1342             \textcolor{keywordflow}{if}(s-\/>note == 0 \&\& ch-\/>sample != NULL) \{  \textcolor{comment}{/* Ghost instrument, trigger note */}}
\DoxyCodeLine{1343                 \textcolor{comment}{/* Sample position is kept, but envelopes are reset */}}
\DoxyCodeLine{1344                 jar\_xm\_trigger\_note(ctx, ch, jar\_xm\_TRIGGER\_KEEP\_SAMPLE\_POSITION);}
\DoxyCodeLine{1345             \}}
\DoxyCodeLine{1346         \}}
\DoxyCodeLine{1347     \}}
\DoxyCodeLine{1348 }
\DoxyCodeLine{1349     \textcolor{keywordflow}{if}(NOTE\_IS\_VALID(s-\/>note)) \{}
\DoxyCodeLine{1350         \textcolor{comment}{// note value is s-\/>note -\/1}}
\DoxyCodeLine{1351         jar\_xm\_instrument\_t* instr = ch-\/>instrument;}
\DoxyCodeLine{1352         \textcolor{keywordflow}{if}(HAS\_TONE\_PORTAMENTO(ch-\/>current) \&\& instr != NULL \&\& ch-\/>sample != NULL) \{}
\DoxyCodeLine{1353             \textcolor{comment}{/* Tone portamento in effect */}}
\DoxyCodeLine{1354             ch-\/>note = s-\/>note + ch-\/>sample-\/>relative\_note + ch-\/>sample-\/>finetune / 128.f -\/ 1.f;}
\DoxyCodeLine{1355             ch-\/>tone\_portamento\_target\_period = jar\_xm\_period(ctx, ch-\/>note);}
\DoxyCodeLine{1356         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(instr == NULL || ch-\/>instrument-\/>num\_samples == 0) \{   \textcolor{comment}{/* Issue on instrument */}}
\DoxyCodeLine{1357             jar\_xm\_cut\_note(ch);}
\DoxyCodeLine{1358         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1359             \textcolor{keywordflow}{if}(instr-\/>sample\_of\_notes[s-\/>note -\/ 1] < instr-\/>num\_samples) \{}
\DoxyCodeLine{1360                 \textcolor{keywordflow}{if} (mod-\/>ramping) \{}
\DoxyCodeLine{1361                     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i = 0; i < jar\_xm\_SAMPLE\_RAMPING\_POINTS; ++i) \{}
\DoxyCodeLine{1362                         jar\_xm\_next\_of\_sample(ctx, ch, i);}
\DoxyCodeLine{1363                     \}}
\DoxyCodeLine{1364                     ch-\/>frame\_count = 0;}
\DoxyCodeLine{1365                 \};}
\DoxyCodeLine{1366                 ch-\/>sample = instr-\/>samples + instr-\/>sample\_of\_notes[s-\/>note -\/ 1];}
\DoxyCodeLine{1367                 ch-\/>orig\_note = ch-\/>note = s-\/>note + ch-\/>sample-\/>relative\_note + ch-\/>sample-\/>finetune / 128.f -\/ 1.f;}
\DoxyCodeLine{1368                 \textcolor{keywordflow}{if}(s-\/>instrument > 0) \{}
\DoxyCodeLine{1369                     jar\_xm\_trigger\_note(ctx, ch, 0);}
\DoxyCodeLine{1370                 \} \textcolor{keywordflow}{else} \{  \textcolor{comment}{/* Ghost note: keep old volume */}}
\DoxyCodeLine{1371                     jar\_xm\_trigger\_note(ctx, ch, jar\_xm\_TRIGGER\_KEEP\_VOLUME);}
\DoxyCodeLine{1372                 \}}
\DoxyCodeLine{1373             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1374                 jar\_xm\_cut\_note(ch);}
\DoxyCodeLine{1375             \}}
\DoxyCodeLine{1376         \}}
\DoxyCodeLine{1377     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(s-\/>note == NOTE\_OFF) \{}
\DoxyCodeLine{1378         jar\_xm\_key\_off(ch);}
\DoxyCodeLine{1379     \}}
\DoxyCodeLine{1380 }
\DoxyCodeLine{1381     \textcolor{comment}{// Interpret Effect column}}
\DoxyCodeLine{1382     \textcolor{keywordflow}{switch}(s-\/>effect\_type) \{}
\DoxyCodeLine{1383     \textcolor{keywordflow}{case} 1: \textcolor{comment}{/* 1xx: Portamento up */}}
\DoxyCodeLine{1384         \textcolor{keywordflow}{if}(s-\/>effect\_param > 0) \{    ch-\/>portamento\_up\_param = s-\/>effect\_param; \}}
\DoxyCodeLine{1385         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1386     \textcolor{keywordflow}{case} 2: \textcolor{comment}{/* 2xx: Portamento down */}}
\DoxyCodeLine{1387         \textcolor{keywordflow}{if}(s-\/>effect\_param > 0) \{    ch-\/>portamento\_down\_param = s-\/>effect\_param; \}}
\DoxyCodeLine{1388         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1389     \textcolor{keywordflow}{case} 3: \textcolor{comment}{/* 3xx: Tone portamento */}}
\DoxyCodeLine{1390         \textcolor{keywordflow}{if}(s-\/>effect\_param > 0) \{    ch-\/>tone\_portamento\_param = s-\/>effect\_param; \}}
\DoxyCodeLine{1391         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1392     \textcolor{keywordflow}{case} 4: \textcolor{comment}{/* 4xy: Vibrato */}}
\DoxyCodeLine{1393         \textcolor{keywordflow}{if}(s-\/>effect\_param \& 0x0F) \{ ch-\/>vibrato\_param = (ch-\/>vibrato\_param \& 0xF0) | (s-\/>effect\_param \& 0x0F); \}  \textcolor{comment}{/* Set vibrato depth */}}
\DoxyCodeLine{1394         \textcolor{keywordflow}{if}(s-\/>effect\_param >> 4) \{ ch-\/>vibrato\_param = (s-\/>effect\_param \& 0xF0) | (ch-\/>vibrato\_param \& 0x0F); \}   \textcolor{comment}{/* Set vibrato speed */}}
\DoxyCodeLine{1395         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1396     \textcolor{keywordflow}{case} 5: \textcolor{comment}{/* 5xy: Tone portamento + Volume slide */}}
\DoxyCodeLine{1397         \textcolor{keywordflow}{if}(s-\/>effect\_param > 0) \{  ch-\/>volume\_slide\_param = s-\/>effect\_param; \}}
\DoxyCodeLine{1398         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1399     \textcolor{keywordflow}{case} 6: \textcolor{comment}{/* 6xy: Vibrato + Volume slide */}}
\DoxyCodeLine{1400         \textcolor{keywordflow}{if}(s-\/>effect\_param > 0) \{    ch-\/>volume\_slide\_param = s-\/>effect\_param; \}}
\DoxyCodeLine{1401         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1402     \textcolor{keywordflow}{case} 7: \textcolor{comment}{/* 7xy: Tremolo */}}
\DoxyCodeLine{1403         \textcolor{keywordflow}{if}(s-\/>effect\_param \& 0x0F) \{ ch-\/>tremolo\_param = (ch-\/>tremolo\_param \& 0xF0) | (s-\/>effect\_param \& 0x0F); \} \textcolor{comment}{/* Set tremolo depth */}}
\DoxyCodeLine{1404         \textcolor{keywordflow}{if}(s-\/>effect\_param >> 4) \{ ch-\/>tremolo\_param = (s-\/>effect\_param \& 0xF0) | (ch-\/>tremolo\_param \& 0x0F); \}  \textcolor{comment}{/* Set tremolo speed */}}
\DoxyCodeLine{1405         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1406     \textcolor{keywordflow}{case} 8: \textcolor{comment}{/* 8xx: Set panning */}}
\DoxyCodeLine{1407         ch-\/>panning = (float)s-\/>effect\_param / 255.f;}
\DoxyCodeLine{1408         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1409     \textcolor{keywordflow}{case} 9: \textcolor{comment}{/* 9xx: Sample offset */}}
\DoxyCodeLine{1410         \textcolor{keywordflow}{if}(ch-\/>sample != 0) \{ \textcolor{comment}{//\&\& NOTE\_IS\_VALID(s-\/>note)) \{}}
\DoxyCodeLine{1411             uint32\_t final\_offset = s-\/>effect\_param << (ch-\/>sample-\/>bits == 16 ? 7 : 8);}
\DoxyCodeLine{1412             \textcolor{keywordflow}{switch} (ch-\/>sample-\/>loop\_type) \{}
\DoxyCodeLine{1413             \textcolor{keywordflow}{case} jar\_xm\_NO\_LOOP:}
\DoxyCodeLine{1414                 \textcolor{keywordflow}{if}(final\_offset >= ch-\/>sample-\/>length) \{ \textcolor{comment}{/* Pretend the sample dosen't loop and is done playing */}}
\DoxyCodeLine{1415                     ch-\/>sample\_position = -\/1;}
\DoxyCodeLine{1416                 \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1417                     ch-\/>sample\_position = final\_offset;}
\DoxyCodeLine{1418                 \}}
\DoxyCodeLine{1419                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{1420             \textcolor{keywordflow}{case} jar\_xm\_FORWARD\_LOOP:}
\DoxyCodeLine{1421                 \textcolor{keywordflow}{if} (final\_offset >= ch-\/>sample-\/>loop\_end) \{}
\DoxyCodeLine{1422                     ch-\/>sample\_position -\/= ch-\/>sample-\/>loop\_length;}
\DoxyCodeLine{1423                 \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(final\_offset >= ch-\/>sample-\/>length) \{}
\DoxyCodeLine{1424                     ch-\/>sample\_position = ch-\/>sample-\/>loop\_start;}
\DoxyCodeLine{1425                 \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1426                     ch-\/>sample\_position = final\_offset;}
\DoxyCodeLine{1427                 \}}
\DoxyCodeLine{1428                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{1429             \textcolor{keywordflow}{case} jar\_xm\_PING\_PONG\_LOOP:}
\DoxyCodeLine{1430                 \textcolor{keywordflow}{if}(final\_offset >= ch-\/>sample-\/>loop\_end) \{}
\DoxyCodeLine{1431                     ch-\/>ping = \textcolor{keyword}{false};}
\DoxyCodeLine{1432                     ch-\/>sample\_position = (ch-\/>sample-\/>loop\_end << 1) -\/ ch-\/>sample\_position;}
\DoxyCodeLine{1433                 \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(final\_offset >= ch-\/>sample-\/>length) \{}
\DoxyCodeLine{1434                     ch-\/>ping = \textcolor{keyword}{false};}
\DoxyCodeLine{1435                     ch-\/>sample\_position -\/= ch-\/>sample-\/>length -\/ 1;}
\DoxyCodeLine{1436                 \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1437                     ch-\/>sample\_position = final\_offset;}
\DoxyCodeLine{1438                 \};}
\DoxyCodeLine{1439                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{1440             \}}
\DoxyCodeLine{1441         \}}
\DoxyCodeLine{1442         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1443     \textcolor{keywordflow}{case} 0xA: \textcolor{comment}{/* Axy: Volume slide */}}
\DoxyCodeLine{1444         \textcolor{keywordflow}{if}(s-\/>effect\_param > 0) \{    ch-\/>volume\_slide\_param = s-\/>effect\_param; \}}
\DoxyCodeLine{1445         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1446     \textcolor{keywordflow}{case} 0xB: \textcolor{comment}{/* Bxx: Position jump */}}
\DoxyCodeLine{1447         \textcolor{keywordflow}{if}(s-\/>effect\_param < ctx-\/>module.length) \{}
\DoxyCodeLine{1448             ctx-\/>position\_jump = \textcolor{keyword}{true};}
\DoxyCodeLine{1449             ctx-\/>jump\_dest = s-\/>effect\_param;}
\DoxyCodeLine{1450         \}}
\DoxyCodeLine{1451         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1452     \textcolor{keywordflow}{case} 0xC: \textcolor{comment}{/* Cxx: Set volume */}}
\DoxyCodeLine{1453         ch-\/>volume = (float)((s-\/>effect\_param > 0x40) ? 0x40 : s-\/>effect\_param) / (\textcolor{keywordtype}{float})0x40;}
\DoxyCodeLine{1454         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1455     \textcolor{keywordflow}{case} 0xD: \textcolor{comment}{/* Dxx: Pattern break */}}
\DoxyCodeLine{1456         \textcolor{comment}{/* Jump after playing this line */}}
\DoxyCodeLine{1457         ctx-\/>pattern\_break = \textcolor{keyword}{true};}
\DoxyCodeLine{1458         ctx-\/>jump\_row = (s-\/>effect\_param >> 4) * 10 + (s-\/>effect\_param \& 0x0F);}
\DoxyCodeLine{1459         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1460     \textcolor{keywordflow}{case} 0xE: \textcolor{comment}{/* EXy: Extended command */}}
\DoxyCodeLine{1461         \textcolor{keywordflow}{switch}(s-\/>effect\_param >> 4) \{}
\DoxyCodeLine{1462         \textcolor{keywordflow}{case} 1: \textcolor{comment}{/* E1y: Fine portamento up */}}
\DoxyCodeLine{1463             \textcolor{keywordflow}{if}(s-\/>effect\_param \& 0x0F) \{    ch-\/>fine\_portamento\_up\_param = s-\/>effect\_param \& 0x0F; \}}
\DoxyCodeLine{1464             jar\_xm\_pitch\_slide(ctx, ch, -\/ch-\/>fine\_portamento\_up\_param);}
\DoxyCodeLine{1465             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1466         \textcolor{keywordflow}{case} 2: \textcolor{comment}{/* E2y: Fine portamento down */}}
\DoxyCodeLine{1467             \textcolor{keywordflow}{if}(s-\/>effect\_param \& 0x0F) \{    ch-\/>fine\_portamento\_down\_param = s-\/>effect\_param \& 0x0F; \}}
\DoxyCodeLine{1468             jar\_xm\_pitch\_slide(ctx, ch, ch-\/>fine\_portamento\_down\_param);}
\DoxyCodeLine{1469             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1470         \textcolor{keywordflow}{case} 4: \textcolor{comment}{/* E4y: Set vibrato control */}}
\DoxyCodeLine{1471             ch-\/>vibrato\_waveform = s-\/>effect\_param \& 3;}
\DoxyCodeLine{1472             ch-\/>vibrato\_waveform\_retrigger = !((s-\/>effect\_param >> 2) \& 1);}
\DoxyCodeLine{1473             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1474         \textcolor{keywordflow}{case} 5: \textcolor{comment}{/* E5y: Set finetune */}}
\DoxyCodeLine{1475             \textcolor{keywordflow}{if}(NOTE\_IS\_VALID(ch-\/>current-\/>note) \&\& ch-\/>sample != NULL) \{}
\DoxyCodeLine{1476                 ch-\/>note = ch-\/>current-\/>note + ch-\/>sample-\/>relative\_note + (float)(((s-\/>effect\_param \& 0x0F) -\/ 8) << 4) / 128.f -\/ 1.f;}
\DoxyCodeLine{1477                 ch-\/>period = jar\_xm\_period(ctx, ch-\/>note);}
\DoxyCodeLine{1478                 jar\_xm\_update\_frequency(ctx, ch);}
\DoxyCodeLine{1479             \}}
\DoxyCodeLine{1480             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1481         \textcolor{keywordflow}{case} 6: \textcolor{comment}{/* E6y: Pattern loop */}}
\DoxyCodeLine{1482             \textcolor{keywordflow}{if}(s-\/>effect\_param \& 0x0F) \{}
\DoxyCodeLine{1483                 \textcolor{keywordflow}{if}((s-\/>effect\_param \& 0x0F) == ch-\/>pattern\_loop\_count) \{   \textcolor{comment}{/* Loop is over */}}
\DoxyCodeLine{1484                     ch-\/>pattern\_loop\_count = 0;}
\DoxyCodeLine{1485                     ctx-\/>position\_jump = \textcolor{keyword}{false};}
\DoxyCodeLine{1486                 \} \textcolor{keywordflow}{else} \{    \textcolor{comment}{/* Jump to the beginning of the loop */}}
\DoxyCodeLine{1487                     ch-\/>pattern\_loop\_count++;}
\DoxyCodeLine{1488                     ctx-\/>position\_jump = \textcolor{keyword}{true};}
\DoxyCodeLine{1489                     ctx-\/>jump\_row = ch-\/>pattern\_loop\_origin;}
\DoxyCodeLine{1490                     ctx-\/>jump\_dest = ctx-\/>current\_table\_index;}
\DoxyCodeLine{1491                 \}}
\DoxyCodeLine{1492             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1493                 ch-\/>pattern\_loop\_origin = ctx-\/>current\_row; \textcolor{comment}{/* Set loop start point */}}
\DoxyCodeLine{1494                 ctx-\/>jump\_row = ch-\/>pattern\_loop\_origin;    \textcolor{comment}{/* Replicate FT2 E60 bug */}}
\DoxyCodeLine{1495             \}}
\DoxyCodeLine{1496             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1497         \textcolor{keywordflow}{case} 7: \textcolor{comment}{/* E7y: Set tremolo control */}}
\DoxyCodeLine{1498             ch-\/>tremolo\_waveform = s-\/>effect\_param \& 3;}
\DoxyCodeLine{1499             ch-\/>tremolo\_waveform\_retrigger = !((s-\/>effect\_param >> 2) \& 1);}
\DoxyCodeLine{1500             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1501         \textcolor{keywordflow}{case} 0xA: \textcolor{comment}{/* EAy: Fine volume slide up */}}
\DoxyCodeLine{1502             \textcolor{keywordflow}{if}(s-\/>effect\_param \& 0x0F) \{   ch-\/>fine\_volume\_slide\_param = s-\/>effect\_param \& 0x0F; \}}
\DoxyCodeLine{1503             jar\_xm\_volume\_slide(ch, ch-\/>fine\_volume\_slide\_param << 4);}
\DoxyCodeLine{1504             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1505         \textcolor{keywordflow}{case} 0xB: \textcolor{comment}{/* EBy: Fine volume slide down */}}
\DoxyCodeLine{1506             \textcolor{keywordflow}{if}(s-\/>effect\_param \& 0x0F) \{   ch-\/>fine\_volume\_slide\_param = s-\/>effect\_param \& 0x0F; \}}
\DoxyCodeLine{1507             jar\_xm\_volume\_slide(ch, ch-\/>fine\_volume\_slide\_param);}
\DoxyCodeLine{1508             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1509         \textcolor{keywordflow}{case} 0xD: \textcolor{comment}{/* EDy: Note delay */}}
\DoxyCodeLine{1510             \textcolor{comment}{/* XXX: figure this out better. EDx triggers the note even when there no note and no instrument. But ED0 acts like like a ghost note, EDx (x  0) does not. */}}
\DoxyCodeLine{1511             \textcolor{keywordflow}{if}(s-\/>note == 0 \&\& s-\/>instrument == 0) \{}
\DoxyCodeLine{1512                 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} flags = jar\_xm\_TRIGGER\_KEEP\_VOLUME;}
\DoxyCodeLine{1513                 \textcolor{keywordflow}{if}(ch-\/>current-\/>effect\_param \& 0x0F) \{}
\DoxyCodeLine{1514                     ch-\/>note = ch-\/>orig\_note;}
\DoxyCodeLine{1515                     jar\_xm\_trigger\_note(ctx, ch, flags);}
\DoxyCodeLine{1516                 \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1517                     jar\_xm\_trigger\_note(ctx, ch, flags | jar\_xm\_TRIGGER\_KEEP\_PERIOD | jar\_xm\_TRIGGER\_KEEP\_SAMPLE\_POSITION );}
\DoxyCodeLine{1518                 \}}
\DoxyCodeLine{1519             \}}
\DoxyCodeLine{1520             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1521 }
\DoxyCodeLine{1522         \textcolor{keywordflow}{case} 0xE: \textcolor{comment}{/* EEy: Pattern delay */}}
\DoxyCodeLine{1523             ctx-\/>extra\_ticks = (ch-\/>current-\/>effect\_param \& 0x0F) * ctx-\/>tempo;}
\DoxyCodeLine{1524             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1525         \textcolor{keywordflow}{default}:}
\DoxyCodeLine{1526             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1527         \}}
\DoxyCodeLine{1528         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1529 }
\DoxyCodeLine{1530     \textcolor{keywordflow}{case} 0xF: \textcolor{comment}{/* Fxx: Set tempo/BPM */}}
\DoxyCodeLine{1531         \textcolor{keywordflow}{if}(s-\/>effect\_param > 0) \{}
\DoxyCodeLine{1532             \textcolor{keywordflow}{if}(s-\/>effect\_param <= 0x1F) \{  \textcolor{comment}{// First 32 possible values adjust the ticks (goes into tempo)}}
\DoxyCodeLine{1533                 ctx-\/>tempo = s-\/>effect\_param;}
\DoxyCodeLine{1534             \} \textcolor{keywordflow}{else} \{                       \textcolor{comment}{//32 and greater values adjust the BPM}}
\DoxyCodeLine{1535                 ctx-\/>bpm = s-\/>effect\_param;}
\DoxyCodeLine{1536             \}}
\DoxyCodeLine{1537         \}}
\DoxyCodeLine{1538         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1539 }
\DoxyCodeLine{1540     \textcolor{keywordflow}{case} 16: \textcolor{comment}{/* Gxx: Set global volume */}}
\DoxyCodeLine{1541         ctx-\/>global\_volume = (float)((s-\/>effect\_param > 0x40) ? 0x40 : s-\/>effect\_param) / (\textcolor{keywordtype}{float})0x40;}
\DoxyCodeLine{1542         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1543     \textcolor{keywordflow}{case} 17: \textcolor{comment}{/* Hxy: Global volume slide */}}
\DoxyCodeLine{1544         \textcolor{keywordflow}{if}(s-\/>effect\_param > 0) \{    ch-\/>global\_volume\_slide\_param = s-\/>effect\_param; \}}
\DoxyCodeLine{1545         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1546     \textcolor{keywordflow}{case} 21: \textcolor{comment}{/* Lxx: Set envelope position */}}
\DoxyCodeLine{1547         ch-\/>volume\_envelope\_frame\_count = s-\/>effect\_param;}
\DoxyCodeLine{1548         ch-\/>panning\_envelope\_frame\_count = s-\/>effect\_param;}
\DoxyCodeLine{1549         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1550     \textcolor{keywordflow}{case} 25: \textcolor{comment}{/* Pxy: Panning slide */}}
\DoxyCodeLine{1551         \textcolor{keywordflow}{if}(s-\/>effect\_param > 0) \{   ch-\/>panning\_slide\_param = s-\/>effect\_param; \}}
\DoxyCodeLine{1552         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1553     \textcolor{keywordflow}{case} 27: \textcolor{comment}{/* Rxy: Multi retrig note */}}
\DoxyCodeLine{1554         \textcolor{keywordflow}{if}(s-\/>effect\_param > 0) \{}
\DoxyCodeLine{1555             \textcolor{keywordflow}{if}((s-\/>effect\_param >> 4) == 0) \{    \textcolor{comment}{/* Keep previous x value */}}
\DoxyCodeLine{1556                 ch-\/>multi\_retrig\_param = (ch-\/>multi\_retrig\_param \& 0xF0) | (s-\/>effect\_param \& 0x0F);}
\DoxyCodeLine{1557             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1558                 ch-\/>multi\_retrig\_param = s-\/>effect\_param;}
\DoxyCodeLine{1559             \}}
\DoxyCodeLine{1560         \}}
\DoxyCodeLine{1561         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1562     \textcolor{keywordflow}{case} 29: \textcolor{comment}{/* Txy: Tremor */}}
\DoxyCodeLine{1563         \textcolor{keywordflow}{if}(s-\/>effect\_param > 0) \{ ch-\/>tremor\_param = s-\/>effect\_param; \}  \textcolor{comment}{/* Tremor x and y params are not separately kept in memory, unlike Rxy */}}
\DoxyCodeLine{1564         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1565     \textcolor{keywordflow}{case} 33: \textcolor{comment}{/* Xxy: Extra stuff */}}
\DoxyCodeLine{1566         \textcolor{keywordflow}{switch}(s-\/>effect\_param >> 4) \{}
\DoxyCodeLine{1567         \textcolor{keywordflow}{case} 1: \textcolor{comment}{/* X1y: Extra fine portamento up */}}
\DoxyCodeLine{1568             \textcolor{keywordflow}{if}(s-\/>effect\_param \& 0x0F) \{    ch-\/>extra\_fine\_portamento\_up\_param = s-\/>effect\_param \& 0x0F; \}}
\DoxyCodeLine{1569             jar\_xm\_pitch\_slide(ctx, ch, -\/1.0f * ch-\/>extra\_fine\_portamento\_up\_param);}
\DoxyCodeLine{1570             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1571         \textcolor{keywordflow}{case} 2: \textcolor{comment}{/* X2y: Extra fine portamento down */}}
\DoxyCodeLine{1572             \textcolor{keywordflow}{if}(s-\/>effect\_param \& 0x0F) \{   ch-\/>extra\_fine\_portamento\_down\_param = s-\/>effect\_param \& 0x0F; \}}
\DoxyCodeLine{1573             jar\_xm\_pitch\_slide(ctx, ch, ch-\/>extra\_fine\_portamento\_down\_param);}
\DoxyCodeLine{1574             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1575         \textcolor{keywordflow}{default}:}
\DoxyCodeLine{1576             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1577         \}}
\DoxyCodeLine{1578         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1579     \textcolor{keywordflow}{default}:}
\DoxyCodeLine{1580         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1581     \}}
\DoxyCodeLine{1582 \}}
\DoxyCodeLine{1583 }
\DoxyCodeLine{1584 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_trigger\_note(jar\_xm\_context\_t* ctx, jar\_xm\_channel\_context\_t* ch, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} flags) \{}
\DoxyCodeLine{1585     \textcolor{keywordflow}{if} (!(flags \& jar\_xm\_TRIGGER\_KEEP\_SAMPLE\_POSITION)) \{}
\DoxyCodeLine{1586         ch-\/>sample\_position = 0.f;}
\DoxyCodeLine{1587         ch-\/>ping = \textcolor{keyword}{true};}
\DoxyCodeLine{1588     \};}
\DoxyCodeLine{1589 }
\DoxyCodeLine{1590     \textcolor{keywordflow}{if} (!(flags \& jar\_xm\_TRIGGER\_KEEP\_VOLUME)) \{}
\DoxyCodeLine{1591        \textcolor{keywordflow}{if}(ch-\/>sample != NULL) \{}
\DoxyCodeLine{1592         ch-\/>volume = ch-\/>sample-\/>volume;}
\DoxyCodeLine{1593         \};}
\DoxyCodeLine{1594     \};}
\DoxyCodeLine{1595     ch-\/>panning = ch-\/>sample-\/>panning;}
\DoxyCodeLine{1596     ch-\/>sustained = \textcolor{keyword}{true};}
\DoxyCodeLine{1597     ch-\/>fadeout\_volume = ch-\/>volume\_envelope\_volume = 1.0f;}
\DoxyCodeLine{1598     ch-\/>panning\_envelope\_panning = .5f;}
\DoxyCodeLine{1599     ch-\/>volume\_envelope\_frame\_count = ch-\/>panning\_envelope\_frame\_count = 0;}
\DoxyCodeLine{1600     ch-\/>vibrato\_note\_offset = 0.f;}
\DoxyCodeLine{1601     ch-\/>tremolo\_volume = 0.f;}
\DoxyCodeLine{1602     ch-\/>tremor\_on = \textcolor{keyword}{false};}
\DoxyCodeLine{1603     ch-\/>autovibrato\_ticks = 0;}
\DoxyCodeLine{1604 }
\DoxyCodeLine{1605     \textcolor{keywordflow}{if}(ch-\/>vibrato\_waveform\_retrigger) \{ ch-\/>vibrato\_ticks = 0; \} \textcolor{comment}{/* XXX: should the waveform itself also be reset to sine? */}}
\DoxyCodeLine{1606     \textcolor{keywordflow}{if}(ch-\/>tremolo\_waveform\_retrigger) \{ ch-\/>tremolo\_ticks = 0; \}}
\DoxyCodeLine{1607     \textcolor{keywordflow}{if}(!(flags \& jar\_xm\_TRIGGER\_KEEP\_PERIOD)) \{}
\DoxyCodeLine{1608         ch-\/>period = jar\_xm\_period(ctx, ch-\/>note);}
\DoxyCodeLine{1609         jar\_xm\_update\_frequency(ctx, ch);}
\DoxyCodeLine{1610     \}}
\DoxyCodeLine{1611     ch-\/>latest\_trigger = ctx-\/>generated\_samples;}
\DoxyCodeLine{1612     \textcolor{keywordflow}{if}(ch-\/>instrument != NULL) \{ ch-\/>instrument-\/>latest\_trigger = ctx-\/>generated\_samples; \}}
\DoxyCodeLine{1613     \textcolor{keywordflow}{if}(ch-\/>sample != NULL) \{     ch-\/>sample-\/>latest\_trigger = ctx-\/>generated\_samples; \}}
\DoxyCodeLine{1614 \}}
\DoxyCodeLine{1615 }
\DoxyCodeLine{1616 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_cut\_note(jar\_xm\_channel\_context\_t* ch) \{}
\DoxyCodeLine{1617     ch-\/>volume = .0f; \textcolor{comment}{/* NB: this is not the same as Key Off */}}
\DoxyCodeLine{1618 \textcolor{comment}{//    ch-\/>curr\_left = .0f;}}
\DoxyCodeLine{1619 \textcolor{comment}{//    ch-\/>curr\_right = .0f;}}
\DoxyCodeLine{1620 \}}
\DoxyCodeLine{1621 }
\DoxyCodeLine{1622 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_key\_off(jar\_xm\_channel\_context\_t* ch) \{}
\DoxyCodeLine{1623     ch-\/>sustained = \textcolor{keyword}{false}; \textcolor{comment}{/* Key Off */}}
\DoxyCodeLine{1624     \textcolor{keywordflow}{if}(ch-\/>instrument == NULL || !ch-\/>instrument-\/>volume\_envelope.enabled) \{ jar\_xm\_cut\_note(ch); \} \textcolor{comment}{/* If no volume envelope is used, also cut the note */}}
\DoxyCodeLine{1625 \}}
\DoxyCodeLine{1626 }
\DoxyCodeLine{1627 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_row(jar\_xm\_context\_t* ctx) \{}
\DoxyCodeLine{1628     \textcolor{keywordflow}{if}(ctx-\/>position\_jump) \{}
\DoxyCodeLine{1629         ctx-\/>current\_table\_index = ctx-\/>jump\_dest;}
\DoxyCodeLine{1630         ctx-\/>current\_row = ctx-\/>jump\_row;}
\DoxyCodeLine{1631         ctx-\/>position\_jump = \textcolor{keyword}{false};}
\DoxyCodeLine{1632         ctx-\/>pattern\_break = \textcolor{keyword}{false};}
\DoxyCodeLine{1633         ctx-\/>jump\_row = 0;}
\DoxyCodeLine{1634         jar\_xm\_post\_pattern\_change(ctx);}
\DoxyCodeLine{1635     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(ctx-\/>pattern\_break) \{}
\DoxyCodeLine{1636         ctx-\/>current\_table\_index++;}
\DoxyCodeLine{1637         ctx-\/>current\_row = ctx-\/>jump\_row;}
\DoxyCodeLine{1638         ctx-\/>pattern\_break = \textcolor{keyword}{false};}
\DoxyCodeLine{1639         ctx-\/>jump\_row = 0;}
\DoxyCodeLine{1640         jar\_xm\_post\_pattern\_change(ctx);}
\DoxyCodeLine{1641     \}}
\DoxyCodeLine{1642     jar\_xm\_pattern\_t* cur = ctx-\/>module.patterns + ctx-\/>module.pattern\_table[ctx-\/>current\_table\_index];}
\DoxyCodeLine{1643     \textcolor{keywordtype}{bool} in\_a\_loop = \textcolor{keyword}{false};}
\DoxyCodeLine{1644 }
\DoxyCodeLine{1645     \textcolor{comment}{/* Read notes information for all channels into temporary pattern slot */}}
\DoxyCodeLine{1646     \textcolor{keywordflow}{for}(uint8\_t i = 0; i < ctx-\/>module.num\_channels; ++i) \{}
\DoxyCodeLine{1647         jar\_xm\_pattern\_slot\_t* s = cur-\/>slots + ctx-\/>current\_row * ctx-\/>module.num\_channels + i;}
\DoxyCodeLine{1648         jar\_xm\_channel\_context\_t* ch = ctx-\/>channels + i;}
\DoxyCodeLine{1649         ch-\/>current = s;}
\DoxyCodeLine{1650         \textcolor{comment}{// If there is no note delay effect (0xED) then...}}
\DoxyCodeLine{1651         \textcolor{keywordflow}{if}(s-\/>effect\_type != 0xE || s-\/>effect\_param >> 4 != 0xD) \{}
\DoxyCodeLine{1652             \textcolor{comment}{//********** Process the channel slot information **********}}
\DoxyCodeLine{1653             jar\_xm\_handle\_note\_and\_instrument(ctx, ch, s);}
\DoxyCodeLine{1654         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1655             \textcolor{comment}{// read the note delay information}}
\DoxyCodeLine{1656             ch-\/>note\_delay\_param = s-\/>effect\_param \& 0x0F;}
\DoxyCodeLine{1657         \}}
\DoxyCodeLine{1658         \textcolor{keywordflow}{if}(!in\_a\_loop \&\& ch-\/>pattern\_loop\_count > 0) \{}
\DoxyCodeLine{1659             \textcolor{comment}{// clarify if in a loop or not}}
\DoxyCodeLine{1660             in\_a\_loop = \textcolor{keyword}{true};}
\DoxyCodeLine{1661         \}}
\DoxyCodeLine{1662     \}}
\DoxyCodeLine{1663 }
\DoxyCodeLine{1664     \textcolor{keywordflow}{if}(!in\_a\_loop) \{}
\DoxyCodeLine{1665         \textcolor{comment}{/* No E6y loop is in effect (or we are in the first pass) */}}
\DoxyCodeLine{1666         ctx-\/>loop\_count = (ctx-\/>row\_loop\_count[MAX\_NUM\_ROWS * ctx-\/>current\_table\_index + ctx-\/>current\_row]++);}
\DoxyCodeLine{1667     \}}
\DoxyCodeLine{1668 }
\DoxyCodeLine{1670     ctx-\/>current\_row++; \textcolor{comment}{/* uint8 warning: can increment from 255 to 0, in which case it is still necessary to go the next pattern. */}}
\DoxyCodeLine{1671     \textcolor{keywordflow}{if} (!ctx-\/>position\_jump \&\& !ctx-\/>pattern\_break \&\& (ctx-\/>current\_row >= cur-\/>num\_rows || ctx-\/>current\_row == 0)) \{}
\DoxyCodeLine{1672         ctx-\/>current\_table\_index++;}
\DoxyCodeLine{1673         ctx-\/>current\_row = ctx-\/>jump\_row; \textcolor{comment}{/* This will be 0 most of the time, except when E60 is used */}}
\DoxyCodeLine{1674         ctx-\/>jump\_row = 0;}
\DoxyCodeLine{1675         jar\_xm\_post\_pattern\_change(ctx);}
\DoxyCodeLine{1676     \}}
\DoxyCodeLine{1677 \}}
\DoxyCodeLine{1678 }
\DoxyCodeLine{1679 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_envelope\_tick(jar\_xm\_channel\_context\_t *ch, jar\_xm\_envelope\_t *env, uint16\_t *counter, \textcolor{keywordtype}{float} *outval) \{}
\DoxyCodeLine{1680     \textcolor{keywordflow}{if}(env-\/>num\_points < 2) \{}
\DoxyCodeLine{1681         \textcolor{keywordflow}{if}(env-\/>num\_points == 1) \{}
\DoxyCodeLine{1682             *outval = (float)env-\/>points[0].value / (\textcolor{keywordtype}{float})0x40;}
\DoxyCodeLine{1683             \textcolor{keywordflow}{if}(*outval > 1) \{ *outval = 1; \};}
\DoxyCodeLine{1684         \} \textcolor{keywordflow}{else} \{;}
\DoxyCodeLine{1685             \textcolor{keywordflow}{return};}
\DoxyCodeLine{1686         \};}
\DoxyCodeLine{1687     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1688         \textcolor{keywordflow}{if}(env-\/>loop\_enabled) \{}
\DoxyCodeLine{1689             uint16\_t loop\_start = env-\/>points[env-\/>loop\_start\_point].frame;}
\DoxyCodeLine{1690             uint16\_t loop\_end = env-\/>points[env-\/>loop\_end\_point].frame;}
\DoxyCodeLine{1691             uint16\_t loop\_length = loop\_end -\/ loop\_start;}
\DoxyCodeLine{1692             \textcolor{keywordflow}{if}(*counter >= loop\_end) \{ *counter -\/= loop\_length; \};}
\DoxyCodeLine{1693         \};}
\DoxyCodeLine{1694         \textcolor{keywordflow}{for}(uint8\_t j = 0; j < (env-\/>num\_points -\/ 1); ++j) \{}
\DoxyCodeLine{1695             \textcolor{keywordflow}{if}(env-\/>points[j].frame <= *counter \&\& env-\/>points[j+1].frame >= *counter) \{}
\DoxyCodeLine{1696                 *outval = jar\_xm\_envelope\_lerp(env-\/>points + j, env-\/>points + j + 1, *counter) / (float)0x40;}
\DoxyCodeLine{1697                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{1698             \};}
\DoxyCodeLine{1699         \};}
\DoxyCodeLine{1700         \textcolor{comment}{/* Make sure it is safe to increment frame count */}}
\DoxyCodeLine{1701         \textcolor{keywordflow}{if}(!ch-\/>sustained || !env-\/>sustain\_enabled || *counter != env-\/>points[env-\/>sustain\_point].frame) \{ (*counter)++; \};}
\DoxyCodeLine{1702     \};}
\DoxyCodeLine{1703 \};}
\DoxyCodeLine{1704 }
\DoxyCodeLine{1705 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_envelopes(jar\_xm\_channel\_context\_t *ch) \{}
\DoxyCodeLine{1706     \textcolor{keywordflow}{if}(ch-\/>instrument != NULL) \{}
\DoxyCodeLine{1707         \textcolor{keywordflow}{if}(ch-\/>instrument-\/>volume\_envelope.enabled) \{}
\DoxyCodeLine{1708             \textcolor{keywordflow}{if}(!ch-\/>sustained) \{}
\DoxyCodeLine{1709                 ch-\/>fadeout\_volume -\/= (float)ch-\/>instrument-\/>volume\_fadeout / 65536.f;}
\DoxyCodeLine{1710                 jar\_xm\_CLAMP\_DOWN(ch-\/>fadeout\_volume);}
\DoxyCodeLine{1711             \};}
\DoxyCodeLine{1712             jar\_xm\_envelope\_tick(ch, \&(ch-\/>instrument-\/>volume\_envelope), \&(ch-\/>volume\_envelope\_frame\_count), \&(ch-\/>volume\_envelope\_volume));}
\DoxyCodeLine{1713         \};}
\DoxyCodeLine{1714         \textcolor{keywordflow}{if}(ch-\/>instrument-\/>panning\_envelope.enabled) \{}
\DoxyCodeLine{1715             jar\_xm\_envelope\_tick(ch, \&(ch-\/>instrument-\/>panning\_envelope), \&(ch-\/>panning\_envelope\_frame\_count), \&(ch-\/>panning\_envelope\_panning));}
\DoxyCodeLine{1716         \};}
\DoxyCodeLine{1717     \};}
\DoxyCodeLine{1718 \};}
\DoxyCodeLine{1719 }
\DoxyCodeLine{1720 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_tick(jar\_xm\_context\_t* ctx) \{}
\DoxyCodeLine{1721     \textcolor{keywordflow}{if}(ctx-\/>current\_tick == 0) \{}
\DoxyCodeLine{1722         jar\_xm\_row(ctx);        \textcolor{comment}{// We have processed all ticks and we run the row}}
\DoxyCodeLine{1723     \}}
\DoxyCodeLine{1724 }
\DoxyCodeLine{1725     jar\_xm\_module\_t* mod = \&(ctx-\/>module);}
\DoxyCodeLine{1726     \textcolor{keywordflow}{for}(uint8\_t i = 0; i < ctx-\/>module.num\_channels; ++i) \{}
\DoxyCodeLine{1727         jar\_xm\_channel\_context\_t* ch = ctx-\/>channels + i;}
\DoxyCodeLine{1728         jar\_xm\_envelopes(ch);}
\DoxyCodeLine{1729         jar\_xm\_autovibrato(ctx, ch);}
\DoxyCodeLine{1730         \textcolor{keywordflow}{if}(ch-\/>arp\_in\_progress \&\& !HAS\_ARPEGGIO(ch-\/>current)) \{}
\DoxyCodeLine{1731             ch-\/>arp\_in\_progress = \textcolor{keyword}{false};}
\DoxyCodeLine{1732             ch-\/>arp\_note\_offset = 0;}
\DoxyCodeLine{1733             jar\_xm\_update\_frequency(ctx, ch);}
\DoxyCodeLine{1734         \}}
\DoxyCodeLine{1735         \textcolor{keywordflow}{if}(ch-\/>vibrato\_in\_progress \&\& !HAS\_VIBRATO(ch-\/>current)) \{}
\DoxyCodeLine{1736             ch-\/>vibrato\_in\_progress = \textcolor{keyword}{false};}
\DoxyCodeLine{1737             ch-\/>vibrato\_note\_offset = 0.f;}
\DoxyCodeLine{1738             jar\_xm\_update\_frequency(ctx, ch);}
\DoxyCodeLine{1739         \}}
\DoxyCodeLine{1740 }
\DoxyCodeLine{1741         \textcolor{comment}{// Effects in volumne column mostly handled on a per tick basis}}
\DoxyCodeLine{1742         \textcolor{keywordflow}{switch}(ch-\/>current-\/>volume\_column \& 0xF0) \{}
\DoxyCodeLine{1743         \textcolor{keywordflow}{case} 0x50: \textcolor{comment}{// Checks for volume = 64}}
\DoxyCodeLine{1744             \textcolor{keywordflow}{if}(ch-\/>current-\/>volume\_column != 0x50) \textcolor{keywordflow}{break};}
\DoxyCodeLine{1745         \textcolor{keywordflow}{case} 0x10: \textcolor{comment}{// Set volume 0-\/15}}
\DoxyCodeLine{1746         \textcolor{keywordflow}{case} 0x20: \textcolor{comment}{// Set volume 16-\/32}}
\DoxyCodeLine{1747         \textcolor{keywordflow}{case} 0x30: \textcolor{comment}{// Set volume 32-\/48}}
\DoxyCodeLine{1748         \textcolor{keywordflow}{case} 0x40: \textcolor{comment}{// Set volume 48-\/64}}
\DoxyCodeLine{1749             ch-\/>volume = (float)(ch-\/>current-\/>volume\_column -\/ 16) / 64.0f;}
\DoxyCodeLine{1750             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1751         \textcolor{keywordflow}{case} 0x60: \textcolor{comment}{// Volume slide down}}
\DoxyCodeLine{1752             jar\_xm\_volume\_slide(ch, ch-\/>current-\/>volume\_column \& 0x0F);}
\DoxyCodeLine{1753             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1754         \textcolor{keywordflow}{case} 0x70: \textcolor{comment}{// Volume slide up}}
\DoxyCodeLine{1755             jar\_xm\_volume\_slide(ch, ch-\/>current-\/>volume\_column << 4);}
\DoxyCodeLine{1756             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1757         \textcolor{keywordflow}{case} 0x80: \textcolor{comment}{// Fine volume slide down}}
\DoxyCodeLine{1758             jar\_xm\_volume\_slide(ch, ch-\/>current-\/>volume\_column \& 0x0F);}
\DoxyCodeLine{1759             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1760         \textcolor{keywordflow}{case} 0x90: \textcolor{comment}{// Fine volume slide up}}
\DoxyCodeLine{1761             jar\_xm\_volume\_slide(ch, ch-\/>current-\/>volume\_column << 4);}
\DoxyCodeLine{1762             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1763         \textcolor{keywordflow}{case} 0xA0: \textcolor{comment}{// Set vibrato speed}}
\DoxyCodeLine{1764             ch-\/>vibrato\_param = (ch-\/>vibrato\_param \& 0x0F) | ((ch-\/>current-\/>volume\_column \& 0x0F) << 4);}
\DoxyCodeLine{1765             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1766         \textcolor{keywordflow}{case} 0xB0: \textcolor{comment}{// Vibrato}}
\DoxyCodeLine{1767             ch-\/>vibrato\_in\_progress = \textcolor{keyword}{false};}
\DoxyCodeLine{1768             jar\_xm\_vibrato(ctx, ch, ch-\/>vibrato\_param, ch-\/>vibrato\_ticks++);}
\DoxyCodeLine{1769             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1770         \textcolor{keywordflow}{case} 0xC0: \textcolor{comment}{// Set panning}}
\DoxyCodeLine{1771             \textcolor{keywordflow}{if}(!ctx-\/>current\_tick ) \{}
\DoxyCodeLine{1772                 ch-\/>panning = (float)(ch-\/>current-\/>volume\_column \& 0x0F) / 15.0f;}
\DoxyCodeLine{1773             \}}
\DoxyCodeLine{1774             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1775         \textcolor{keywordflow}{case} 0xD0: \textcolor{comment}{// Panning slide left}}
\DoxyCodeLine{1776             jar\_xm\_panning\_slide(ch, ch-\/>current-\/>volume\_column \& 0x0F);}
\DoxyCodeLine{1777             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1778         \textcolor{keywordflow}{case} 0xE0: \textcolor{comment}{// Panning slide right}}
\DoxyCodeLine{1779             jar\_xm\_panning\_slide(ch, ch-\/>current-\/>volume\_column << 4);}
\DoxyCodeLine{1780             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1781         \textcolor{keywordflow}{case} 0xF0: \textcolor{comment}{// Tone portamento}}
\DoxyCodeLine{1782             \textcolor{keywordflow}{if}(!ctx-\/>current\_tick ) \{}
\DoxyCodeLine{1783                 \textcolor{keywordflow}{if}(ch-\/>current-\/>volume\_column \& 0x0F) \{ ch-\/>tone\_portamento\_param = ((ch-\/>current-\/>volume\_column \& 0x0F) << 4) | (ch-\/>current-\/>volume\_column \& 0x0F); \}}
\DoxyCodeLine{1784             \};}
\DoxyCodeLine{1785             jar\_xm\_tone\_portamento(ctx, ch);}
\DoxyCodeLine{1786             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1787         \textcolor{keywordflow}{default}:}
\DoxyCodeLine{1788             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1789         \}}
\DoxyCodeLine{1790 }
\DoxyCodeLine{1791         \textcolor{comment}{// Only some standard effects handled on a per tick basis}}
\DoxyCodeLine{1792         \textcolor{comment}{// see jar\_xm\_handle\_note\_and\_instrument for all effects handling on a per row basis}}
\DoxyCodeLine{1793         \textcolor{keywordflow}{switch}(ch-\/>current-\/>effect\_type) \{}
\DoxyCodeLine{1794         \textcolor{keywordflow}{case} 0: \textcolor{comment}{/* 0xy: Arpeggio */}}
\DoxyCodeLine{1795             \textcolor{keywordflow}{if}(ch-\/>current-\/>effect\_param > 0) \{}
\DoxyCodeLine{1796                 \textcolor{keywordtype}{char} arp\_offset = ctx-\/>tempo \% 3;}
\DoxyCodeLine{1797                 \textcolor{keywordflow}{switch}(arp\_offset) \{}
\DoxyCodeLine{1798                 \textcolor{keywordflow}{case} 2: \textcolor{comment}{/* 0 -\/> x -\/> 0 -\/> y -\/> x -\/>  */}}
\DoxyCodeLine{1799                     \textcolor{keywordflow}{if}(ctx-\/>current\_tick == 1) \{}
\DoxyCodeLine{1800                         ch-\/>arp\_in\_progress = \textcolor{keyword}{true};}
\DoxyCodeLine{1801                         ch-\/>arp\_note\_offset = ch-\/>current-\/>effect\_param >> 4;}
\DoxyCodeLine{1802                         jar\_xm\_update\_frequency(ctx, ch);}
\DoxyCodeLine{1803                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1804                     \}}
\DoxyCodeLine{1805                     \textcolor{comment}{/* No break here, this is intended */}}
\DoxyCodeLine{1806                 \textcolor{keywordflow}{case} 1: \textcolor{comment}{/* 0 -\/> 0 -\/> y -\/> x -\/>  */}}
\DoxyCodeLine{1807                     \textcolor{keywordflow}{if}(ctx-\/>current\_tick == 0) \{}
\DoxyCodeLine{1808                         ch-\/>arp\_in\_progress = \textcolor{keyword}{false};}
\DoxyCodeLine{1809                         ch-\/>arp\_note\_offset = 0;}
\DoxyCodeLine{1810                         jar\_xm\_update\_frequency(ctx, ch);}
\DoxyCodeLine{1811                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1812                     \}}
\DoxyCodeLine{1813                     \textcolor{comment}{/* No break here, this is intended */}}
\DoxyCodeLine{1814                 \textcolor{keywordflow}{case} 0: \textcolor{comment}{/* 0 -\/> y -\/> x -\/>  */}}
\DoxyCodeLine{1815                     jar\_xm\_arpeggio(ctx, ch, ch-\/>current-\/>effect\_param, ctx-\/>current\_tick -\/ arp\_offset);}
\DoxyCodeLine{1816                 \textcolor{keywordflow}{default}:}
\DoxyCodeLine{1817                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{1818                 \}}
\DoxyCodeLine{1819             \}}
\DoxyCodeLine{1820             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1821 }
\DoxyCodeLine{1822         \textcolor{keywordflow}{case} 1: \textcolor{comment}{/* 1xx: Portamento up */}}
\DoxyCodeLine{1823             \textcolor{keywordflow}{if}(ctx-\/>current\_tick == 0) \textcolor{keywordflow}{break};}
\DoxyCodeLine{1824             jar\_xm\_pitch\_slide(ctx, ch, -\/ch-\/>portamento\_up\_param);}
\DoxyCodeLine{1825             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1826         \textcolor{keywordflow}{case} 2: \textcolor{comment}{/* 2xx: Portamento down */}}
\DoxyCodeLine{1827             \textcolor{keywordflow}{if}(ctx-\/>current\_tick == 0) \textcolor{keywordflow}{break};}
\DoxyCodeLine{1828             jar\_xm\_pitch\_slide(ctx, ch, ch-\/>portamento\_down\_param);}
\DoxyCodeLine{1829             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1830         \textcolor{keywordflow}{case} 3: \textcolor{comment}{/* 3xx: Tone portamento */}}
\DoxyCodeLine{1831             \textcolor{keywordflow}{if}(ctx-\/>current\_tick == 0) \textcolor{keywordflow}{break};}
\DoxyCodeLine{1832             jar\_xm\_tone\_portamento(ctx, ch);}
\DoxyCodeLine{1833             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1834         \textcolor{keywordflow}{case} 4: \textcolor{comment}{/* 4xy: Vibrato */}}
\DoxyCodeLine{1835             \textcolor{keywordflow}{if}(ctx-\/>current\_tick == 0) \textcolor{keywordflow}{break};}
\DoxyCodeLine{1836             ch-\/>vibrato\_in\_progress = \textcolor{keyword}{true};}
\DoxyCodeLine{1837             jar\_xm\_vibrato(ctx, ch, ch-\/>vibrato\_param, ch-\/>vibrato\_ticks++);}
\DoxyCodeLine{1838             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1839         \textcolor{keywordflow}{case} 5: \textcolor{comment}{/* 5xy: Tone portamento + Volume slide */}}
\DoxyCodeLine{1840             \textcolor{keywordflow}{if}(ctx-\/>current\_tick == 0) \textcolor{keywordflow}{break};}
\DoxyCodeLine{1841             jar\_xm\_tone\_portamento(ctx, ch);}
\DoxyCodeLine{1842             jar\_xm\_volume\_slide(ch, ch-\/>volume\_slide\_param);}
\DoxyCodeLine{1843             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1844         \textcolor{keywordflow}{case} 6: \textcolor{comment}{/* 6xy: Vibrato + Volume slide */}}
\DoxyCodeLine{1845             \textcolor{keywordflow}{if}(ctx-\/>current\_tick == 0) \textcolor{keywordflow}{break};}
\DoxyCodeLine{1846             ch-\/>vibrato\_in\_progress = \textcolor{keyword}{true};}
\DoxyCodeLine{1847             jar\_xm\_vibrato(ctx, ch, ch-\/>vibrato\_param, ch-\/>vibrato\_ticks++);}
\DoxyCodeLine{1848             jar\_xm\_volume\_slide(ch, ch-\/>volume\_slide\_param);}
\DoxyCodeLine{1849             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1850         \textcolor{keywordflow}{case} 7: \textcolor{comment}{/* 7xy: Tremolo */}}
\DoxyCodeLine{1851             \textcolor{keywordflow}{if}(ctx-\/>current\_tick == 0) \textcolor{keywordflow}{break};}
\DoxyCodeLine{1852             jar\_xm\_tremolo(ctx, ch, ch-\/>tremolo\_param, ch-\/>tremolo\_ticks++);}
\DoxyCodeLine{1853             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1854         \textcolor{keywordflow}{case} 8: \textcolor{comment}{/* 8xy: Set panning */}}
\DoxyCodeLine{1855             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1856         \textcolor{keywordflow}{case} 9: \textcolor{comment}{/* 9xy: Sample offset */}}
\DoxyCodeLine{1857             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1858         \textcolor{keywordflow}{case} 0xA: \textcolor{comment}{/* Axy: Volume slide */}}
\DoxyCodeLine{1859             \textcolor{keywordflow}{if}(ctx-\/>current\_tick == 0) \textcolor{keywordflow}{break};}
\DoxyCodeLine{1860             jar\_xm\_volume\_slide(ch, ch-\/>volume\_slide\_param);}
\DoxyCodeLine{1861             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1862         \textcolor{keywordflow}{case} 0xE: \textcolor{comment}{/* EXy: Extended command */}}
\DoxyCodeLine{1863             \textcolor{keywordflow}{switch}(ch-\/>current-\/>effect\_param >> 4) \{}
\DoxyCodeLine{1864             \textcolor{keywordflow}{case} 0x9: \textcolor{comment}{/* E9y: Retrigger note */}}
\DoxyCodeLine{1865                 \textcolor{keywordflow}{if}(ctx-\/>current\_tick != 0 \&\& ch-\/>current-\/>effect\_param \& 0x0F) \{}
\DoxyCodeLine{1866                     \textcolor{keywordflow}{if}(!(ctx-\/>current\_tick \% (ch-\/>current-\/>effect\_param \& 0x0F))) \{}
\DoxyCodeLine{1867                         jar\_xm\_trigger\_note(ctx, ch, 0);}
\DoxyCodeLine{1868                         jar\_xm\_envelopes(ch);}
\DoxyCodeLine{1869                     \}}
\DoxyCodeLine{1870                 \}}
\DoxyCodeLine{1871                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{1872             \textcolor{keywordflow}{case} 0xC: \textcolor{comment}{/* ECy: Note cut */}}
\DoxyCodeLine{1873                 \textcolor{keywordflow}{if}((ch-\/>current-\/>effect\_param \& 0x0F) == ctx-\/>current\_tick) \{}
\DoxyCodeLine{1874                     jar\_xm\_cut\_note(ch);}
\DoxyCodeLine{1875                 \}}
\DoxyCodeLine{1876                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{1877             \textcolor{keywordflow}{case} 0xD: \textcolor{comment}{/* EDy: Note delay */}}
\DoxyCodeLine{1878                 \textcolor{keywordflow}{if}(ch-\/>note\_delay\_param == ctx-\/>current\_tick) \{}
\DoxyCodeLine{1879                     jar\_xm\_handle\_note\_and\_instrument(ctx, ch, ch-\/>current);}
\DoxyCodeLine{1880                     jar\_xm\_envelopes(ch);}
\DoxyCodeLine{1881                 \}}
\DoxyCodeLine{1882                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{1883             \textcolor{keywordflow}{default}:}
\DoxyCodeLine{1884                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{1885             \}}
\DoxyCodeLine{1886             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1887         \textcolor{keywordflow}{case} 16: \textcolor{comment}{/* Fxy: Set tempo/BPM */}}
\DoxyCodeLine{1888             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1889         \textcolor{keywordflow}{case} 17: \textcolor{comment}{/* Hxy: Global volume slide */}}
\DoxyCodeLine{1890             \textcolor{keywordflow}{if}(ctx-\/>current\_tick == 0) \textcolor{keywordflow}{break};}
\DoxyCodeLine{1891             \textcolor{keywordflow}{if}((ch-\/>global\_volume\_slide\_param \& 0xF0) \&\& (ch-\/>global\_volume\_slide\_param \& 0x0F)) \{ \textcolor{keywordflow}{break}; \}; \textcolor{comment}{/* Invalid state */}}
\DoxyCodeLine{1892             \textcolor{keywordflow}{if}(ch-\/>global\_volume\_slide\_param \& 0xF0) \{    \textcolor{comment}{/* Global slide up */}}
\DoxyCodeLine{1893                 \textcolor{keywordtype}{float} f = (float)(ch-\/>global\_volume\_slide\_param >> 4) / (float)0x40;}
\DoxyCodeLine{1894                 ctx-\/>global\_volume += f;}
\DoxyCodeLine{1895                 jar\_xm\_CLAMP\_UP(ctx-\/>global\_volume);}
\DoxyCodeLine{1896             \} \textcolor{keywordflow}{else} \{                                      \textcolor{comment}{/* Global slide down */}}
\DoxyCodeLine{1897                 \textcolor{keywordtype}{float} f = (float)(ch-\/>global\_volume\_slide\_param \& 0x0F) / (float)0x40;}
\DoxyCodeLine{1898                 ctx-\/>global\_volume -\/= f;}
\DoxyCodeLine{1899                 jar\_xm\_CLAMP\_DOWN(ctx-\/>global\_volume);}
\DoxyCodeLine{1900             \};}
\DoxyCodeLine{1901             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1902 }
\DoxyCodeLine{1903         \textcolor{keywordflow}{case} 20: \textcolor{comment}{/* Kxx: Key off */}}
\DoxyCodeLine{1904             \textcolor{keywordflow}{if}(ctx-\/>current\_tick == ch-\/>current-\/>effect\_param) \{     jar\_xm\_key\_off(ch); \};}
\DoxyCodeLine{1905             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1906         \textcolor{keywordflow}{case} 21: \textcolor{comment}{/* Lxx: Set envelope position */}}
\DoxyCodeLine{1907             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1908         \textcolor{keywordflow}{case} 25: \textcolor{comment}{/* Pxy: Panning slide */}}
\DoxyCodeLine{1909             \textcolor{keywordflow}{if}(ctx-\/>current\_tick == 0) \textcolor{keywordflow}{break};}
\DoxyCodeLine{1910             jar\_xm\_panning\_slide(ch, ch-\/>panning\_slide\_param);}
\DoxyCodeLine{1911             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1912         \textcolor{keywordflow}{case} 27: \textcolor{comment}{/* Rxy: Multi retrig note */}}
\DoxyCodeLine{1913             \textcolor{keywordflow}{if}(ctx-\/>current\_tick == 0) \textcolor{keywordflow}{break};}
\DoxyCodeLine{1914             \textcolor{keywordflow}{if}(((ch-\/>multi\_retrig\_param) \& 0x0F) == 0) \textcolor{keywordflow}{break};}
\DoxyCodeLine{1915             \textcolor{keywordflow}{if}((ctx-\/>current\_tick \% (ch-\/>multi\_retrig\_param \& 0x0F)) == 0) \{}
\DoxyCodeLine{1916                 \textcolor{keywordtype}{float} v = ch-\/>volume * multi\_retrig\_multiply[ch-\/>multi\_retrig\_param >> 4]}
\DoxyCodeLine{1917                     + multi\_retrig\_add[ch-\/>multi\_retrig\_param >> 4];}
\DoxyCodeLine{1918                 jar\_xm\_CLAMP(v);}
\DoxyCodeLine{1919                 jar\_xm\_trigger\_note(ctx, ch, 0);}
\DoxyCodeLine{1920                 ch-\/>volume = v;}
\DoxyCodeLine{1921             \};}
\DoxyCodeLine{1922             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1923 }
\DoxyCodeLine{1924         \textcolor{keywordflow}{case} 29: \textcolor{comment}{/* Txy: Tremor */}}
\DoxyCodeLine{1925             \textcolor{keywordflow}{if}(ctx-\/>current\_tick == 0) \textcolor{keywordflow}{break};}
\DoxyCodeLine{1926             ch-\/>tremor\_on = ( (ctx-\/>current\_tick -\/ 1) \% ((ch-\/>tremor\_param >> 4) + (ch-\/>tremor\_param \& 0x0F) + 2) > (ch-\/>tremor\_param >> 4)  );}
\DoxyCodeLine{1927             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1928         \textcolor{keywordflow}{default}:}
\DoxyCodeLine{1929             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1930         \};}
\DoxyCodeLine{1931 }
\DoxyCodeLine{1932         \textcolor{keywordtype}{float} panning, volume;}
\DoxyCodeLine{1933         panning = ch-\/>panning + (ch-\/>panning\_envelope\_panning -\/ .5f) * (.5f -\/ fabs(ch-\/>panning -\/ .5f)) * 2.0f;}
\DoxyCodeLine{1934         \textcolor{keywordflow}{if}(ch-\/>tremor\_on) \{}
\DoxyCodeLine{1935             volume = .0f;}
\DoxyCodeLine{1936         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1937             volume = ch-\/>volume + ch-\/>tremolo\_volume;}
\DoxyCodeLine{1938             jar\_xm\_CLAMP(volume);}
\DoxyCodeLine{1939             volume *= ch-\/>fadeout\_volume * ch-\/>volume\_envelope\_volume;}
\DoxyCodeLine{1940         \};}
\DoxyCodeLine{1941 }
\DoxyCodeLine{1942         \textcolor{keywordflow}{if} (mod-\/>ramping) \{}
\DoxyCodeLine{1943             ch-\/>target\_panning = panning;}
\DoxyCodeLine{1944             ch-\/>target\_volume = volume;}
\DoxyCodeLine{1945         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1946             ch-\/>actual\_panning = panning;}
\DoxyCodeLine{1947             ch-\/>actual\_volume = volume;}
\DoxyCodeLine{1948         \};}
\DoxyCodeLine{1949     \};}
\DoxyCodeLine{1950 }
\DoxyCodeLine{1951     ctx-\/>current\_tick++; \textcolor{comment}{// ok so we understand that ticks increment within the row}}
\DoxyCodeLine{1952     \textcolor{keywordflow}{if}(ctx-\/>current\_tick >= ctx-\/>tempo + ctx-\/>extra\_ticks) \{}
\DoxyCodeLine{1953         \textcolor{comment}{// This means it reached the end of the row and we reset}}
\DoxyCodeLine{1954         ctx-\/>current\_tick = 0;}
\DoxyCodeLine{1955         ctx-\/>extra\_ticks = 0;}
\DoxyCodeLine{1956     \};}
\DoxyCodeLine{1957 }
\DoxyCodeLine{1958     \textcolor{comment}{// Number of ticks / second = BPM * 0.4}}
\DoxyCodeLine{1959     ctx-\/>remaining\_samples\_in\_tick += (float)ctx-\/>rate / ((\textcolor{keywordtype}{float})ctx-\/>bpm * 0.4f);}
\DoxyCodeLine{1960 \};}
\DoxyCodeLine{1961 }
\DoxyCodeLine{1962 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_next\_of\_sample(jar\_xm\_context\_t* ctx, jar\_xm\_channel\_context\_t* ch, \textcolor{keywordtype}{int} previous) \{}
\DoxyCodeLine{1963     jar\_xm\_module\_t* mod = \&(ctx-\/>module);}
\DoxyCodeLine{1964 }
\DoxyCodeLine{1965 \textcolor{comment}{//    ch-\/>curr\_left = 0.f;}}
\DoxyCodeLine{1966 \textcolor{comment}{//    ch-\/>curr\_right = 0.f;}}
\DoxyCodeLine{1967     \textcolor{keywordflow}{if}(ch-\/>instrument == NULL || ch-\/>sample == NULL || ch-\/>sample\_position < 0) \{}
\DoxyCodeLine{1968         ch-\/>curr\_left = 0.f;}
\DoxyCodeLine{1969         ch-\/>curr\_right = 0.f;}
\DoxyCodeLine{1970         \textcolor{keywordflow}{if} (mod-\/>ramping) \{}
\DoxyCodeLine{1971             \textcolor{keywordflow}{if} (ch-\/>frame\_count < jar\_xm\_SAMPLE\_RAMPING\_POINTS) \{}
\DoxyCodeLine{1972                 \textcolor{keywordflow}{if} (previous > -\/1) \{}
\DoxyCodeLine{1973                     ch-\/>end\_of\_previous\_sample\_left[previous] = jar\_xm\_LERP(ch-\/>end\_of\_previous\_sample\_left[ch-\/>frame\_count], ch-\/>curr\_left, (\textcolor{keywordtype}{float})ch-\/>frame\_count / (\textcolor{keywordtype}{float})jar\_xm\_SAMPLE\_RAMPING\_POINTS);}
\DoxyCodeLine{1974                     ch-\/>end\_of\_previous\_sample\_right[previous] = jar\_xm\_LERP(ch-\/>end\_of\_previous\_sample\_right[ch-\/>frame\_count], ch-\/>curr\_right, (\textcolor{keywordtype}{float})ch-\/>frame\_count / (\textcolor{keywordtype}{float})jar\_xm\_SAMPLE\_RAMPING\_POINTS);}
\DoxyCodeLine{1975                 \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1976                     ch-\/>curr\_left = jar\_xm\_LERP(ch-\/>end\_of\_previous\_sample\_left[ch-\/>frame\_count], ch-\/>curr\_left, (\textcolor{keywordtype}{float})ch-\/>frame\_count / (\textcolor{keywordtype}{float})jar\_xm\_SAMPLE\_RAMPING\_POINTS);}
\DoxyCodeLine{1977                     ch-\/>curr\_right = jar\_xm\_LERP(ch-\/>end\_of\_previous\_sample\_right[ch-\/>frame\_count], ch-\/>curr\_right, (\textcolor{keywordtype}{float})ch-\/>frame\_count / (\textcolor{keywordtype}{float})jar\_xm\_SAMPLE\_RAMPING\_POINTS);}
\DoxyCodeLine{1978                 \};}
\DoxyCodeLine{1979             \};}
\DoxyCodeLine{1980         \};}
\DoxyCodeLine{1981         \textcolor{keywordflow}{return};}
\DoxyCodeLine{1982     \};}
\DoxyCodeLine{1983     \textcolor{keywordflow}{if}(ch-\/>sample-\/>length == 0) \{}
\DoxyCodeLine{1984         \textcolor{keywordflow}{return};}
\DoxyCodeLine{1985     \};}
\DoxyCodeLine{1986 }
\DoxyCodeLine{1987     \textcolor{keywordtype}{float} t = 0.f;}
\DoxyCodeLine{1988     uint32\_t b = 0;}
\DoxyCodeLine{1989     \textcolor{keywordflow}{if}(mod-\/>linear\_interpolation) \{}
\DoxyCodeLine{1990         b = ch-\/>sample\_position + 1;}
\DoxyCodeLine{1991         t = ch-\/>sample\_position -\/ (uint32\_t)ch-\/>sample\_position; \textcolor{comment}{/* Cheaper than fmodf(., 1.f) */}}
\DoxyCodeLine{1992     \};}
\DoxyCodeLine{1993 }
\DoxyCodeLine{1994     \textcolor{keywordtype}{float} u\_left, u\_right;}
\DoxyCodeLine{1995     u\_left = ch-\/>sample-\/>data[(uint32\_t)ch-\/>sample\_position];}
\DoxyCodeLine{1996     if (ch-\/>sample-\/>stereo) \{}
\DoxyCodeLine{1997         u\_right = ch-\/>sample-\/>data[(uint32\_t)ch-\/>sample\_position + ch-\/>sample-\/>length];}
\DoxyCodeLine{1998     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1999         u\_right = u\_left;}
\DoxyCodeLine{2000     \};}
\DoxyCodeLine{2001     \textcolor{keywordtype}{float} v\_left = 0.f, v\_right = 0.f;}
\DoxyCodeLine{2002     \textcolor{keywordflow}{switch}(ch-\/>sample-\/>loop\_type) \{}
\DoxyCodeLine{2003     \textcolor{keywordflow}{case} jar\_xm\_NO\_LOOP:}
\DoxyCodeLine{2004         \textcolor{keywordflow}{if}(mod-\/>linear\_interpolation) \{}
\DoxyCodeLine{2005             v\_left = (b < ch-\/>sample-\/>length) ? ch-\/>sample-\/>data[b] : .0f;}
\DoxyCodeLine{2006             if (ch-\/>sample-\/>stereo) \{}
\DoxyCodeLine{2007                 v\_right = (b < ch-\/>sample-\/>length) ? ch-\/>sample-\/>data[b + ch-\/>sample-\/>length] : .0f;}
\DoxyCodeLine{2008             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{2009                 v\_right = v\_left;}
\DoxyCodeLine{2010             \};}
\DoxyCodeLine{2011         \};}
\DoxyCodeLine{2012         ch-\/>sample\_position += ch-\/>step;}
\DoxyCodeLine{2013         \textcolor{keywordflow}{if}(ch-\/>sample\_position >= ch-\/>sample-\/>length) \{ ch-\/>sample\_position = -\/1; \} \textcolor{comment}{// stop playing this sample}}
\DoxyCodeLine{2014         \textcolor{keywordflow}{break};}
\DoxyCodeLine{2015     \textcolor{keywordflow}{case} jar\_xm\_FORWARD\_LOOP:}
\DoxyCodeLine{2016         \textcolor{keywordflow}{if}(mod-\/>linear\_interpolation) \{}
\DoxyCodeLine{2017             v\_left = ch-\/>sample-\/>data[ (b == ch-\/>sample-\/>loop\_end) ? ch-\/>sample-\/>loop\_start : b ];}
\DoxyCodeLine{2018             if (ch-\/>sample-\/>stereo) \{}
\DoxyCodeLine{2019                 v\_right = ch-\/>sample-\/>data[ (b == ch-\/>sample-\/>loop\_end) ? ch-\/>sample-\/>loop\_start + ch-\/>sample-\/>length : b + ch-\/>sample-\/>length];}
\DoxyCodeLine{2020             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{2021                 v\_right = v\_left;}
\DoxyCodeLine{2022             \};}
\DoxyCodeLine{2023         \};}
\DoxyCodeLine{2024         ch-\/>sample\_position += ch-\/>step;}
\DoxyCodeLine{2025         \textcolor{keywordflow}{if} (ch-\/>sample\_position >= ch-\/>sample-\/>loop\_end) \{}
\DoxyCodeLine{2026             ch-\/>sample\_position -\/= ch-\/>sample-\/>loop\_length;}
\DoxyCodeLine{2027         \};}
\DoxyCodeLine{2028         \textcolor{keywordflow}{if}(ch-\/>sample\_position >= ch-\/>sample-\/>length) \{}
\DoxyCodeLine{2029             ch-\/>sample\_position = ch-\/>sample-\/>loop\_start;}
\DoxyCodeLine{2030         \};}
\DoxyCodeLine{2031         \textcolor{keywordflow}{break};}
\DoxyCodeLine{2032     \textcolor{keywordflow}{case} jar\_xm\_PING\_PONG\_LOOP:}
\DoxyCodeLine{2033         \textcolor{keywordflow}{if}(ch-\/>ping) \{}
\DoxyCodeLine{2034             \textcolor{keywordflow}{if}(mod-\/>linear\_interpolation) \{}
\DoxyCodeLine{2035                 v\_left = (b >= ch-\/>sample-\/>loop\_end) ? ch-\/>sample-\/>data[(uint32\_t)ch-\/>sample\_position] : ch-\/>sample-\/>data[b];}
\DoxyCodeLine{2036                 \textcolor{keywordflow}{if} (ch-\/>sample-\/>stereo) \{}
\DoxyCodeLine{2037                     v\_right = (b >= ch-\/>sample-\/>loop\_end) ? ch-\/>sample-\/>data[(uint32\_t)ch-\/>sample\_position + ch-\/>sample-\/>length] : ch-\/>sample-\/>data[b + ch-\/>sample-\/>length];}
\DoxyCodeLine{2038                 \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{2039                     v\_right = v\_left;}
\DoxyCodeLine{2040                 \};}
\DoxyCodeLine{2041             \};}
\DoxyCodeLine{2042             ch-\/>sample\_position += ch-\/>step;}
\DoxyCodeLine{2043             \textcolor{keywordflow}{if}(ch-\/>sample\_position >= ch-\/>sample-\/>loop\_end) \{}
\DoxyCodeLine{2044                 ch-\/>ping = \textcolor{keyword}{false};}
\DoxyCodeLine{2045                 ch-\/>sample\_position = (ch-\/>sample-\/>loop\_end << 1) -\/ ch-\/>sample\_position;}
\DoxyCodeLine{2046             \};}
\DoxyCodeLine{2047             \textcolor{keywordflow}{if}(ch-\/>sample\_position >= ch-\/>sample-\/>length) \{}
\DoxyCodeLine{2048                 ch-\/>ping = \textcolor{keyword}{false};}
\DoxyCodeLine{2049                 ch-\/>sample\_position -\/= ch-\/>sample-\/>length -\/ 1;}
\DoxyCodeLine{2050             \};}
\DoxyCodeLine{2051         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{2052             \textcolor{keywordflow}{if}(mod-\/>linear\_interpolation) \{}
\DoxyCodeLine{2053                 v\_left = u\_left;}
\DoxyCodeLine{2054                 v\_right = u\_right;}
\DoxyCodeLine{2055                 u\_left = (b == 1 || b -\/ 2 <= ch-\/>sample-\/>loop\_start) ? ch-\/>sample-\/>data[(uint32\_t)ch-\/>sample\_position] : ch-\/>sample-\/>data[b -\/ 2];}
\DoxyCodeLine{2056                 \textcolor{keywordflow}{if} (ch-\/>sample-\/>stereo) \{}
\DoxyCodeLine{2057                     u\_right = (b == 1 || b -\/ 2 <= ch-\/>sample-\/>loop\_start) ? ch-\/>sample-\/>data[(uint32\_t)ch-\/>sample\_position + ch-\/>sample-\/>length] : ch-\/>sample-\/>data[b + ch-\/>sample-\/>length -\/ 2];}
\DoxyCodeLine{2058                 \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{2059                     u\_right = u\_left;}
\DoxyCodeLine{2060                 \};}
\DoxyCodeLine{2061             \};}
\DoxyCodeLine{2062             ch-\/>sample\_position -\/= ch-\/>step;}
\DoxyCodeLine{2063             \textcolor{keywordflow}{if}(ch-\/>sample\_position <= ch-\/>sample-\/>loop\_start) \{}
\DoxyCodeLine{2064                 ch-\/>ping = \textcolor{keyword}{true};}
\DoxyCodeLine{2065                 ch-\/>sample\_position = (ch-\/>sample-\/>loop\_start << 1) -\/ ch-\/>sample\_position;}
\DoxyCodeLine{2066             \};}
\DoxyCodeLine{2067             \textcolor{keywordflow}{if} (ch-\/>sample\_position <= .0f) \{}
\DoxyCodeLine{2068                 ch-\/>ping = \textcolor{keyword}{true};}
\DoxyCodeLine{2069                 ch-\/>sample\_position = .0f;}
\DoxyCodeLine{2070             \};}
\DoxyCodeLine{2071         \};}
\DoxyCodeLine{2072         \textcolor{keywordflow}{break};}
\DoxyCodeLine{2073 }
\DoxyCodeLine{2074     \textcolor{keywordflow}{default}:}
\DoxyCodeLine{2075         v\_left = .0f;}
\DoxyCodeLine{2076         v\_right = .0f;}
\DoxyCodeLine{2077         \textcolor{keywordflow}{break};}
\DoxyCodeLine{2078     \};}
\DoxyCodeLine{2079 }
\DoxyCodeLine{2080     \textcolor{keywordtype}{float} endval\_left = mod-\/>linear\_interpolation ? jar\_xm\_LERP(u\_left, v\_left, t) : u\_left;}
\DoxyCodeLine{2081     \textcolor{keywordtype}{float} endval\_right = mod-\/>linear\_interpolation ? jar\_xm\_LERP(u\_right, v\_right, t) : u\_right;}
\DoxyCodeLine{2082 }
\DoxyCodeLine{2083     \textcolor{keywordflow}{if} (mod-\/>ramping) \{}
\DoxyCodeLine{2084         \textcolor{keywordflow}{if}(ch-\/>frame\_count < jar\_xm\_SAMPLE\_RAMPING\_POINTS) \{}
\DoxyCodeLine{2085             \textcolor{comment}{/* Smoothly transition between old and new sample. */}}
\DoxyCodeLine{2086             \textcolor{keywordflow}{if} (previous > -\/1) \{}
\DoxyCodeLine{2087                 ch-\/>end\_of\_previous\_sample\_left[previous] = jar\_xm\_LERP(ch-\/>end\_of\_previous\_sample\_left[ch-\/>frame\_count], endval\_left, (\textcolor{keywordtype}{float})ch-\/>frame\_count / (\textcolor{keywordtype}{float})jar\_xm\_SAMPLE\_RAMPING\_POINTS);}
\DoxyCodeLine{2088                 ch-\/>end\_of\_previous\_sample\_right[previous] = jar\_xm\_LERP(ch-\/>end\_of\_previous\_sample\_right[ch-\/>frame\_count], endval\_right, (\textcolor{keywordtype}{float})ch-\/>frame\_count / (\textcolor{keywordtype}{float})jar\_xm\_SAMPLE\_RAMPING\_POINTS);}
\DoxyCodeLine{2089             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{2090                 ch-\/>curr\_left = jar\_xm\_LERP(ch-\/>end\_of\_previous\_sample\_left[ch-\/>frame\_count], endval\_left, (\textcolor{keywordtype}{float})ch-\/>frame\_count / (\textcolor{keywordtype}{float})jar\_xm\_SAMPLE\_RAMPING\_POINTS);}
\DoxyCodeLine{2091                 ch-\/>curr\_right = jar\_xm\_LERP(ch-\/>end\_of\_previous\_sample\_right[ch-\/>frame\_count], endval\_right, (\textcolor{keywordtype}{float})ch-\/>frame\_count / (\textcolor{keywordtype}{float})jar\_xm\_SAMPLE\_RAMPING\_POINTS);}
\DoxyCodeLine{2092             \};}
\DoxyCodeLine{2093         \};}
\DoxyCodeLine{2094     \};}
\DoxyCodeLine{2095 }
\DoxyCodeLine{2096     \textcolor{keywordflow}{if} (previous > -\/1) \{}
\DoxyCodeLine{2097         ch-\/>end\_of\_previous\_sample\_left[previous] = endval\_left;}
\DoxyCodeLine{2098         ch-\/>end\_of\_previous\_sample\_right[previous] = endval\_right;}
\DoxyCodeLine{2099     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{2100         ch-\/>curr\_left = endval\_left;}
\DoxyCodeLine{2101         ch-\/>curr\_right = endval\_right;}
\DoxyCodeLine{2102     \};}
\DoxyCodeLine{2103 \};}
\DoxyCodeLine{2104 }
\DoxyCodeLine{2105 \textcolor{comment}{// gather all channel audio into stereo float}}
\DoxyCodeLine{2106 \textcolor{keyword}{static} \textcolor{keywordtype}{void} jar\_xm\_mixdown(jar\_xm\_context\_t* ctx, \textcolor{keywordtype}{float}* left, \textcolor{keywordtype}{float}* right) \{}
\DoxyCodeLine{2107     jar\_xm\_module\_t* mod = \&(ctx-\/>module);}
\DoxyCodeLine{2108 }
\DoxyCodeLine{2109     \textcolor{keywordflow}{if}(ctx-\/>remaining\_samples\_in\_tick <= 0) \{}
\DoxyCodeLine{2110         jar\_xm\_tick(ctx);}
\DoxyCodeLine{2111     \};}
\DoxyCodeLine{2112     ctx-\/>remaining\_samples\_in\_tick-\/-\/;}
\DoxyCodeLine{2113     *left = 0.f;}
\DoxyCodeLine{2114     *right = 0.f;}
\DoxyCodeLine{2115     \textcolor{keywordflow}{if}(ctx-\/>max\_loop\_count > 0 \&\& ctx-\/>loop\_count > ctx-\/>max\_loop\_count) \{ \textcolor{keywordflow}{return}; \}}
\DoxyCodeLine{2116 }
\DoxyCodeLine{2117     \textcolor{keywordflow}{for}(uint8\_t i = 0; i < ctx-\/>module.num\_channels; ++i) \{}
\DoxyCodeLine{2118         jar\_xm\_channel\_context\_t* ch = ctx-\/>channels + i;}
\DoxyCodeLine{2119         \textcolor{keywordflow}{if}(ch-\/>instrument != NULL \&\& ch-\/>sample != NULL \&\& ch-\/>sample\_position >= 0) \{}
\DoxyCodeLine{2120             jar\_xm\_next\_of\_sample(ctx, ch, -\/1);}
\DoxyCodeLine{2121             \textcolor{keywordflow}{if}(!ch-\/>muted \&\& !ch-\/>instrument-\/>muted) \{}
\DoxyCodeLine{2122                 *left  += ch-\/>curr\_left * ch-\/>actual\_volume * (1.f -\/ ch-\/>actual\_panning);}
\DoxyCodeLine{2123                 *right += ch-\/>curr\_right * ch-\/>actual\_volume * ch-\/>actual\_panning;}
\DoxyCodeLine{2124             \};}
\DoxyCodeLine{2125 }
\DoxyCodeLine{2126             \textcolor{keywordflow}{if} (mod-\/>ramping) \{}
\DoxyCodeLine{2127                 ch-\/>frame\_count++;}
\DoxyCodeLine{2128                 jar\_xm\_SLIDE\_TOWARDS(ch-\/>actual\_volume, ch-\/>target\_volume, ctx-\/>volume\_ramp);}
\DoxyCodeLine{2129                 jar\_xm\_SLIDE\_TOWARDS(ch-\/>actual\_panning, ch-\/>target\_panning, ctx-\/>panning\_ramp);}
\DoxyCodeLine{2130             \};}
\DoxyCodeLine{2131         \};}
\DoxyCodeLine{2132     \};}
\DoxyCodeLine{2133     \textcolor{keywordflow}{if} (ctx-\/>global\_volume != 1.0f) \{}
\DoxyCodeLine{2134         *left *= ctx-\/>global\_volume;}
\DoxyCodeLine{2135         *right *= ctx-\/>global\_volume;}
\DoxyCodeLine{2136     \};}
\DoxyCodeLine{2137 }
\DoxyCodeLine{2138     \textcolor{comment}{// experimental}}
\DoxyCodeLine{2139 \textcolor{comment}{//    float counter = (float)ctx-\/>generated\_samples * 0.0001f}}
\DoxyCodeLine{2140 \textcolor{comment}{//    *left = tan(\&left + sin(counter));}}
\DoxyCodeLine{2141 \textcolor{comment}{//    *right = tan(\&right + cos(counter));}}
\DoxyCodeLine{2142 }
\DoxyCodeLine{2143     \textcolor{comment}{// apply brick wall limiter when audio goes beyond bounderies}}
\DoxyCodeLine{2144     \textcolor{keywordflow}{if}(*left < -\/1.0)  \{*left = -\/1.0;\}  \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(*left > 1.0)  \{*left = 1.0;\};}
\DoxyCodeLine{2145     \textcolor{keywordflow}{if}(*right < -\/1.0) \{*right = -\/1.0;\} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(*right > 1.0) \{*right = 1.0;\};}
\DoxyCodeLine{2146 \};}
\DoxyCodeLine{2147 }
\DoxyCodeLine{2148 \textcolor{keywordtype}{void} jar\_xm\_generate\_samples(jar\_xm\_context\_t* ctx, \textcolor{keywordtype}{float}* output, \textcolor{keywordtype}{size\_t} numsamples) \{}
\DoxyCodeLine{2149     \textcolor{keywordflow}{if}(ctx \&\& output) \{}
\DoxyCodeLine{2150         ctx-\/>generated\_samples += numsamples;}
\DoxyCodeLine{2151         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < numsamples; i++) \{}
\DoxyCodeLine{2152             jar\_xm\_mixdown(ctx, output + (2 * i), output + (2 * i + 1));}
\DoxyCodeLine{2153         \};}
\DoxyCodeLine{2154     \};}
\DoxyCodeLine{2155 \};}
\DoxyCodeLine{2156 }
\DoxyCodeLine{2157 uint64\_t jar\_xm\_get\_remaining\_samples(jar\_xm\_context\_t* ctx) \{}
\DoxyCodeLine{2158     uint64\_t total = 0;}
\DoxyCodeLine{2159     uint8\_t currentLoopCount = jar\_xm\_get\_loop\_count(ctx);}
\DoxyCodeLine{2160     jar\_xm\_set\_max\_loop\_count(ctx, 0);}
\DoxyCodeLine{2161     \textcolor{keywordflow}{while}(jar\_xm\_get\_loop\_count(ctx) == currentLoopCount) \{}
\DoxyCodeLine{2162         total += ctx-\/>remaining\_samples\_in\_tick;}
\DoxyCodeLine{2163         ctx-\/>remaining\_samples\_in\_tick = 0;}
\DoxyCodeLine{2164         jar\_xm\_tick(ctx);}
\DoxyCodeLine{2165     \}}
\DoxyCodeLine{2166     ctx-\/>loop\_count = currentLoopCount;}
\DoxyCodeLine{2167     \textcolor{keywordflow}{return} total;}
\DoxyCodeLine{2168 \}}
\DoxyCodeLine{2169 }
\DoxyCodeLine{2170 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{2171 \textcolor{comment}{//FILE LOADER -\/ TODO -\/ NEEDS TO BE CLEANED UP}}
\DoxyCodeLine{2172 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{2173 \textcolor{preprocessor}{\#undef DEBUG}}
\DoxyCodeLine{2174 \textcolor{preprocessor}{\#define DEBUG(...) do \{      \(\backslash\)}}
\DoxyCodeLine{2175 \textcolor{preprocessor}{        fprintf(stderr, \_\_VA\_ARGS\_\_); \(\backslash\)}}
\DoxyCodeLine{2176 \textcolor{preprocessor}{        fflush(stderr); \(\backslash\)}}
\DoxyCodeLine{2177 \textcolor{preprocessor}{    \} while(0)}}
\DoxyCodeLine{2178 }
\DoxyCodeLine{2179 \textcolor{preprocessor}{\#define DEBUG\_ERR(...) do \{      \(\backslash\)}}
\DoxyCodeLine{2180 \textcolor{preprocessor}{        fprintf(stderr, \_\_VA\_ARGS\_\_); \(\backslash\)}}
\DoxyCodeLine{2181 \textcolor{preprocessor}{        fflush(stderr); \(\backslash\)}}
\DoxyCodeLine{2182 \textcolor{preprocessor}{    \} while(0)}}
\DoxyCodeLine{2183 }
\DoxyCodeLine{2184 \textcolor{preprocessor}{\#define FATAL(...) do \{      \(\backslash\)}}
\DoxyCodeLine{2185 \textcolor{preprocessor}{        fprintf(stderr, \_\_VA\_ARGS\_\_); \(\backslash\)}}
\DoxyCodeLine{2186 \textcolor{preprocessor}{        fflush(stderr); \(\backslash\)}}
\DoxyCodeLine{2187 \textcolor{preprocessor}{        exit(1); \(\backslash\)}}
\DoxyCodeLine{2188 \textcolor{preprocessor}{    \} while(0)}}
\DoxyCodeLine{2189 }
\DoxyCodeLine{2190 \textcolor{preprocessor}{\#define FATAL\_ERR(...) do \{      \(\backslash\)}}
\DoxyCodeLine{2191 \textcolor{preprocessor}{        fprintf(stderr, \_\_VA\_ARGS\_\_); \(\backslash\)}}
\DoxyCodeLine{2192 \textcolor{preprocessor}{        fflush(stderr); \(\backslash\)}}
\DoxyCodeLine{2193 \textcolor{preprocessor}{        exit(1); \(\backslash\)}}
\DoxyCodeLine{2194 \textcolor{preprocessor}{    \} while(0)}}
\DoxyCodeLine{2195 }
\DoxyCodeLine{2196 }
\DoxyCodeLine{2197 \textcolor{keywordtype}{int} jar\_xm\_create\_context\_from\_file(jar\_xm\_context\_t** ctx, uint32\_t rate, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* filename) \{}
\DoxyCodeLine{2198     FILE* xmf;}
\DoxyCodeLine{2199     \textcolor{keywordtype}{int} size;}
\DoxyCodeLine{2200     \textcolor{keywordtype}{int} ret;}
\DoxyCodeLine{2201 }
\DoxyCodeLine{2202     xmf = fopen(filename, \textcolor{stringliteral}{"{}rb"{}});}
\DoxyCodeLine{2203     \textcolor{keywordflow}{if}(xmf == NULL) \{}
\DoxyCodeLine{2204         DEBUG\_ERR(\textcolor{stringliteral}{"{}Could not open input file"{}});}
\DoxyCodeLine{2205         *ctx = NULL;}
\DoxyCodeLine{2206         \textcolor{keywordflow}{return} 3;}
\DoxyCodeLine{2207     \}}
\DoxyCodeLine{2208 }
\DoxyCodeLine{2209     fseek(xmf, 0, SEEK\_END);}
\DoxyCodeLine{2210     size = ftell(xmf);}
\DoxyCodeLine{2211     rewind(xmf);}
\DoxyCodeLine{2212     \textcolor{keywordflow}{if}(size == -\/1) \{}
\DoxyCodeLine{2213         fclose(xmf);}
\DoxyCodeLine{2214         DEBUG\_ERR(\textcolor{stringliteral}{"{}fseek() failed"{}});}
\DoxyCodeLine{2215         *ctx = NULL;}
\DoxyCodeLine{2216         \textcolor{keywordflow}{return} 4;}
\DoxyCodeLine{2217     \}}
\DoxyCodeLine{2218 }
\DoxyCodeLine{2219     \textcolor{keywordtype}{char}* data = JARXM\_MALLOC(size + 1);}
\DoxyCodeLine{2220     \textcolor{keywordflow}{if}(!data || fread(data, 1, size, xmf) < size) \{}
\DoxyCodeLine{2221         fclose(xmf);}
\DoxyCodeLine{2222         DEBUG\_ERR(data ? \textcolor{stringliteral}{"{}fread() failed"{}} : \textcolor{stringliteral}{"{}JARXM\_MALLOC() failed"{}});}
\DoxyCodeLine{2223         JARXM\_FREE(data);}
\DoxyCodeLine{2224         *ctx = NULL;}
\DoxyCodeLine{2225         \textcolor{keywordflow}{return} 5;}
\DoxyCodeLine{2226     \}}
\DoxyCodeLine{2227 }
\DoxyCodeLine{2228     fclose(xmf);}
\DoxyCodeLine{2229 }
\DoxyCodeLine{2230     ret = jar\_xm\_create\_context\_safe(ctx, data, size, rate);}
\DoxyCodeLine{2231     JARXM\_FREE(data);}
\DoxyCodeLine{2232 }
\DoxyCodeLine{2233     \textcolor{keywordflow}{switch}(ret) \{}
\DoxyCodeLine{2234     \textcolor{keywordflow}{case} 0:}
\DoxyCodeLine{2235         \textcolor{keywordflow}{break};}
\DoxyCodeLine{2236     \textcolor{keywordflow}{case} 1:        DEBUG(\textcolor{stringliteral}{"{}could not create context: module is not sane\(\backslash\)n"{}});}
\DoxyCodeLine{2237         *ctx = NULL;}
\DoxyCodeLine{2238         \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{2239         \textcolor{keywordflow}{break};}
\DoxyCodeLine{2240     \textcolor{keywordflow}{case} 2:        FATAL(\textcolor{stringliteral}{"{}could not create context: malloc failed\(\backslash\)n"{}});}
\DoxyCodeLine{2241         \textcolor{keywordflow}{return} 2;}
\DoxyCodeLine{2242         \textcolor{keywordflow}{break};}
\DoxyCodeLine{2243     \textcolor{keywordflow}{default}:       FATAL(\textcolor{stringliteral}{"{}could not create context: unknown error\(\backslash\)n"{}});}
\DoxyCodeLine{2244         \textcolor{keywordflow}{return} 6;}
\DoxyCodeLine{2245         \textcolor{keywordflow}{break};}
\DoxyCodeLine{2246     \}}
\DoxyCodeLine{2247 }
\DoxyCodeLine{2248     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{2249 \}}
\DoxyCodeLine{2250 }
\DoxyCodeLine{2251 \textcolor{comment}{// not part of the original library}}
\DoxyCodeLine{2252 \textcolor{keywordtype}{void} jar\_xm\_reset(jar\_xm\_context\_t* ctx) \{}
\DoxyCodeLine{2253     \textcolor{keywordflow}{for} (uint16\_t i = 0; i < jar\_xm\_get\_number\_of\_channels(ctx); i++) \{}
\DoxyCodeLine{2254         jar\_xm\_cut\_note(\&ctx-\/>channels[i]);}
\DoxyCodeLine{2255     \}}
\DoxyCodeLine{2256     ctx-\/>generated\_samples = 0;}
\DoxyCodeLine{2257     ctx-\/>current\_row = 0;}
\DoxyCodeLine{2258     ctx-\/>current\_table\_index = 0;}
\DoxyCodeLine{2259     ctx-\/>current\_tick = 0;}
\DoxyCodeLine{2260     ctx-\/>tempo =ctx-\/>default\_tempo; \textcolor{comment}{// reset to file default value}}
\DoxyCodeLine{2261     ctx-\/>bpm = ctx-\/>default\_bpm; \textcolor{comment}{// reset to file default value}}
\DoxyCodeLine{2262     ctx-\/>global\_volume = ctx-\/>default\_global\_volume; \textcolor{comment}{// reset to file default value}}
\DoxyCodeLine{2263 \}}
\DoxyCodeLine{2264 }
\DoxyCodeLine{2265 }
\DoxyCodeLine{2266 \textcolor{keywordtype}{void} jar\_xm\_flip\_linear\_interpolation(jar\_xm\_context\_t* ctx) \{}
\DoxyCodeLine{2267     \textcolor{keywordflow}{if} (ctx-\/>module.linear\_interpolation) \{}
\DoxyCodeLine{2268         ctx-\/>module.linear\_interpolation = 0;}
\DoxyCodeLine{2269     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{2270         ctx-\/>module.linear\_interpolation = 1;}
\DoxyCodeLine{2271     \}}
\DoxyCodeLine{2272 \}}
\DoxyCodeLine{2273 }
\DoxyCodeLine{2274 \textcolor{keywordtype}{void} jar\_xm\_table\_jump(jar\_xm\_context\_t* ctx, \textcolor{keywordtype}{int} table\_ptr) \{}
\DoxyCodeLine{2275     \textcolor{keywordflow}{for} (uint16\_t i = 0; i < jar\_xm\_get\_number\_of\_channels(ctx); i++) \{}
\DoxyCodeLine{2276         jar\_xm\_cut\_note(\&ctx-\/>channels[i]);}
\DoxyCodeLine{2277     \}}
\DoxyCodeLine{2278     ctx-\/>current\_row = 0;}
\DoxyCodeLine{2279     ctx-\/>current\_tick = 0;}
\DoxyCodeLine{2280     \textcolor{keywordflow}{if}(table\_ptr > 0 \&\& table\_ptr < ctx-\/>\mbox{\hyperlink{structmodule}{module}}.length) \{}
\DoxyCodeLine{2281         ctx-\/>current\_table\_index = table\_ptr;}
\DoxyCodeLine{2282         ctx-\/>module.restart\_position = table\_ptr; \textcolor{comment}{// The reason to jump is to start a new loop or track}}
\DoxyCodeLine{2283     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{2284         ctx-\/>current\_table\_index = 0;}
\DoxyCodeLine{2285         ctx-\/>module.restart\_position = 0; \textcolor{comment}{// The reason to jump is to start a new loop or track}}
\DoxyCodeLine{2286         ctx-\/>tempo =ctx-\/>default\_tempo; \textcolor{comment}{// reset to file default value}}
\DoxyCodeLine{2287         ctx-\/>bpm = ctx-\/>default\_bpm; \textcolor{comment}{// reset to file default value}}
\DoxyCodeLine{2288         ctx-\/>global\_volume = ctx-\/>default\_global\_volume; \textcolor{comment}{// reset to file default value}}
\DoxyCodeLine{2289     \};}
\DoxyCodeLine{2290 \}}
\DoxyCodeLine{2291 }
\DoxyCodeLine{2292 }
\DoxyCodeLine{2293 \textcolor{comment}{// TRANSLATE NOTE NUMBER INTO USER VALUE (ie. 1 = C-\/1, 2 = C\#1, 3 = D-\/1 ... )}}
\DoxyCodeLine{2294 \textcolor{keyword}{const} \textcolor{keywordtype}{char}* xm\_note\_chr(\textcolor{keywordtype}{int} number) \{}
\DoxyCodeLine{2295     \textcolor{keywordflow}{if} (number == NOTE\_OFF) \{}
\DoxyCodeLine{2296         \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}=="{}};}
\DoxyCodeLine{2297     \};}
\DoxyCodeLine{2298     number = number \% 12;}
\DoxyCodeLine{2299     \textcolor{keywordflow}{switch}(number) \{}
\DoxyCodeLine{2300     \textcolor{keywordflow}{case} 1: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}C-\/"{}};}
\DoxyCodeLine{2301     \textcolor{keywordflow}{case} 2: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}C\#"{}};}
\DoxyCodeLine{2302     \textcolor{keywordflow}{case} 3: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}D-\/"{}};}
\DoxyCodeLine{2303     \textcolor{keywordflow}{case} 4: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}D\#"{}};}
\DoxyCodeLine{2304     \textcolor{keywordflow}{case} 5: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}E-\/"{}};}
\DoxyCodeLine{2305     \textcolor{keywordflow}{case} 6: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}F-\/"{}};}
\DoxyCodeLine{2306     \textcolor{keywordflow}{case} 7: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}F\#"{}};}
\DoxyCodeLine{2307     \textcolor{keywordflow}{case} 8: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}G-\/"{}};}
\DoxyCodeLine{2308     \textcolor{keywordflow}{case} 9: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}G\#"{}};}
\DoxyCodeLine{2309     \textcolor{keywordflow}{case} 10: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}A-\/"{}};}
\DoxyCodeLine{2310     \textcolor{keywordflow}{case} 11: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}A\#"{}};}
\DoxyCodeLine{2311     \textcolor{keywordflow}{case} 12: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}B-\/"{}};}
\DoxyCodeLine{2312     \};}
\DoxyCodeLine{2313     \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}??"{}};}
\DoxyCodeLine{2314 \};}
\DoxyCodeLine{2315 }
\DoxyCodeLine{2316 \textcolor{keyword}{const} \textcolor{keywordtype}{char}* xm\_octave\_chr(\textcolor{keywordtype}{int} number) \{}
\DoxyCodeLine{2317     \textcolor{keywordflow}{if} (number == NOTE\_OFF) \{}
\DoxyCodeLine{2318         \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}="{}};}
\DoxyCodeLine{2319     \};}
\DoxyCodeLine{2320 }
\DoxyCodeLine{2321     \textcolor{keywordtype}{int} number2 = number -\/ number \% 12;}
\DoxyCodeLine{2322     \textcolor{keywordtype}{int} result = floor(number2 / 12) + 1;}
\DoxyCodeLine{2323     \textcolor{keywordflow}{switch}(result) \{}
\DoxyCodeLine{2324     \textcolor{keywordflow}{case} 1: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}1"{}};}
\DoxyCodeLine{2325     \textcolor{keywordflow}{case} 2: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}2"{}};}
\DoxyCodeLine{2326     \textcolor{keywordflow}{case} 3: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}3"{}};}
\DoxyCodeLine{2327     \textcolor{keywordflow}{case} 4: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}4"{}};}
\DoxyCodeLine{2328     \textcolor{keywordflow}{case} 5: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}5"{}};}
\DoxyCodeLine{2329     \textcolor{keywordflow}{case} 6: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}6"{}};}
\DoxyCodeLine{2330     \textcolor{keywordflow}{case} 7: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}7"{}};}
\DoxyCodeLine{2331     \textcolor{keywordflow}{case} 8: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}8"{}};}
\DoxyCodeLine{2332     \textcolor{keywordflow}{default}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}?"{}}; \textcolor{comment}{/* UNKNOWN */}}
\DoxyCodeLine{2333     \};}
\DoxyCodeLine{2334 }
\DoxyCodeLine{2335 \};}
\DoxyCodeLine{2336 }
\DoxyCodeLine{2337 \textcolor{comment}{// TRANSLATE NOTE EFFECT CODE INTO USER VALUE}}
\DoxyCodeLine{2338 \textcolor{keyword}{const} \textcolor{keywordtype}{char}* xm\_effect\_chr(\textcolor{keywordtype}{int} fx) \{}
\DoxyCodeLine{2339     \textcolor{keywordflow}{switch}(fx) \{}
\DoxyCodeLine{2340     \textcolor{keywordflow}{case} 0: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}0"{}};  \textcolor{comment}{/* ZERO = NO EFFECT */}}
\DoxyCodeLine{2341     \textcolor{keywordflow}{case} 1: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}1"{}};  \textcolor{comment}{/* 1xx: Portamento up */}}
\DoxyCodeLine{2342     \textcolor{keywordflow}{case} 2: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}2"{}};  \textcolor{comment}{/* 2xx: Portamento down */}}
\DoxyCodeLine{2343     \textcolor{keywordflow}{case} 3: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}3"{}};  \textcolor{comment}{/* 3xx: Tone portamento */}}
\DoxyCodeLine{2344     \textcolor{keywordflow}{case} 4: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}4"{}};  \textcolor{comment}{/* 4xy: Vibrato */}}
\DoxyCodeLine{2345     \textcolor{keywordflow}{case} 5: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}5"{}};  \textcolor{comment}{/* 5xy: Tone portamento + Volume slide */}}
\DoxyCodeLine{2346     \textcolor{keywordflow}{case} 6: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}6"{}};  \textcolor{comment}{/* 6xy: Vibrato + Volume slide */}}
\DoxyCodeLine{2347     \textcolor{keywordflow}{case} 7: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}7"{}};  \textcolor{comment}{/* 7xy: Tremolo */}}
\DoxyCodeLine{2348     \textcolor{keywordflow}{case} 8: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}8"{}};  \textcolor{comment}{/* 8xx: Set panning */}}
\DoxyCodeLine{2349     \textcolor{keywordflow}{case} 9: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}9"{}};  \textcolor{comment}{/* 9xx: Sample offset */}}
\DoxyCodeLine{2350     \textcolor{keywordflow}{case} 0xA: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}A"{}};\textcolor{comment}{/* Axy: Volume slide */}}
\DoxyCodeLine{2351     \textcolor{keywordflow}{case} 0xB: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}B"{}};\textcolor{comment}{/* Bxx: Position jump */}}
\DoxyCodeLine{2352     \textcolor{keywordflow}{case} 0xC: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}C"{}};\textcolor{comment}{/* Cxx: Set volume */}}
\DoxyCodeLine{2353     \textcolor{keywordflow}{case} 0xD: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}D"{}};\textcolor{comment}{/* Dxx: Pattern break */}}
\DoxyCodeLine{2354     \textcolor{keywordflow}{case} 0xE: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}E"{}};\textcolor{comment}{/* EXy: Extended command */}}
\DoxyCodeLine{2355     \textcolor{keywordflow}{case} 0xF: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}F"{}};\textcolor{comment}{/* Fxx: Set tempo/BPM */}}
\DoxyCodeLine{2356     \textcolor{keywordflow}{case} 16: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}G"{}}; \textcolor{comment}{/* Gxx: Set global volume */}}
\DoxyCodeLine{2357     \textcolor{keywordflow}{case} 17: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}H"{}}; \textcolor{comment}{/* Hxy: Global volume slide */}}
\DoxyCodeLine{2358     \textcolor{keywordflow}{case} 21: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}L"{}}; \textcolor{comment}{/* Lxx: Set envelope position */}}
\DoxyCodeLine{2359     \textcolor{keywordflow}{case} 25: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}P"{}}; \textcolor{comment}{/* Pxy: Panning slide */}}
\DoxyCodeLine{2360     \textcolor{keywordflow}{case} 27: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}R"{}}; \textcolor{comment}{/* Rxy: Multi retrig note */}}
\DoxyCodeLine{2361     \textcolor{keywordflow}{case} 29: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}T"{}}; \textcolor{comment}{/* Txy: Tremor */}}
\DoxyCodeLine{2362     \textcolor{keywordflow}{case} 33: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}X"{}}; \textcolor{comment}{/* Xxy: Extra stuff */}}
\DoxyCodeLine{2363     \textcolor{keywordflow}{default}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}?"{}}; \textcolor{comment}{/* UNKNOWN */}}
\DoxyCodeLine{2364     \};}
\DoxyCodeLine{2365 \}}
\DoxyCodeLine{2366 }
\DoxyCodeLine{2367 \textcolor{preprocessor}{\#ifdef JAR\_XM\_RAYLIB}}
\DoxyCodeLine{2368 }
\DoxyCodeLine{2369 \textcolor{preprocessor}{\#include "{}raylib.h"{}} \textcolor{comment}{// Need RayLib API calls for the DEBUG display}}
\DoxyCodeLine{2370 }
\DoxyCodeLine{2371 \textcolor{keywordtype}{void} jar\_xm\_debug(jar\_xm\_context\_t *ctx) \{}
\DoxyCodeLine{2372     \textcolor{keywordtype}{int} size=40;}
\DoxyCodeLine{2373     \textcolor{keywordtype}{int} x = 0, y = 0;}
\DoxyCodeLine{2374 }
\DoxyCodeLine{2375     \textcolor{comment}{// DEBUG VARIABLES}}
\DoxyCodeLine{2376     y += size; DrawText(TextFormat(\textcolor{stringliteral}{"{}CUR TBL = \%i"{}}, ctx-\/>current\_table\_index),       x, y, size, WHITE);}
\DoxyCodeLine{2377     y += size; DrawText(TextFormat(\textcolor{stringliteral}{"{}CUR PAT = \%i"{}}, ctx-\/>module.pattern\_table[ctx-\/>current\_table\_index]),   x, y, size, WHITE);}
\DoxyCodeLine{2378     y += size; DrawText(TextFormat(\textcolor{stringliteral}{"{}POS JMP = \%d"{}}, ctx-\/>position\_jump),             x, y, size, WHITE);}
\DoxyCodeLine{2379     y += size; DrawText(TextFormat(\textcolor{stringliteral}{"{}JMP DST = \%i"{}}, ctx-\/>jump\_dest),                 x, y, size, WHITE);}
\DoxyCodeLine{2380     y += size; DrawText(TextFormat(\textcolor{stringliteral}{"{}PTN BRK = \%d"{}}, ctx-\/>pattern\_break),             x, y, size, WHITE);}
\DoxyCodeLine{2381     y += size; DrawText(TextFormat(\textcolor{stringliteral}{"{}CUR ROW = \%i"{}}, ctx-\/>current\_row),               x, y, size, WHITE);}
\DoxyCodeLine{2382     y += size; DrawText(TextFormat(\textcolor{stringliteral}{"{}JMP ROW = \%i"{}}, ctx-\/>jump\_row),                  x, y, size, WHITE);}
\DoxyCodeLine{2383     y += size; DrawText(TextFormat(\textcolor{stringliteral}{"{}ROW LCT = \%i"{}}, ctx-\/>row\_loop\_count),            x, y, size, WHITE);}
\DoxyCodeLine{2384     y += size; DrawText(TextFormat(\textcolor{stringliteral}{"{}LCT     = \%i"{}}, ctx-\/>loop\_count),                x, y, size, WHITE);}
\DoxyCodeLine{2385     y += size; DrawText(TextFormat(\textcolor{stringliteral}{"{}MAX LCT = \%i"{}}, ctx-\/>max\_loop\_count),            x, y, size, WHITE);}
\DoxyCodeLine{2386     x = size * 12; y = 0;}
\DoxyCodeLine{2387 }
\DoxyCodeLine{2388     y += size; DrawText(TextFormat(\textcolor{stringliteral}{"{}CUR TCK = \%i"{}}, ctx-\/>current\_tick),              x, y, size, WHITE);}
\DoxyCodeLine{2389     y += size; DrawText(TextFormat(\textcolor{stringliteral}{"{}XTR TCK = \%i"{}}, ctx-\/>extra\_ticks),               x, y, size, WHITE);}
\DoxyCodeLine{2390     y += size; DrawText(TextFormat(\textcolor{stringliteral}{"{}TCK/ROW = \%i"{}}, ctx-\/>tempo),                     x, y, size, ORANGE);}
\DoxyCodeLine{2391     y += size; DrawText(TextFormat(\textcolor{stringliteral}{"{}SPL TCK = \%f"{}}, ctx-\/>remaining\_samples\_in\_tick), x, y, size, WHITE);}
\DoxyCodeLine{2392     y += size; DrawText(TextFormat(\textcolor{stringliteral}{"{}GEN SPL = \%i"{}}, ctx-\/>generated\_samples),         x, y, size, WHITE);}
\DoxyCodeLine{2393     y += size * 7;}
\DoxyCodeLine{2394 }
\DoxyCodeLine{2395     x = 0;}
\DoxyCodeLine{2396     size=16;}
\DoxyCodeLine{2397     \textcolor{comment}{// TIMELINE OF MODULE}}
\DoxyCodeLine{2398     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0; i < ctx-\/>module.length; i++) \{}
\DoxyCodeLine{2399         \textcolor{keywordflow}{if} (i == ctx-\/>jump\_dest) \{}
\DoxyCodeLine{2400             \textcolor{keywordflow}{if} (ctx-\/>position\_jump) \{}
\DoxyCodeLine{2401                 DrawRectangle(i * size * 2, y -\/ size, size * 2, size, GOLD);}
\DoxyCodeLine{2402             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{2403                 DrawRectangle(i * size * 2, y -\/ size, size * 2, size, BROWN);}
\DoxyCodeLine{2404             \};}
\DoxyCodeLine{2405         \};}
\DoxyCodeLine{2406         \textcolor{keywordflow}{if} (i == ctx-\/>current\_table\_index) \{}
\DoxyCodeLine{2407 \textcolor{comment}{//            DrawText(TextFormat("{}\%02X"{}, ctx-\/>current\_tick), i * size * 2, y -\/ size, size, WHITE);}}
\DoxyCodeLine{2408             DrawRectangle(i * size * 2, y, size * 2, size, RED);}
\DoxyCodeLine{2409             DrawText(TextFormat(\textcolor{stringliteral}{"{}\%02X"{}}, ctx-\/>current\_row), i * size * 2, y -\/ size, size, YELLOW);}
\DoxyCodeLine{2410         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{2411             DrawRectangle(i * size * 2, y, size * 2, size, ORANGE);}
\DoxyCodeLine{2412         \};}
\DoxyCodeLine{2413         DrawText(TextFormat(\textcolor{stringliteral}{"{}\%02X"{}}, ctx-\/>module.pattern\_table[i]), i * size * 2, y, size, WHITE);}
\DoxyCodeLine{2414     \};}
\DoxyCodeLine{2415     y += size;}
\DoxyCodeLine{2416 }
\DoxyCodeLine{2417     jar\_xm\_pattern\_t* cur = ctx-\/>module.patterns + ctx-\/>module.pattern\_table[ctx-\/>current\_table\_index];}
\DoxyCodeLine{2418 }
\DoxyCodeLine{2419     \textcolor{comment}{/* DISPLAY CURRENTLY PLAYING PATTERN */}}
\DoxyCodeLine{2420 }
\DoxyCodeLine{2421     x += 2 * size;}
\DoxyCodeLine{2422     \textcolor{keywordflow}{for}(uint8\_t i = 0; i < ctx-\/>module.num\_channels; i++) \{}
\DoxyCodeLine{2423         DrawRectangle(x, y, 8 * size, size, PURPLE);}
\DoxyCodeLine{2424         DrawText(\textcolor{stringliteral}{"{}N"{}}, x, y, size, YELLOW);}
\DoxyCodeLine{2425         DrawText(\textcolor{stringliteral}{"{}I"{}}, x + size * 2, y, size, YELLOW);}
\DoxyCodeLine{2426         DrawText(\textcolor{stringliteral}{"{}V"{}}, x + size * 4, y, size, YELLOW);}
\DoxyCodeLine{2427         DrawText(\textcolor{stringliteral}{"{}FX"{}}, x + size * 6, y, size, YELLOW);}
\DoxyCodeLine{2428         x += 9 * size;}
\DoxyCodeLine{2429     \};}
\DoxyCodeLine{2430     x += size;}
\DoxyCodeLine{2431     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j=(ctx-\/>current\_row -\/ 14); j<(ctx-\/>current\_row + 15); j++) \{}
\DoxyCodeLine{2432         y += size;}
\DoxyCodeLine{2433         x = 0;}
\DoxyCodeLine{2434         \textcolor{keywordflow}{if} (j >=0 \&\& j < (cur-\/>num\_rows)) \{}
\DoxyCodeLine{2435             DrawRectangle(x, y, size * 2, size, BROWN);}
\DoxyCodeLine{2436             DrawText(TextFormat(\textcolor{stringliteral}{"{}\%02X"{}},j), x, y, size, WHITE);}
\DoxyCodeLine{2437             x += 2 * size;}
\DoxyCodeLine{2438             \textcolor{keywordflow}{for}(uint8\_t i = 0; i < ctx-\/>module.num\_channels; i++) \{}
\DoxyCodeLine{2439                 \textcolor{keywordflow}{if} (j==(ctx-\/>current\_row)) \{}
\DoxyCodeLine{2440                     DrawRectangle(x, y, 8 * size, size, DARKGREEN);}
\DoxyCodeLine{2441                 \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{2442                     DrawRectangle(x, y, 8 * size, size, DARKGRAY);}
\DoxyCodeLine{2443                 \};}
\DoxyCodeLine{2444                 jar\_xm\_pattern\_slot\_t *s = cur-\/>slots + j * ctx-\/>module.num\_channels + i;}
\DoxyCodeLine{2445            \textcolor{comment}{//     jar\_xm\_channel\_context\_t *ch = ctx-\/>channels + i;}}
\DoxyCodeLine{2446                 \textcolor{keywordflow}{if} (s-\/>note > 0) \{DrawText(TextFormat(\textcolor{stringliteral}{"{}\%s\%s"{}}, xm\_note\_chr(s-\/>note), xm\_octave\_chr(s-\/>note) ), x, y, size, WHITE);\} \textcolor{keywordflow}{else} \{DrawText(\textcolor{stringliteral}{"{}..."{}}, x, y, size, GRAY);\};}
\DoxyCodeLine{2447                 \textcolor{keywordflow}{if} (s-\/>instrument > 0) \{}
\DoxyCodeLine{2448                     DrawText(TextFormat(\textcolor{stringliteral}{"{}\%02X"{}}, s-\/>instrument), x + size * 2, y, size, WHITE);}
\DoxyCodeLine{2449                     \textcolor{keywordflow}{if} (s-\/>volume\_column == 0) \{}
\DoxyCodeLine{2450                         DrawText(TextFormat(\textcolor{stringliteral}{"{}\%02X"{}}, 64), x + size * 4, y, size, YELLOW);}
\DoxyCodeLine{2451                     \};}
\DoxyCodeLine{2452                 \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{2453                     DrawText(\textcolor{stringliteral}{"{}.."{}}, x + size * 2, y, size, GRAY);}
\DoxyCodeLine{2454                     \textcolor{keywordflow}{if} (s-\/>volume\_column == 0) \{}
\DoxyCodeLine{2455                         DrawText(\textcolor{stringliteral}{"{}.."{}}, x + size * 4, y, size, GRAY);}
\DoxyCodeLine{2456                     \};}
\DoxyCodeLine{2457                 \};}
\DoxyCodeLine{2458                 \textcolor{keywordflow}{if} (s-\/>volume\_column > 0) \{DrawText(TextFormat(\textcolor{stringliteral}{"{}\%02X"{}}, (s-\/>volume\_column -\/ 16)), x + size * 4, y, size, WHITE);\};}
\DoxyCodeLine{2459                 \textcolor{keywordflow}{if} (s-\/>effect\_type > 0 || s-\/>effect\_param > 0) \{DrawText(TextFormat(\textcolor{stringliteral}{"{}\%s\%02X"{}}, xm\_effect\_chr(s-\/>effect\_type), s-\/>effect\_param), x + size * 6, y, size, WHITE);\};}
\DoxyCodeLine{2460                 x += 9 * size;}
\DoxyCodeLine{2461             \};}
\DoxyCodeLine{2462         \};}
\DoxyCodeLine{2463     \};}
\DoxyCodeLine{2464 }
\DoxyCodeLine{2465 \}}
\DoxyCodeLine{2466 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// RayLib extension}}
\DoxyCodeLine{2467 }
\DoxyCodeLine{2468 \textcolor{preprocessor}{\#endif}\textcolor{comment}{//end of JAR\_XM\_IMPLEMENTATION}}
\DoxyCodeLine{2469 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{2470 }
\DoxyCodeLine{2471 \textcolor{preprocessor}{\#endif}\textcolor{comment}{//end of INCLUDE\_JAR\_XM\_H}}

\end{DoxyCode}
